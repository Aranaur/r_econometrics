<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>r_econometrics.knit</title>

    <meta name="author" content="Ігор Мірошниченко" />
  
   <meta name="description" content="Підручик з основ економетрики з використанням мови програмування R" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="r_econometrics.knit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Підручик з основ економетрики з використанням мови програмування R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="r_econometrics.knit" />
  
  <meta name="twitter:description" content="Підручик з основ економетрики з використанням мови програмування R" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><span style='font-size: 14px'>ОСНОВИ ЕКОНОМЕТРИКИ В R
</style></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="основи-економетрики-в-r" class="section level1 unnumbered">
<h1 class="unnumbered">Основи економетрики в R</h1>
<div id="передмова" class="section level2 unnumbered">
<h2 class="unnumbered">Передмова</h2>
<blockquote>
<p>Наразі підручник в процесі розробки.</p>
</blockquote>
<blockquote>
<p>Якщо ви помітили неточності або помилки, будь-ласка напишіть мені: <code>ihor.miroshnychenko@kneu.ua</code></p>
</blockquote>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="introR" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Вступ до R</h1>
<hr />
<p>Мова програмування <strong>R</strong> — потужний інструмент, що широко використовується в різних сферах: статистика, візуалізація, наука про дані, машинне навчання, глибоке навчання тощо. Це безкоштовна система з відкритим кодом, з широкими можливостями, які досягаються за рахунок різноманіття покетів (<em>packages</em>) доповнень.
<strong>R</strong> повністю безкоштовний та доступний для встановлення на більшість операційних систем. Крім того, є можливість працювати у хмарних додатках.
В той же час, <strong>R</strong> ідеально підходить для проведення економетричних досліджень.
Вивчити <strong>R</strong> не складно і цей розділ підготовить Вас до базових операцій.</p>
<div id="installR" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Встановлення R</h2>
<hr />
<p>Варіантів роботи з мовою програмування <strong>R</strong> існує досить багато. Розберемо основні.</p>
<div id="instalpc" class="section level3" number="1.1.1">
<h3 number="1.1.1"><span class="header-section-number">1.1.1</span> Встановлення на комп’ютер</h3>
<p>Для початку необхідно встановити саму мову програмування під свою операційну систему:</p>
<ul>
<li><a href="https://cran.r-project.org/bin/windows/base/">Windows</a></li>
<li><a href="https://cran.r-project.org/bin/macosx/">MacOS</a></li>
<li><a href="https://cran.rstudio.com/bin/linux/">Linux</a></li>
</ul>
<p>Для роботи в <strong>R</strong>, також слів встановити інтегроване середовище розробки (IDE) <strong>RStudio</strong>, що значно підвищує зручність, швидкість та ефективність роботи.</p>
<p>Щоб встановити <strong>RStudio</strong>, завантажте останню версію інсталятора для Вашої операційної системи з сайту <a href="https://rstudio.com/products/rstudio/download/">https://rstudio.com/products/rstudio/download/</a></p>
</div>
<div id="installcloud" class="section level3" number="1.1.2">
<h3 number="1.1.2"><span class="header-section-number">1.1.2</span> Використання хмарних сервісів</h3>
<p>У випадках, коли не має можливості або бажання щось додатково встановлювати на ПК є декілька хмарних сервісів:</p>
<ul>
<li><a href="https://rstudio.cloud/">RStudio Cloud</a></li>
<li><a href="https://colab.research.google.com/#create=true&amp;language=r">Google Colab</a></li>
</ul>
</div>
</div>
<div id="rsudio" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> RStudio</h2>
<hr />
<p>Я пропоную використовувати саме <strong>RStudio</strong>, оскільки це найзручніший інструмент для роботи з даними.
При чому в ній можна працювати з різними мовами програмування, в тому числі й <strong>Python</strong>.</p>
<p>Якщо ваша операційна система — Windows, то після встановлення R та RStudio, на робочому столі у вас буде дві іконки:</p>
<div style="text-align:center">
<img src="docs/images/r_00.png" /> та <img src="docs/images/rstudio_00.png" />
</div>
<p>Перша відноситься до самої мови програмування і не буде використовуватись в роботі, друга відноситься до RStudio і саме вона нам потрібна.</p>
Після першого запуску RStudio ви побачите інтерфейс на рисунку @ref(fig:001)
<div class="figure" style="text-align: center">
<img src="docs/images/rstudio_01.png" alt="Базовий інтерфейс RStudio" width="100%" />
<p class="caption">
(#fig:001)Базовий інтерфейс RStudio
</p>
</div>
<p>Як правило код пишуть у скрипті (такий собі аналог текстового редактора), тож для його створення необхідно натиснути зелений хрестик в лівому верхньому куті та обрати пункт <strong>R Script</strong> або натиснути комбінацію клавіш <strong>Ctrl+Shift+N</strong>:</p>
<div class="figure" style="text-align: center">
<img src="docs/images/rstudio_02.png" alt="Створення скрипта в RStudio" width="75%" />
<p class="caption">
(#fig:002)Створення скрипта в RStudio
</p>
</div>
<p>Після чого, з’явиться додаткове вікно скрипту, де можна писати код, зберігати його та повертатися до нього за потреби.</p>
Давайте розберемо отриманий інтерфейс:
<div class="figure" style="text-align: center">
<img src="docs/images/rstudio_03.png" alt="Інтерфейс RStudio" width="100%" />
<p class="caption">
(#fig:003)Інтерфейс RStudio
</p>
</div>
<p><strong>1. СКРИПТ</strong> — відбувається основна робота з кодом.</p>
<p><strong>2. КОНСОЛЬ</strong> — повертаються результати виконання скриптів. Хоча тут так само писати код, проте він не буде збережений.</p>
<p><strong>3. РОБОЧИЙ ПРОСТІР</strong> — тут зберігаються змінні, завантажені датасети та побудовані моделі. Крім того є окреме вкладинка історії останніх команд.</p>
<p><strong>4. ГРАФІКИ та ФАЙЛИ</strong> — тут в окремих закладинках відображаються графіки, є невеличкий файловий менеджер, менеджер пакетів (про них трошки пізніше) та довідка по функціям (сюди будемо звертатися досить часто).</p>
</div>
<div id="rbase" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Базові операції</h2>
<hr />
<p>R - мова програмування з широкими можливостями. З її допомогою можна будувати математичні моделі, проводити статистичні тести, візуалізовувати дані тощо. Але почнемо з чогось максимально простого, наприклад, арифметики.</p>
<div id="rarith" class="section level3" number="1.3.1">
<h3 number="1.3.1"><span class="header-section-number">1.3.1</span> R та арифметика</h3>
<p>Вже з “коробки,” без додаткових пакетів, R надає можливість проводити арифметичні розрахунки. Всі ці операції виконуються за допомогою типових операторів, до яких ми звикли ще з часів навчання в школі або викорситання Excel.</p>
<p>Так, додавання додавання двох чисел використовується оператор <code>+</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span></code></pre></div>
<p>Для віднімання — оператор <code>-</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span></code></pre></div>
<p>Множення через оператор <code>*</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 15</span></span></code></pre></div>
<p>Ділення — <code>/</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span> <span class="sc">/</span> <span class="dv">5</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5</span></span></code></pre></div>
<p>Піднесення до степеню через <code>^</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">^</span> <span class="dv">3</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 27</span></span></code></pre></div>
<p>Як бачимо, нічого складного. Давайте розглянемо, ще два оператори.</p>
<p>Залишок від ділення — <code>%%</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">%%</span> <span class="dv">3</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>Цілочисельне ділення — <code>%/%</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span> <span class="sc">%/%</span> <span class="dv">5</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span></code></pre></div>
<p>Узагальнений перелік арифметичних операторів я помістив у наступну таблицю.</p>
<table>
<thead>
<tr class="header">
<th align="center">Оператор</th>
<th>Опис</th>
<th>Пиклад</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">+</td>
<td>Додавання</td>
<td>a + b</td>
</tr>
<tr class="even">
<td align="center">-</td>
<td>Віднімання</td>
<td>a - b</td>
</tr>
<tr class="odd">
<td align="center">*</td>
<td>Множення</td>
<td>a * b</td>
</tr>
<tr class="even">
<td align="center">/</td>
<td>Ділення</td>
<td>a / b</td>
</tr>
<tr class="odd">
<td align="center">^</td>
<td>Степінь</td>
<td>a ^ b</td>
</tr>
<tr class="even">
<td align="center">%%</td>
<td>Залишок від ділення</td>
<td>a %% b</td>
</tr>
<tr class="odd">
<td align="center">%/%</td>
<td>Цілочисельне ділення</td>
<td>a %/% b</td>
</tr>
</tbody>
</table>
</div>
<div id="rcomment" class="section level3" number="1.3.2">
<h3 number="1.3.2"><span class="header-section-number">1.3.2</span> Коментарі до коду</h3>
<p>Важливою складовою написання коду, окрім його зрозумілості та лаконічності, є коментарі, які допомагають оріентуватися, що відбувається в даному шматку коду.</p>
<p>Для додавання коментарів використовується знак ришітки або, як його ще називають, діез — <code>#</code>. Все, що написано у рядку після <code>#</code> ігнорується R:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at this awesome code</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>Якщо необхідно “закоментувати” частину коду, тобто поставити <code>#</code> на початку кожного рядка, то для цього є комбінація клавіш <strong>Ctrl + Shift + C</strong>.</p>
</div>
<div id="rprior" class="section level3" number="1.3.3">
<h3 number="1.3.3"><span class="header-section-number">1.3.3</span> Пріоритети розрахунків</h3>
<p>Після знайомства з арифметикою в R постає логічне питання з приводу пріоритетів операторів. На справді тут все просто, пріоритети працюють як в математиці. Тож не забувайте правильно розставляти дужки.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">4</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 14</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">4</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 20</span></span></code></pre></div>
</div>
<div id="rfun" class="section level3" number="1.3.4">
<h3 number="1.3.4"><span class="header-section-number">1.3.4</span> Готові функції</h3>
<p>Крім звичайних арифметичних операторів в мові програмування R одразу вбудовано багато різноманітних функцій, в тому числі й математичних.</p>
<p>Для розрахунку кореня квадратного з числа використовується функція <code>sqrt()</code>, яка може бути вам знайома, якщо ви користувалися англомовною версією Excel.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">9</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span></code></pre></div>
<blockquote>
<p><strong><em>Мова програмування R чутлива до регістру</em></strong>, тож варіанти Sqrt(9), SQRT(9) працювати не будуть.</p>
</blockquote>
<p>Разом з тим, в середині функції можна проводити математичні розрахунки:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>((<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.472136</span></span></code></pre></div>
<p>Функція <code>abs()</code> розраховує абсолютне значення:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="dv">3</span> <span class="sc">-</span> <span class="dv">5</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p>Розрахунок натурального логарифму через функцію <code>log()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">15</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.70805</span></span></code></pre></div>
<p>Але це ще не все, оскільки для логарифму притаманно мати основу, то в таких випадках слід додати в середині дужок додатковий аргумент <code>base =</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.095903</span></span></code></pre></div>
<p>Аргументи функцій можна змінювати місцями:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="at">base =</span> <span class="dv">3</span>, <span class="at">x =</span> <span class="dv">10</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.095903</span></span></code></pre></div>
<p>Доречі не обов’язково писати назви аргументів функцій. Якщо ви впевнені в їх порядку запис може виглядати наступним чином:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">10</span>, <span class="dv">3</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.095903</span></span></code></pre></div>
<p>Взагалі використання функцій — важлива особливість мови програмування R. Ми можемо створювати власні функції, використовувати функції як аргументи інших функцій тощо.</p>
</div>
<div id="rhelp" class="section level3" number="1.3.5">
<h3 number="1.3.5"><span class="header-section-number">1.3.5</span> Вбудована документація</h3>
<p>Вже на цьому етапі може виникнути ряд питань:</p>
<ul>
<li>де знайти опис функції?</li>
<li>які існують аргументи функцій?</li>
<li>чи є якісь приклади використання функцій?</li>
</ul>
<p>Відповідь досить проста — всі функції супроводжуються детальною документацією. Для її виклику можна скористуватися функцією <code>help()</code>, де в середині дужок вказати назву функції:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(abs)</span></code></pre></div>
<p>Інший варіант — це написати в консолі знак питання і після цього назву функції:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>?<span class="fu">abs</span>()</span></code></pre></div>
<p>Але на мою думку, <strong>найшвидший варіант</strong> — це написати функцію і <strong>натиснути клавішу F1</strong> на клавіатурі.</p>
<p>Всі зазначені варіанти приведуть вас до вікна документації у правому нижньому куті RStudio:</p>
<div style="text-align:center">
<img src="docs/images/rstudio_04_fix.png" />
</div>
</div>
<div id="rvar" class="section level3" number="1.3.6">
<h3 number="1.3.6"><span class="header-section-number">1.3.6</span> Створення змінних</h3>
<p>Ще один важливий пункт у багатьох мовах програмування — можливість зберігати значення у змінних.</p>
<p>В R це робиться за допомогою символів <strong>&lt;-</strong>. Для швидкого написання існує зручна комбінація клавіш <code>Alt + -</code>.</p>
<p>Ліворуч від символу <strong>&lt;-</strong> записується назва майбутньої змінної. Праворуч — значення або вираз, яке необхідно зберегти в цю змінну.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div>
<blockquote>
<p>Для присоювання можна використовувати і знак <strong>=</strong> але серед спільноти користувачів R це не прийнято.</p>
</blockquote>
<p>Слід звернути увагу, що при присвоюванні результат розрахунку не виводиться в консоль. Якщо ж хочеться переглянути результат слід використати функцію <code>print()</code> або просто звернутися до створеної змінної:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(z)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 8.246211</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>z</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 8.246211</span></span></code></pre></div>
Після створення змінна з’являється у вкладинці <strong>Environment</strong> робочого простору RStudio:
<div style="text-align:center">
<img src="docs/images/rstudio_05.png" />
</div>
</div>
<div id="rcompar" class="section level3" number="1.3.7">
<h3 number="1.3.7"><span class="header-section-number">1.3.7</span> Оператори порівняння</h3>
<p>В процесі роботи з даними, досить часто працюємо з задачами порівняння. Для вирішення таких питань в мові програмування R є зручні та зрозумілі оператори:</p>
<table>
<thead>
<tr class="header">
<th align="center">Оператор порівняння</th>
<th>Опис</th>
<th>Приклад</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">==</td>
<td>Дорівнює</td>
<td>a == b</td>
</tr>
<tr class="even">
<td align="center">!=</td>
<td>Не дорівнює</td>
<td>a != b</td>
</tr>
<tr class="odd">
<td align="center">&gt;</td>
<td>Більше</td>
<td>a &gt; b</td>
</tr>
<tr class="even">
<td align="center">&lt;</td>
<td>Менше</td>
<td>a &lt; b</td>
</tr>
<tr class="odd">
<td align="center">&gt;=</td>
<td>Більше або дорівнює</td>
<td>a &gt;= b</td>
</tr>
<tr class="even">
<td align="center">&lt;=</td>
<td>Менше або дорівнює</td>
<td>a &lt;= b</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Окремо зауважу, що для порівняння двох змінних використовується оператор з подвійним знаком дорівнює <code>==</code>, а не з одним <code>=</code>. Це досить популярна помилка.</p>
</blockquote>
</div>
</div>
<div id="rdatatype" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> Типи даних</h2>
<hr />
<p>Інформація зберігається в різних структурах даних. Це може бути число, текст, булева змінна тощо.</p>
<p>Один з найпопулярніших варіантів збереження даних — це <strong>числовий формат</strong>. В мові програмування R для нього є окремий клас — <strong>numeric</strong>. При цьому існує три типи numeric:</p>
<ol style="list-style-type: decimal">
<li>Цілі - <strong>integer</strong>.</li>
<li>Дробові - <strong>double</strong>.</li>
<li>Комплексні - <strong>complex</strong>.</li>
</ol>
<p>В більшості випадків R буде сам конвертувати числа в потрібний формат. Але якщо необхідно задати конкретний тип числа, то можна використати функції <code>as.integer()</code>, <code>as.double()</code> та <code>as.complex()</code>.</p>
<blockquote>
<p>В мові програмування R досить багато функцій, які починаються на <code>as.</code>, які переводять об’єкт до конкретного класу. Іншими словами просить читати дані в середені дужок у відповідному форматі.</p>
</blockquote>
<p>Для створення цілочислового значення можна в кінці поставити символ <code>L</code>, щоб примусово оголосити число як integer:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.integer</span>(<span class="dv">10</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] FALSE</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.integer</span>(10L)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
<blockquote>
<p>Функції, що починаються на <code>is.</code> перевіряють, чи належить об’єкт до обраного класу.</p>
</blockquote>
<p>Для роботи з <strong>текстовими даними</strong> є клас <strong>character</strong>. Вони записуються в лапках, при цьому можна використовувати як подвійні <code>"</code> так і одинарні <code>'</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(<span class="st">&quot;Ash nazg durbatulûk, ash nazg gimbatul,</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">             ash nazg thrakatulûk, agh burzum-ishi krimpatul.&quot;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Логічні (logical) данні</strong> - це тип даних які приймають лише значення <code>TRUE</code> або <code>FALSE</code>. Ми з ними вже зустрічалися коли використовували оператори порівняння.</li>
</ol>
<p>Для перевірки типу даних використовується функція <code>class()</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="dv">5</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;numeric&quot;</span></span></code></pre></div>
</div>
<div id="r_str" class="section level2" number="1.5">
<h2 number="1.5"><span class="header-section-number">1.5</span> Структури даних</h2>
R працює з багатьма структурами даних: вектори, матриці, масиви, дата фрейми та списки. Вони відрізняються за способом створення, структурою, складністю будови та способом звернення до їх елементів. Схематично ці структури даних зображено на рисунку @ref(fig:027)
<div class="figure" style="text-align: center">
<img src="docs/images/001_data_stucture.png" alt="Структури даних R" width="100%" />
<p class="caption">
(#fig:027)Структури даних R
</p>
</div>
<div id="r_vec" class="section level3" number="1.5.1">
<h3 number="1.5.1"><span class="header-section-number">1.5.1</span> Вектор</h3>
<p>Почнемо з найпростішого. <strong>Вектор</strong> - це одновимірна послідовність елементів <strong>одного типу</strong>. Для створення вектору використовується функція <code>c()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="dv">0</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  2  4  8 -2 -6  0</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;два&quot;</span>, <span class="st">&quot;чотири&quot;</span>, <span class="st">&quot;шість&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;два&quot;    &quot;чотири&quot; &quot;шість&quot;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  TRUE  TRUE FALSE</span></span></code></pre></div>
<p>Для створення послідовностей з кроком 1 зручно використовувати оператор <code>:</code></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] -5 -4 -3 -2 -1  0  1  2  3  4  5</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:-</span><span class="dv">2</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  3  2  1  0 -1 -2</span></span></code></pre></div>
<p>Для складніших послідовностей є вбудована функція <code>seq()</code> (не забувайте дивитися довідку по функціях)</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 3 5 7 9</span></span></code></pre></div>
<p>Крім того, можна задати не лише крок послідовності (аргумент <code>by =</code>), а й довжину (аргумент <code>length.out =</code>)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">3</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  1.0  5.5 10.0</span></span></code></pre></div>
<p>Інша корисна функція <code>rep()</code> дозволяє створити вектор з повторюваними значеннями. Перший аргумент - значення яке слід повторювати, другий аргумент - скільки разів повторювати.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3 3 3 3 3</span></span></code></pre></div>
<p>При цьому і перший і другий аргумент може бути вектором:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 2 3 3 3</span></span></code></pre></div>
<p>Крім того, можна об’єднувати вектори:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Say&quot;</span>, <span class="st">&quot;friend&quot;</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;and&quot;</span>, <span class="st">&quot;enter&quot;</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(v1, v2)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Say&quot;    &quot;friend&quot; &quot;and&quot;    &quot;enter&quot;</span></span></code></pre></div>
<p>В означенні вектора в мові програмування R сказано, що <strong>всі елементи вектори мають бути одного типу</strong>. Одразу хочеться перевірити, що буде, якщо ця умова не буде виконуватись. В більшості мов програмування ми б отримали помилку. Мова програмування R, при розбіжності типів, буде зводити все до “спільного знаменника,” тобто конвертувати дані за певними правилами - приведення типів (coercion).</p>
<p>Виділяють два типи:</p>
<ul>
<li><strong>неявне приведення типів (implicit coercion)</strong>, коли все відбувається автоматично за вбудованими правилами.</li>
<li><strong>явне приведення типів (explicit coercion)</strong>, коли ми самі вирішуємо до якого типу перевести дані, якщо це можливо.</li>
</ul>
<p>Приклад неявного приведення типів:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">2</span>, <span class="cn">FALSE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 0</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">-</span> <span class="cn">TRUE</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span></code></pre></div>
<p><code>TRUE</code> перетворився в <code>1</code>, а <code>FALSE</code> в <code>0</code>.
В цьому випадку всі дані приведено до текстового типу:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">2</span>, <span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;TRUE&quot;  &quot;2&quot;     &quot;Hello&quot;</span></span></code></pre></div>
<p>В R є своя ієрархія типів:
<code>NULL &lt; raw &lt; logical &lt; integer &lt; double &lt; complex &lt; character &lt; list &lt; expression</code></p>
<p>Для явного приведення типів даних використовується сімейство функцій, що починається на <code>as.</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">2</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 0 0</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">2</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;1&quot; &quot;2&quot; &quot;0&quot; &quot;0&quot;</span></span></code></pre></div>
<div id="r_vec_oper" class="section level4" number="1.5.1.1">
<h4 number="1.5.1.1"><span class="header-section-number">1.5.1.1</span> Операції з векторами</h4>
<p>Всі арифметичні операції, що ми розглядали раніше, можна використовувати й <strong>до векторів однакової довжини</strong>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>q <span class="sc">+</span> w</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  3  5  7  9 11</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>q <span class="sc">-</span> w</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -1 -1 -1 -1 -1</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>q <span class="sc">*</span> w</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  2  6 12 20 30</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>q <span class="sc">/</span> w</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.5000000 0.6666667 0.7500000 0.8000000 0.8333333</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>w <span class="sc">^</span> q <span class="sc">+</span> q <span class="sc">-</span> w <span class="sc">*</span> q</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]    1    5   55  609 7751</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(q)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.000000 1.414214 1.732051 2.000000 2.236068</span></span></code></pre></div>
</div>
<div id="r_rec_rule" class="section level4" number="1.5.1.2">
<h4 number="1.5.1.2"><span class="header-section-number">1.5.1.2</span> Правило переписування</h4>
<p>Якщо <strong>вектори не однакової довжини</strong> й ми хочемо провести з ними певні операції, то в такому випадку спрацює <strong>правило переписування (recycling rule)</strong>: якщо коротший вектор кратний довжині довшого, короткий буде повторюватися необхідну кількість разів.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>q <span class="sc">*</span> w</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 4 3 8</span></span></code></pre></div>
<p>Операції з вектором та окремим значенням можна вважати окремим випадком рестайлінгу: окреме значення буде повторюватися необхідну кількість разів:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>w <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2 4 6 8</span></span></code></pre></div>
<p>Якщо коротший вектор не кратний довшому (наприклад, перший довжиною 2, а інший - 3), то R все одно порахує результат, але видасть попередження:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>q <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in q + c(1, 5, 7): longer object length is not a multiple of shorter</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="do">## object length</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2 7 8</span></span></code></pre></div>
</div>
<div id="r_vec_idx" class="section level4" number="1.5.1.3">
<h4 number="1.5.1.3"><span class="header-section-number">1.5.1.3</span> Індексація векторів</h4>
<p>Індексація - задача вибору окремого елемента структури даних. Для цього використовуються квадратні дужки <code>[]</code>.</p>
<p>Найпростіший варіант індексація по номеру, тобто порядкове значення елемента:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:-</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">1</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -5</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">5</span>]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7</span></span></code></pre></div>
<blockquote>
<p><strong>Важливий факт - індексація в мові програмування R починається з 1.</strong></p>
</blockquote>
<p>За допомогою індексації можна не лише звертатися до окремого елементу, а й заміняти його значення:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="dv">15</span></span></code></pre></div>
<p>Можна використовувати цілі вектори для індексації:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -4 -3  2 15</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">6</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -6 15  2 -3 -4 -5</span></span></code></pre></div>
<p>Індексація зі знаком мінус видасть всі значення вектора крім обраних:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>e[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -4 -3  2 15 -6  4  3  2</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>e[<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>)]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] -4 -3  2 -6  4  3  2</span></span></code></pre></div>
</div>
</div>
<div id="r_matrix" class="section level3" number="1.5.2">
<h3 number="1.5.2"><span class="header-section-number">1.5.2</span> Матриці</h3>
<p><strong>Матриця (matrix)</strong> — це двовимірний масив даних, в якому кожен елемент має однаковий тип (числовий, текстовий, логічний). Іншими словами, матриця - це двовимірний вектор, у якого є довжина та ширина.</p>
<p>Створення матриці відбувається за допомогою функції <code>matrix()</code>, в якій слід вказати кількість рядків та стовпчиків:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4]</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5    9   13</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6   10   14</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3    7   11   15</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4    8   12   16</span></span></code></pre></div>
<p>За замовчуванням значення матриці заповнюються по стовпчиках. Але це можна змінити за допомогою аргументу <code>byrow = TRUE</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4]</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    2    3    4</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    5    6    7    8</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    9   10   11   12</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]   13   14   15   16</span></span></code></pre></div>
<p>Оскільки матриця — це двовимірний масив, то для індексації використовуються два індекси, що розділені комою: перший відповідає за рядок, другий за стовпчик.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>my_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>my_matrix</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4]</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5    9   13</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6   10   14</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3    7   11   15</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4    8   12   16</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>my_matrix[<span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 10</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>my_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    9   13</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]   10   14</span></span></code></pre></div>
<p>Якщо один з індексів залишити пустим — отримаємо всі значення рядка/стовпчика в залежності від того, який індекс ми не вказуємо.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>my_matrix[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3    7</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4    8</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>my_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4]</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5    9   13</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6   10   14</span></span></code></pre></div>
<p>Аналогічно до вектора, за допомогою індексації можна переписувати частину матриці:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>my_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>my_matrix</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3] [,4]</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5    0    0</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6    0    0</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3    7   11   15</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4    8   12   16</span></span></code></pre></div>
</div>
<div id="r_array" class="section level3" number="1.5.3">
<h3 number="1.5.3"><span class="header-section-number">1.5.3</span> Масиви</h3>
<p><strong>Масиви даних (array)</strong> — схожі на матриці, але мають понад два виміри. Створюються вони за допомогою функції <code>array()</code>, де слід вказати вектор, з якого буде створено масив, і його розмірність:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>my_array <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>my_array</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 1</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    5</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    6</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]    3    7</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]    4    8</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 2</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    9   13</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]   10   14</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]   11   15</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]   12   16</span></span></code></pre></div>
</div>
<div id="r_list" class="section level3" number="1.5.4">
<h3 number="1.5.4"><span class="header-section-number">1.5.4</span> Списки</h3>
<p><strong>Списки</strong> — це впорядкований набір об’єктів. Я представляю собі списки, як блокнот, в якому на кожній сторінці зберігається інформація у певному форматі. Вони можуть зберігати різні дані, в тому числі вектори, матриці, дата фрейми й інші списки.</p>
<p>Списки створюються за допомогою функції <code>list()</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">vec =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">gendalf =</span> <span class="st">&quot;You shall not pass&quot;</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">my_matrix =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>my_list</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $vec</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3 4 5</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $gendalf</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;You shall not pass&quot;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $my_matrix</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    3</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    2    4</span></span></code></pre></div>
<p>В цьому випадку <code>vec</code>, <code>gendalf</code> та <code>my_matrix</code> — назви елементів списку.</p>
<p>Для звернення до елементів списку можна використовувати індекси або імена (через символ <code>$</code>). При зверненні через індекс необхідно використовувати подвійні квадратні дужки, наприклад:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="dv">2</span>]]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;You shall not pass&quot;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>my_list<span class="sc">$</span>gendalf</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;You shall not pass&quot;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="st">&#39;gendalf&#39;</span>]]</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;You shall not pass&quot;</span></span></code></pre></div>
<p>Списки досить часто використовуються в R, наприклад результати побудови математичних моделей, статистичних тестів зберігаються у вигляді списків. тож важливо вміти з ними працювати.</p>
</div>
<div id="r_dataframe" class="section level3" number="1.5.5">
<h3 number="1.5.5"><span class="header-section-number">1.5.5</span> Дата фрейми</h3>
<p>Нарешті ми перейшли до найголовнішого - <strong>дата фрейми (data frames)</strong>. Саме з такою структурою даних працюють найчастіше. Головною особливістю їх є те, що різні стовпчики можуть містити різний тип даних (але їх довжина має бути однаковою).
Для створення дата фрейму використовується функція <code>data.frame()</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Frodo&quot;</span>, <span class="st">&quot;Eowyn&quot;</span>, <span class="st">&quot;Legolas&quot;</span>, <span class="st">&quot;Arwen&quot;</span>),</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">51</span>, <span class="dv">24</span>, <span class="dv">2931</span>, <span class="dv">2700</span>),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">one_ring =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>my_df</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">sex</th>
<th align="right">age</th>
<th align="left">one_ring</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Frodo</td>
<td align="left">male</td>
<td align="right">51</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Eowyn</td>
<td align="left">female</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Legolas</td>
<td align="left">male</td>
<td align="right">2931</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Arwen</td>
<td align="left">female</td>
<td align="right">2700</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Переглянути структуру дата фрейму можна за допомогою функції <code>str()</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(my_df)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    4 obs. of  4 variables:</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ name    : chr  &quot;Frodo&quot; &quot;Eowyn&quot; &quot;Legolas&quot; &quot;Arwen&quot;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ sex     : chr  &quot;male&quot; &quot;female&quot; &quot;male&quot; &quot;female&quot;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ age     : num  51 24 2931 2700</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ one_ring: logi  TRUE FALSE FALSE FALSE</span></span></code></pre></div>
<p>В нашому випадку перший та другий стовпчик - <em>текстові</em>, третя - <em>числова</em>, четверта - <em>логічна</em>.</p>
<p>Переглянути назви стовпців або надати їм нову назву можна за допомогою функції <code>names()</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(my_df)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;name&quot;     &quot;sex&quot;      &quot;age&quot;      &quot;one_ring&quot;</span></span></code></pre></div>
<p>Індексація аналогічно до матриці та списків можлива через <code>[]</code> та знак <code>$</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>my_df<span class="sc">$</span>name</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Frodo&quot;   &quot;Eowyn&quot;   &quot;Legolas&quot; &quot;Arwen&quot;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>my_df<span class="sc">$</span>name[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Eowyn&quot;   &quot;Legolas&quot;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>my_df[<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 24</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>my_df[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">&quot;name&quot;</span>]</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Eowyn&quot;   &quot;Legolas&quot;</span></span></code></pre></div>
<p>Для перегляду дата фрейму в RStudio використовується функція <code>View()</code> або можна просто натиснути на назву змінної у розділі Environment. Ви побачите таблицю, дещо схожу на Excel або Google Spreadsheets.</p>
</div>
<div id="r_factors" class="section level3" number="1.5.6">
<h3 number="1.5.6"><span class="header-section-number">1.5.6</span> Фактори</h3>
<p>Фактори (<code>factor</code>) - спеціальний клас даних для збереження номінативних (якісних) змінних. Це можуть бути групи клієнтів, стать, якість обслуговування тощо.</p>
<p>Для створення таких змінних використовується функція <code>factor()</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>race <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;istari&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;human&quot;</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;elf&quot;</span>, <span class="st">&quot;dwarf&quot;</span>, <span class="st">&quot;hobbit&quot;</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hobbit&quot;</span>, <span class="st">&quot;hobbit&quot;</span>, <span class="st">&quot;hobbit&quot;</span>),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;istari&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;elf&quot;</span>, <span class="st">&quot;dwarf&quot;</span>, <span class="st">&quot;hobbit&quot;</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>race</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] istari human  human  elf    dwarf  hobbit hobbit hobbit hobbit</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Levels: istari human elf dwarf hobbit</span></span></code></pre></div>
<p>При цьому всередині факторів можна зберігати впорядковані номінативні дані. Для цього необхідно вказати аргумент <code>ordered = TRUE</code>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lotr_books <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;The Fellowship of the Ring&quot;</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;The Return of the King&quot;</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;The Two Towers&quot;</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;The Fellowship of the Ring&quot;</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;The Two Towers&quot;</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;The Return of the King&quot;</span>),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>lotr_books</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] The Fellowship of the Ring The Return of the King    </span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] The Two Towers            </span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Levels: The Fellowship of the Ring &lt; ... &lt; The Return of the King</span></span></code></pre></div>
</div>
</div>
<div id="r_packages" class="section level2" number="1.6">
<h2 number="1.6"><span class="header-section-number">1.6</span> Пакети в R</h2>
<hr />
<p>R - мова програмування з дуже широкими можливостями. Однак рано чи пізно ми почнемо стикатися з задачами, які потребуватимуть додаткових можливостей. Ці можливості можна розширити за допомогою додаткових <strong>пакетів (packages)</strong>.</p>
<p>В більшості випадків основним змістом пакетів є набір додаткових функцій, даних або нових структур даних.</p>
<p>До найпопулярніших пакетів у сфері науки про дані (data science) можна віднести екосистему пакетів <strong>tidyverse</strong>, пакети <strong>data.table</strong>, <strong>mlr3</strong> та ще багато-багато інших.</p>
<div id="r_base_packages" class="section level3" number="1.6.1">
<h3 number="1.6.1"><span class="header-section-number">1.6.1</span> Вбудовані пакети</h3>
<p>Разом з самою мовою програмування R поставляються пакети, які не потрібно встановлювати: основний <code>base</code> та декілька інших, такі як <code>stats</code>, <code>utils</code>, <code>graphics</code> та інші. Повний перелік можна переглянути за наступним кодом:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(<span class="fu">installed.packages</span>(<span class="at">priority =</span> <span class="st">&quot;base&quot;</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;base&quot;      &quot;compiler&quot;  &quot;datasets&quot;  &quot;graphics&quot;  &quot;grDevices&quot; &quot;grid&quot;     </span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] &quot;methods&quot;   &quot;parallel&quot;  &quot;splines&quot;   &quot;stats&quot;     &quot;stats4&quot;    &quot;tcltk&quot;    </span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &quot;tools&quot;     &quot;utils&quot;</span></span></code></pre></div>
</div>
<div id="r_cran" class="section level3" number="1.6.2">
<h3 number="1.6.2"><span class="header-section-number">1.6.2</span> Встановлення пакетів з CRAN</h3>
<p>Пакети які пройшли перевірку зберігаються в <strong>Comprehensive R Archive Network (CRAN)</strong>. Для перегляду кількості опублікованих пакетів на CRAN можна використати наступний код:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">available.packages</span>())</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 18979</span></span></code></pre></div>
<p>І з кожним роком їх стає все більше:
<img src="docs/images/CRAN.png" width="100%" />
Функція <code>install.packages()</code> дозволяє звантажувати та встановлювати пакети з CRAN. Для прикладу встановимо пакет <code>vroom</code>, для зчитування файлів</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;vroom&quot;</span>)</span></code></pre></div>
Інший спосіб встановлення пакетів - через окреме меню <strong>Tools -&gt; Install Packages</strong> (рис.@ref(fig:062))
<div class="figure">
<img src="docs/images/002_install_pack.png" alt="Меню встановлення пакетів в RStudio" width="45%" />
<p class="caption">
(#fig:062)Меню встановлення пакетів в RStudio
</p>
</div>
<p>Або через кнопку в розділі <strong>Packages</strong> (рис. @ref(fig:063))</p>
<div class="figure">
<img src="docs/images/003_install_pack.png" alt="Кнопка встановлення пакетів" width="60%" />
<p class="caption">
(#fig:063)Кнопка встановлення пакетів
</p>
</div>
Після чого з’явиться меню (рис. @ref(fig:064)) в якому можна вказати назву потрібного пакету. Бажано залишити галочку <strong>“install dependencies”</strong>, оскільки деякі пакети мають залежність від інших пакетів і їх також слід встановити. Може статися ситуація, коли завантажуючи один пакет разом з ним буде додатково встановлено ще десятки інших.
присоювання
<div class="figure">
<img src="docs/images/004_install_pack.png" alt="Меню встановлення пакетів" width="50%" />
<p class="caption">
(#fig:064)Меню встановлення пакетів
</p>
</div>
</div>
<div id="r_git" class="section level3" number="1.6.3">
<h3 number="1.6.3"><span class="header-section-number">1.6.3</span> Встановлення пакетів з GitHub</h3>
<p>Бувають випадки, коли автори пакетів не пройшли або не захотіли проходити перевірку через CRAN (насправді причин може бути безліч). В таких випадках пакет (який ви напевно знайшли через пошук в Google) скоріш за все буде зберігатися на репозиторію GitHub. Для таких випадків нам необхідно встановити пакет <code>devtools</code> та використати з нього функцію <code>install_github()</code>. Покажу на прикладі пакету <code>xaringan</code>, який я використовую для створення інтерактивних презентацій.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;yihui/xaringan&#39;</span>)</span></code></pre></div>
<p>Посилання <code>yihui/xaringan</code> — це адреса пакету в <a href="https://github.com/yihui/xaringan">GitHub</a></p>
</div>
<div id="r_lib" class="section level3" number="1.6.4">
<h3 number="1.6.4"><span class="header-section-number">1.6.4</span> Підключення пакетів</h3>
<p>Після завантаження пакета, для того щоб почати користуватися його функціоналом необхідно його підключити до поточної сесії. Для цього використовується функція <code>library()</code>. Назву пакету можна писати як в лапках так і без них.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vroom)</span></code></pre></div>
<p>Як правило, підключення пакетів записується на початку скрипта, що дає можливість зрозуміти який інструментарій використовується в ньому.</p>
</div>
<div id="r_fun_call" class="section level3" number="1.6.5">
<h3 number="1.6.5"><span class="header-section-number">1.6.5</span> Виклик функції через <code>::</code></h3>
<p>У випадках, коли функцію з пакету буде використано вcього декілька разів, є сенс не підключати весь пакет, а завантажити тільки окрему його функцію. Для цього використовується спеціальний оператор <code>::</code>, ліворуч від якого вказується назва пакету, а праворуч відповідна функція з обраного пакету.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>vroom<span class="sc">::</span><span class="fu">vroom_example</span>()</span></code></pre></div>
<p>Крім того оператор <code>::</code> корисний у випадках, коли в різних пакетах присутні функції з однаковою назвою. Наприклад в пакеті <code>dplyr</code> є функція <code>filter()</code>. Функція з такою ж назвою є в базовому пакеті <code>stats</code>, який використовується у зовсім інших задачах. В таких просто вкажіть з якого пакету ви хочете використати функцію:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">filter</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code></pre></div>
<p>Пріоритет надається функціоналу пакету, який був підключений останній.</p>
<!--chapter:end:01-intro.Rmd-->
</div>
</div>
</div>
<div id="dplyr" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Маніпуляції з даними за допомогою dplyr і не тільки</h1>
<hr />
<p>В минулій главі ми розібрали основні принципи мови програмування R. І тут слід зазначити, що окрім базового синтаксису існують й інші. Загалом, можна виділити три основні діалекти в мові програмування R:</p>
<ul>
<li><p>base: основний фундамент мови, який ми розібрали (але не повністю) раніше.</p></li>
<li><p>Tidyverse: окремий напрямок розвитку мови програмування R, що сконцентрований у напрямку науки про дані (data science).</p></li>
<li><p>data.table: альтернативний напрямок, який дозволяє оброблювати об’ємні масиви даних за рекордний час <span class="citation"><a href="#ref-h2obench" role="doc-biblioref"><span>“Database-Like Ops Benchmark”</span></a> (<a href="#ref-h2obench" role="doc-biblioref">2022</a>)</span>.</p></li>
</ul>
<p>Їх можна сміло поєднувати в своїх проектах, що значним чином підвищує ефективність та швидкість роботи.</p>
<div id="tidy" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Tidy-всесвіт</h2>
<hr />
<p><a href="https://www.tidyverse.org/"><strong>Tidyverse</strong></a> — це екосистема, набір пакетів, які спеціально створені для науки про дані (data science). В ньому є ключові пакети (ядро tidyverse) та побічні — які додатково розширюють можливості мови програмування R.</p>
<p><strong>Концепція охайних даних (tidy-data)</strong> передбачає приведення даних до формату, в якому:</p>
<ul>
<li><p>Кожна змінна міститься в окремому стовпчику</p></li>
<li><p>Кожне спостереження міститься в окремому рядку</p></li>
<li><p>Кожне значення міститься в окремій комірці</p></li>
</ul>
<p><strong>Ядро tidyverse:</strong></p>
<ul>
<li><p><em>ggplot2</em>, для візуалізації</p></li>
<li><p><em>dplyr</em>, для маніпуляції з даними</p></li>
<li><p><em>tidyr</em>, для отримання охайних даних (tidy data)</p></li>
<li><p><em>readr</em>, для зчитування та записування файлів в R</p></li>
<li><p><em>purrr</em>, для функціонального програмування</p></li>
<li><p><em>tibble</em>, для роботи з тібблами (tibble), просунутий варіант дата фреймів</p></li>
<li><p><em>stringr</em>, для роботи з текстовими даними</p></li>
<li><p><em>forcats</em>, для роботи з факторами (factors)</p></li>
</ul>
<p>Крім того є ще низка допоміжних пакетів, які не входять до ядра tidyverse але вважаються його частиною:</p>
<ul>
<li><p><em>vroom</em>, для швидкого завантаження даних</p></li>
<li><p><em>DBI</em>, для роботи з базами даних</p></li>
<li><p><em>haven</em>, для даних SPSS, Stata та SAS</p></li>
<li><p><em>httr</em>, для роботи з API</p></li>
<li><p><em>readxl</em> для завантаження .xls та .xlsx файлів</p></li>
<li><p><em>googlesheets4</em>, для роботи з Google Sheet</p></li>
<li><p><em>googledrive</em>, для роботи з Google Drive</p></li>
<li><p><em>rvest</em>, для скрапінгу веб-сторінок</p></li>
<li><p><em>jsonlite</em>, для роботи з JSON-файлами</p></li>
<li><p><em>xml2</em>, для роботи з XML</p></li>
<li><p><em>lubridate</em>, для роботи з датами</p></li>
<li><p><em>dbplyr</em>, для перетворення коду <code>dplyr</code> в SQL</p></li>
<li><p><em>dtplyr</em>, для перетворення коду на <code>data.table</code></p></li>
<li><p><em>magrittr</em>, для використання конвеєрів <code>%&gt;%</code> (pipe)</p></li>
<li><p><em>glue</em>, для поєднання даних та тексту</p></li>
<li><p><em>tidymodels</em>, для роботи з моделями машнинного навчання.</p></li>
</ul>
<p>І це ще не повний список. Крім офіційних пакетів tidyverse є ще низка пакетів, які намагаються відповідати принципам tidyverse і доповнюють його.</p>
<p>Головним чином, для роботи з даними, я зосереджу свою увагу на роботі з пакетом <code>dplyr</code>.</p>
<p>Для завантаження tidyverse необхідно виконати наступний код:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>Для підключення:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>Концепція “охайних” даних передбачає альтернативу класичним <code>data.frame</code> у вигляді тібблів (<code>tibble</code>). Давайте розеберемо основі відмінності.
В мові програмування R є вбудований популярний датасет <code>iris</code>. Він зберігається в форматі дата фрейму.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Переглянемо перші декілька значень</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>Давайте створемо його альтернативу у вигляді тібблу:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>iris_tbl <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(iris)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>iris_tbl</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 150 x 5</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="do">##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1          5.1         3.5          1.4         0.2 setosa </span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2          4.9         3            1.4         0.2 setosa </span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3          4.7         3.2          1.3         0.2 setosa </span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4          4.6         3.1          1.5         0.2 setosa </span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5          5           3.6          1.4         0.2 setosa </span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6          5.4         3.9          1.7         0.4 setosa </span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7          4.6         3.4          1.4         0.3 setosa </span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8          5           3.4          1.5         0.2 setosa </span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9          4.4         2.9          1.4         0.2 setosa </span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10          4.9         3.1          1.5         0.1 setosa </span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 140 more rows</span></span></code></pre></div>
<p>Вже на цьому етапі видні основні відмінності: тіббл відображає одразу перші 10 спостережень і всі ствопчики, які поміщаються на екрані. Крім того до кожного стовпчика вказується його тип. Це дуже зручно, особливо коли працюєте з великим об’ємом даних.</p>
</div>
<div id="tidy_read" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Завантаження даних</h2>
<hr />
<div id="tidy_csv" class="section level3" number="2.2.1">
<h3 number="2.2.1"><span class="header-section-number">2.2.1</span> Завантаження .csv, .tsv файлів</h3>
<p>Стандартною функцією завантаження даних типу <code>.csv</code> є функція <code>read.csv()</code>, але на досить великих масивах даних краще використовувати <code>read_csv()</code> з пакету <code>readr</code>. Синтаксис цих функцій схожий, але <code>read_csv()</code> одразу приведе дані до формату <code>tibble</code>.
Першим аргументом функції є шлях до файлу (із оберненим слешем <code>/</code>). Також можна використовувати прямі URL-посилання на файл:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>read_file <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;docs/data/file.csv&quot;</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>read_url <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://git.io/JztOr&quot;</span>)</span></code></pre></div>
<p>Аналогічно до <code>read_csv()</code> можна використовувати функцію <code>vroom</code> з однойменного пакету. Головною особливістю цього пакету є <a href="https://cran.r-project.org/web/packages/vroom/vignettes/benchmarks.html">швидкість завантаження даних</a>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>vroom_file <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="st">&quot;docs/data/file.csv&quot;</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>vroom_url <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="st">&quot;https://git.io/JztOr&quot;</span>)</span></code></pre></div>
<p>Для <strong>завантаження</strong> одночасно <strong>декількох файлів однакової структури</strong> корисно використовувати наступну конструкцію</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>filse <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.csv$&quot;</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>vroom_all <span class="ot">&lt;-</span> <span class="fu">vroom</span>(filse)</span></code></pre></div>
</div>
<div id="tidy_xls" class="section level3" number="2.2.2">
<h3 number="2.2.2"><span class="header-section-number">2.2.2</span> Завантаження .xls, .xlsx файлів</h3>
<p>Для завантаження файлів <strong>Excel</strong> використовується пакет <code>readxl</code> та функція <code>read_excel()</code>.
На початку можна отримати перелік листів файлу Excel за допомогою функції <code>excel_sheets()</code></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="st">&quot;docs/data/tourism.xlsx&quot;</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Sheet1&quot; &quot;Sheet2&quot; &quot;Sheet3&quot;</span></span></code></pre></div>
<p>Після чого зчитати данні з потрібного листа</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>excel_file <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;docs/data/tourism.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;Sheet1&quot;</span>)</span></code></pre></div>
<p>В більшості випадків цього інструментарію має бути достатньо, але для завантаження специфічних файлів завжди можна знайти потрібний пакет. Не соромтеся використовувати google.</p>
</div>
</div>
<div id="dplyr" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Маніпуляції з даними за допомогою пакету dplyr</h2>
<hr />
<p>dplyr - це граматика маніпуляції з даними, яка має низку функцій, які допоможуть легко та зручно маніпулювати даними, наприклад:</p>
<ul>
<li><p>створювати нові змінні</p></li>
<li><p>сортувати дані</p></li>
<li><p>проводити фільтрацію даних</p></li>
<li><p>агрегування даних і багато іншого.</p></li>
</ul>
<p>В якості прикладу роботи з пакетом dplyr пропоную використати датасет <code>gapminder</code> з однойменного пакету. В ньому збережена інформація про ВВП, очікувану тривалість життя при народженні та населення для 142 країн світу з 1952 по 2007 роки.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Підключаємо пакет (не забудьте його встановити) та подивимось на датасет</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Видно, що змінні <code>country</code> та <code>continent</code> — це фактори, а всі інші — числові.</p>
<div id="glimpse" class="section level3" number="2.3.1">
<h3 number="2.3.1"><span class="header-section-number">2.3.1</span> dplyr::glimpse()</h3>
<p>Для перегляду структури тібблу використовується функція <code>glimpse()</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gapminder)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 1,704</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 6</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $ country   &lt;fct&gt; &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, ~</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, ~</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ~</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8~</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12~</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, ~</span></span></code></pre></div>
<p>Це альтернатива базовій функції <code>str()</code> для дата фреймів.</p>
</div>
<div id="filter" class="section level3" number="2.3.2">
<h3 number="2.3.2"><span class="header-section-number">2.3.2</span> dplyr::filter()</h3>
<p>Для фільтрації спостережень за певною умовою використовується функція <code>filter()</code>. Для прикладу відфільтруємо дані для Ірландії:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">&quot;Ireland&quot;</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 6</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    country continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Ireland Europe     1952    66.9 2952156     5210.</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Ireland Europe     1957    68.9 2878220     5599.</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Ireland Europe     1962    70.3 2830000     6632.</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Ireland Europe     1967    71.1 2900100     7656.</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Ireland Europe     1972    71.3 3024400     9531.</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Ireland Europe     1977    72.0 3271900    11151.</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Ireland Europe     1982    73.1 3480000    12618.</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Ireland Europe     1987    74.4 3539900    13873.</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Ireland Europe     1992    75.5 3557761    17559.</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Ireland Europe     1997    76.1 3667233    24522.</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Ireland Europe     2002    77.8 3879155    34077.</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Ireland Europe     2007    78.9 4109086    40676.</span></span></code></pre></div>
<p>І тут я одразу хочу познайомити вас з альтернативним варіантом запису коду в синтаксисі tidyverse. Справа в тому, що якщо послідовно використовувати низку різноманітних функцій, то читаймість такого коду стає дуже низькою. Покажу на прикладі:</p>
<ol style="list-style-type: decimal">
<li><p>До кожного значення вектора від 1 до 10 з кроком 1 розрахуємо сінус.</p></li>
<li><p>З отриманого на першому кроці візьмемо абсолютні значення.</p></li>
<li><p>З отриманого результату на 2 кроці візьмемо корінь квадратний</p></li>
<li><p>Відсортуємо результат.</p></li>
</ol>
<p>В класичному вигляді все виглядає наступним чином:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">sin</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] 0.3756594 0.5285977 0.6419646 0.7375779 0.8105471 0.8699440 0.9173173</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] 0.9535709 0.9792468 0.9946649</span></span></code></pre></div>
<p>Погодьтесь, що розібрати такий код досить складно. Тому в діалекті tidyverse використовуються пайпи, <code>%&gt;%</code>, (pipe) — вони передають результат попереднього розрахунку першим аргументов наступної функції. Таким чином попередній код можна переписати наступним чином:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] 0.3756594 0.5285977 0.6419646 0.7375779 0.8105471 0.8699440 0.9173173</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] 0.9535709 0.9792468 0.9946649</span></span></code></pre></div>
<p>Погодьтесь, що такий код читається значно легше. Для виклику оператора <code>%&gt;%</code> в RStudio використовується комбінація клавіш CTRL + SHIFT + M для Windows і CMD + SHIFT + M для Mac.</p>
<p>Тож, якщо повернутися до фільтрації @ref(filter), код можна переписати:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Попередній варіант</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">&quot;Ireland&quot;</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 6</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Ireland Europe     1952    66.9 2952156     5210.</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Ireland Europe     1957    68.9 2878220     5599.</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Ireland Europe     1962    70.3 2830000     6632.</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Ireland Europe     1967    71.1 2900100     7656.</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Ireland Europe     1972    71.3 3024400     9531.</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Ireland Europe     1977    72.0 3271900    11151.</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Ireland Europe     1982    73.1 3480000    12618.</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Ireland Europe     1987    74.4 3539900    13873.</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Ireland Europe     1992    75.5 3557761    17559.</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Ireland Europe     1997    76.1 3667233    24522.</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Ireland Europe     2002    77.8 3879155    34077.</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Ireland Europe     2007    78.9 4109086    40676.</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co"># З використанням %&gt;%</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Ireland&quot;</span>)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 6</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="do">##    country continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Ireland Europe     1952    66.9 2952156     5210.</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Ireland Europe     1957    68.9 2878220     5599.</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Ireland Europe     1962    70.3 2830000     6632.</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Ireland Europe     1967    71.1 2900100     7656.</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Ireland Europe     1972    71.3 3024400     9531.</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Ireland Europe     1977    72.0 3271900    11151.</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Ireland Europe     1982    73.1 3480000    12618.</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Ireland Europe     1987    74.4 3539900    13873.</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Ireland Europe     1992    75.5 3557761    17559.</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Ireland Europe     1997    76.1 3667233    24522.</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Ireland Europe     2002    77.8 3879155    34077.</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Ireland Europe     2007    78.9 4109086    40676.</span></span></code></pre></div>
<p>Тут і далі я буду часто використовувати пайпи.</p>
<p>Розберемо ще приклади фільтрації даних. Відберемо дані Ірландії та Іспанії за 2007 рік:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Ireland&quot;</span> <span class="sc">|</span> country <span class="sc">==</span> <span class="st">&quot;Spain&quot;</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">==</span> <span class="dv">2007</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 x 6</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   country continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Ireland Europe     2007    78.9  4109086    40676.</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Spain   Europe     2007    80.9 40448191    28821.</span></span></code></pre></div>
<p>А тепер припустимо, що нам потрібно відібрати інформацію не по двом, а по низці країн. Переліковувати їх всіх через <code>country == "Назва_країни"</code> буде дуже довго і не зручно. В таких випадках зручно використовувати оператор <code>%in%</code>. Давайте відберемо інформацію по Ірландії, Іспанії, Норвегії та Польщі за 2007 рік:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ireland&quot;</span>, <span class="st">&quot;Spain&quot;</span>, <span class="st">&quot;Norway&quot;</span>, <span class="st">&quot;Poland&quot;</span>),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">==</span> <span class="dv">2007</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 6</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   country continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Ireland Europe     2007    78.9  4109086    40676.</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Norway  Europe     2007    80.2  4627926    49357.</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Poland  Europe     2007    75.6 38518241    15390.</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Spain   Europe     2007    80.9 40448191    28821.</span></span></code></pre></div>
<p>Всі потрібні умови фільтрації можна переліковувати всередині функції <code>filter()</code> через кому.</p>
</div>
<div id="slice" class="section level3" number="2.3.3">
<h3 number="2.3.3"><span class="header-section-number">2.3.3</span> dplyr::slice()</h3>
<p>Для отримання зрізу даних, тобто тільки певних спостережень (перші, останні тощо) використовуються варіації функції <code>slice()</code>.</p>
<p>Перші п’ять спостережень:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 6</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Afghanistan Asia       1972    36.1 13079460      740.</span></span></code></pre></div>
<p>Перші п’ять та десяте спостереження:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 x 6</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Afghanistan Asia       1997    41.8 22227415      635.</span></span></code></pre></div>
<p>Всі крім перших трьох:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,701 x 6</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       2002    42.1 25268405      727.</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       2007    43.8 31889923      975.</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Albania     Europe     1952    55.2  1282697     1601.</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,691 more rows</span></span></code></pre></div>
<p>Перші 15 спостережень:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 15 x 6</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Afghanistan Asia       2002    42.1 25268405      727.</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Afghanistan Asia       2007    43.8 31889923      975.</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Albania     Europe     1952    55.2  1282697     1601.</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 Albania     Europe     1957    59.3  1476505     1942.</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 Albania     Europe     1962    64.8  1728137     2313.</span></span></code></pre></div>
<p>Останні 15 спостережень:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 15 x 6</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country  continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Zambia   Africa     1997    40.2  9417789     1071.</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Zambia   Africa     2002    39.2 10595811     1072.</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Zambia   Africa     2007    42.4 11746035     1271.</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Zimbabwe Africa     1952    48.5  3080907      407.</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Zimbabwe Africa     1957    50.5  3646340      519.</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Zimbabwe Africa     1962    52.4  4277736      527.</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Zimbabwe Africa     1967    54.0  4995432      570.</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Zimbabwe Africa     1972    55.6  5861135      799.</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Zimbabwe Africa     1977    57.7  6642107      686.</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Zimbabwe Africa     1982    60.4  7636524      789.</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Zimbabwe Africa     1987    62.4  9216418      706.</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Zimbabwe Africa     1992    60.4 10704340      693.</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Zimbabwe Africa     1997    46.8 11404948      792.</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 Zimbabwe Africa     2002    40.0 11926563      672.</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 Zimbabwe Africa     2007    43.5 12311143      470.</span></span></code></pre></div>
<p>Топ-3 з найбільшим значенням очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(lifeExp, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 6</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country          continent  year lifeExp       pop gdpPercap</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Japan            Asia       2007    82.6 127467972    31656.</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Hong Kong, China Asia       2007    82.2   6980412    39725.</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Japan            Asia       2002    82   127065841    28605.</span></span></code></pre></div>
<p>Топ-3 з найменшим значенням очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(lifeExp, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 6</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country     continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Rwanda      Africa     1992    23.6 7290203      737.</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Afghanistan Asia       1952    28.8 8425333      779.</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Gambia      Africa     1952    30    284320      485.</span></span></code></pre></div>
<p>Проста випадкова вибірка без повернення з трьох країн:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 6</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Serbia      Europe     1957    61.7  7271135     4981.</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Italy       Europe     1967    71.1 52667100    10022.</span></span></code></pre></div>
<p>Зверніть увагу, що при повторному виконанні попереднього коду ви будете отримувати кожного разу різні підвибірки. Для того щоб отримати відтворюваний результат, необхідно вказати початкове значення генератора випадкових чисел за допомогою функції <code>set.seed()</code>. Аргументом цієї функції може бути будь-яке ціле число.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 6</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   country   continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Cambodia  Asia       2007    59.7 14131858     1714.</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Swaziland Africa     1982    55.6   649901     3895.</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Kenya     Africa     1982    58.8 17661452     1348.</span></span></code></pre></div>
<p>Для формування простої випадкової вибірки з поверненням з трьох країн, необхідно додати аргумент <code>replace = TRUE</code>:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 6</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   country continent  year lifeExp        pop gdpPercap</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 India   Asia       2007    64.7 1110396331     2452.</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Italy   Europe     1977    73.5   56059245    14256.</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 India   Asia       1982    56.6  708000000      856.</span></span></code></pre></div>
</div>
<div id="arrange" class="section level3" number="2.3.4">
<h3 number="2.3.4"><span class="header-section-number">2.3.4</span> dplyr::arrange()</h3>
<p>Для впорядкування даних використовується функція <code>arrange()</code>. За замовчуванням сортування даних відбувається за зростанням.
Сортування по змінній ВВП на душу населення:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gdpPercap)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country          continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Congo, Dem. Rep. Africa     2002    45.0 55379852      241.</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Congo, Dem. Rep. Africa     2007    46.5 64606759      278.</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Lesotho          Africa     1952    42.1   748747      299.</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Guinea-Bissau    Africa     1952    32.5   580653      300.</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Congo, Dem. Rep. Africa     1997    42.6 47798986      312.</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Eritrea          Africa     1952    35.9  1438760      329.</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Myanmar          Asia       1952    36.3 20092996      331 </span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Lesotho          Africa     1957    45.0   813338      336.</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Burundi          Africa     1952    39.0  2445618      339.</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Eritrea          Africa     1957    38.0  1542611      344.</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Для того щоб сотувати дані за спаданням, використовується додаткова функція <code>desc()</code> в середині <code>arrange()</code>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gdpPercap))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country   continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Kuwait    Asia       1957    58.0  212846   113523.</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Kuwait    Asia       1972    67.7  841934   109348.</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Kuwait    Asia       1952    55.6  160000   108382.</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Kuwait    Asia       1962    60.5  358266    95458.</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Kuwait    Asia       1967    64.6  575003    80895.</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Kuwait    Asia       1977    69.3 1140357    59265.</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Norway    Europe     2007    80.2 4627926    49357.</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Kuwait    Asia       2007    77.6 2505559    47307.</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Singapore Asia       2007    80.0 4553009    47143.</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Norway    Europe     2002    79.0 4535591    44684.</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Якщо сортування за спаданням виконується по одній змінній, замість <code>desc()</code> можна використати знак <code>-</code>:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Але працює це тільки у випадку використання однієї змінної!</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>gdpPercap)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country   continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Kuwait    Asia       1957    58.0  212846   113523.</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Kuwait    Asia       1972    67.7  841934   109348.</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Kuwait    Asia       1952    55.6  160000   108382.</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Kuwait    Asia       1962    60.5  358266    95458.</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Kuwait    Asia       1967    64.6  575003    80895.</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Kuwait    Asia       1977    69.3 1140357    59265.</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Norway    Europe     2007    80.2 4627926    49357.</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Kuwait    Asia       2007    77.6 2505559    47307.</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Singapore Asia       2007    80.0 4553009    47143.</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Norway    Europe     2002    79.0 4535591    44684.</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
</div>
<div id="select" class="section level3" number="2.3.5">
<h3 number="2.3.5"><span class="header-section-number">2.3.5</span> dplyr::select()</h3>
<p>У випадках, коли змінних у данних дуже багато, є сенс відібрати тільки ті, з якими ви будете працювати. В таких випадках нам допоможе функція <code>select()</code>, хоча тільки такими задачами вона не обмежується.
У нашому випадку в наборі даних лише шість змінних, що в принципі небагато, але суть функції буде зрозуміла.
Відберемо, наприклад змінні по країнам та населенню:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, pop)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 2</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country          pop</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;          &lt;int&gt;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan  8425333</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan  9240934</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan 10267083</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan 11537966</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan 13079460</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan 14880372</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan 12881816</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan 13867957</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan 16317921</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan 22227415</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Через двокрапку можна вказати послідовність з декількох стовпчиків для відбору:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, lifeExp<span class="sc">:</span>gdpPercap)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 4</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     lifeExp      pop gdpPercap</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;         &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan    28.8  8425333      779.</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan    30.3  9240934      821.</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan    32.0 10267083      853.</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan    34.0 11537966      836.</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan    36.1 13079460      740.</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan    38.4 14880372      786.</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan    39.9 12881816      978.</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan    40.8 13867957      852.</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan    41.7 16317921      649.</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan    41.8 22227415      635.</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Замість назв можна використовувати порядковий номер стовпчика (нагадую, що індексація в R починається з 1):</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 4</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     lifeExp      pop gdpPercap</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;         &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan    28.8  8425333      779.</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan    30.3  9240934      821.</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan    32.0 10267083      853.</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan    34.0 11537966      836.</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan    36.1 13079460      740.</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan    38.4 14880372      786.</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan    39.9 12881816      978.</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan    40.8 13867957      852.</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan    41.7 16317921      649.</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan    41.8 22227415      635.</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Коли змінних дійсно багато, простіше вказати змінні, які хочеться викинути. Для цього використовується знак <code>-</code> (для відкидання однієї змінної) і <code>!</code> (для декількох, які необхідно помістити у вектор). Відкинемо змінну континенту:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Відкидаємо одну змінну за допомогою `-`</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>continent)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 5</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country      year lifeExp      pop gdpPercap</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan  1952    28.8  8425333      779.</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan  1957    30.3  9240934      821.</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan  1962    32.0 10267083      853.</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan  1967    34.0 11537966      836.</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan  1972    36.1 13079460      740.</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan  1977    38.4 14880372      786.</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan  1982    39.9 12881816      978.</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan  1987    40.8 13867957      852.</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan  1992    41.7 16317921      649.</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan  1997    41.8 22227415      635.</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Відкинемо змінну континенту та населення:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Відкидаємо декілька змінних за допомогою `!`</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(continent, pop))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 4</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country      year lifeExp gdpPercap</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan  1952    28.8      779.</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan  1957    30.3      821.</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan  1962    32.0      853.</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan  1967    34.0      836.</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan  1972    36.1      740.</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan  1977    38.4      786.</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan  1982    39.9      978.</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan  1987    40.8      852.</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan  1992    41.7      649.</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan  1997    41.8      635.</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Крім того, за допомогою функцій <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code> та <code>matches()</code> ми можемо задавати специфічні умови відбору змінних.
Для відбору стовпчиків, які починаються на певний вираз використовується <code>starts_with()</code>. Відберемо змінні, які починаються на <strong><em>co</em></strong>:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;c&quot;</span>))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 2</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;    </span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia     </span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia     </span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia     </span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia     </span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia     </span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia     </span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia     </span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia     </span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia     </span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia     </span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Змінні, які закінчуються на англійську літеру <strong><em>p</em></strong>:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;p&quot;</span>))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 3</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    lifeExp      pop gdpPercap</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1    28.8  8425333      779.</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2    30.3  9240934      821.</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3    32.0 10267083      853.</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4    34.0 11537966      836.</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5    36.1 13079460      740.</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6    38.4 14880372      786.</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7    39.9 12881816      978.</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8    40.8 13867957      852.</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9    41.7 16317921      649.</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10    41.8 22227415      635.</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Змінні, які містять англійську літеру <strong><em>x</em></strong>:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;x&quot;</span>))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 1</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    lifeExp</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1    28.8</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2    30.3</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3    32.0</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4    34.0</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5    36.1</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6    38.4</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7    39.9</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8    40.8</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9    41.7</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10    41.8</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>При роботі з даними часто використовуються <a href="https://en.wikipedia.org/wiki/Regular_expression">регулярні вирази</a> (<em>regular expression</em>). Це певні патерни тексту, які відповідають певній умові. Ми можемо використовувати їх при відборі змінних за допомогою функції <code>matches()</code>.
Наприклад відберемо стовпчики, які в назві містять літери <strong><em>op</em></strong> або <strong><em>ap</em></strong>:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;[oa]p&quot;</span>))</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 2</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="do">##         pop gdpPercap</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="do">##       &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  8425333      779.</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  9240934      821.</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 10267083      853.</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 11537966      836.</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 13079460      740.</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 14880372      786.</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 12881816      978.</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 13867957      852.</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 16317921      649.</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 22227415      635.</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Для більш детального ознайомлення з цією темою рекомендую роботу <span class="citation"><a href="#ref-friedl2006" role="doc-biblioref">Friedl</a> (<a href="#ref-friedl2006" role="doc-biblioref">2006</a>)</span>.</p>
<p>За допомогою функції <code>where()</code> можна обирати змінні за їх типом. Наприклад відберемо факторні змінні:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Зверніть увагу, що умова &quot;is.factor&quot; </span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># вживається без дужок в середині where()</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor))</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 2</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;    </span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia     </span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia     </span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia     </span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia     </span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia     </span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia     </span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia     </span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia     </span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia     </span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia     </span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Або залишимо тільки числові змінні:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 4</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="do">##     year lifeExp      pop gdpPercap</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1952    28.8  8425333      779.</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1957    30.3  9240934      821.</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1962    32.0 10267083      853.</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1967    34.0 11537966      836.</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1972    36.1 13079460      740.</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1977    38.4 14880372      786.</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1982    39.9 12881816      978.</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1987    40.8 13867957      852.</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1992    41.7 16317921      649.</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  1997    41.8 22227415      635.</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Але і це ще не все: за допомогою функції <code>select()</code> та <code>everything()</code> можна змінювати позиції змінних у наборі даних. Спочатку ми вказуємо змінні, які хочемо помістити першими, після чого пишемо <code>everything()</code>. Наприклад, помістимо всі числові змінні на початку:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric), <span class="fu">everything</span>())</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="do">##     year lifeExp      pop gdpPercap country     continent</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;    </span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1952    28.8  8425333      779. Afghanistan Asia     </span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1957    30.3  9240934      821. Afghanistan Asia     </span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1962    32.0 10267083      853. Afghanistan Asia     </span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1967    34.0 11537966      836. Afghanistan Asia     </span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1972    36.1 13079460      740. Afghanistan Asia     </span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1977    38.4 14880372      786. Afghanistan Asia     </span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1982    39.9 12881816      978. Afghanistan Asia     </span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1987    40.8 13867957      852. Afghanistan Asia     </span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1992    41.7 16317921      649. Afghanistan Asia     </span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  1997    41.8 22227415      635. Afghanistan Asia     </span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
</div>
<div id="relocate" class="section level3" number="2.3.6">
<h3 number="2.3.6"><span class="header-section-number">2.3.6</span> dplyr::relocate()</h3>
<p>Насправді в dplyr є окрема функція для гнучкої зміни позиції — <code>relocate()</code>. За замовчуванням вона поміщає вказані змінні на перші позиції:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(pop)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="do">##         pop country     continent  year lifeExp gdpPercap</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="do">##       &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  8425333 Afghanistan Asia       1952    28.8      779.</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  9240934 Afghanistan Asia       1957    30.3      821.</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 10267083 Afghanistan Asia       1962    32.0      853.</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 11537966 Afghanistan Asia       1967    34.0      836.</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 13079460 Afghanistan Asia       1972    36.1      740.</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 14880372 Afghanistan Asia       1977    38.4      786.</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 12881816 Afghanistan Asia       1982    39.9      978.</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 13867957 Afghanistan Asia       1987    40.8      852.</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 16317921 Afghanistan Asia       1992    41.7      649.</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 22227415 Afghanistan Asia       1997    41.8      635.</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>У функції <code>relocate()</code> є два додаткових аргументи: <code>.before()</code> та <code>.after()</code>. Вони використовуються для вказування місця зміни позиції стовпчика:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Помістимо стовпчик continent після year</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(continent, <span class="at">.after =</span> year)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country      year continent lifeExp      pop gdpPercap</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan  1952 Asia         28.8  8425333      779.</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan  1957 Asia         30.3  9240934      821.</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan  1962 Asia         32.0 10267083      853.</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan  1967 Asia         34.0 11537966      836.</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan  1972 Asia         36.1 13079460      740.</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan  1977 Asia         38.4 14880372      786.</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan  1982 Asia         39.9 12881816      978.</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan  1987 Asia         40.8 13867957      852.</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan  1992 Asia         41.7 16317921      649.</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan  1997 Asia         41.8 22227415      635.</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Помістимо стовпчик continent після year</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(lifeExp, <span class="at">.before =</span> gdpPercap)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year      pop lifeExp gdpPercap</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952  8425333    28.8      779.</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957  9240934    30.3      821.</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962 10267083    32.0      853.</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967 11537966    34.0      836.</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972 13079460    36.1      740.</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977 14880372    38.4      786.</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982 12881816    39.9      978.</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987 13867957    40.8      852.</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992 16317921    41.7      649.</span></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997 22227415    41.8      635.</span></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Можна переміщати й одразу цілі групи:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Помістимо всі цілочислові змінні після факторних</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.integer), <span class="at">.after =</span> <span class="fu">where</span>(is.factor))</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year      pop lifeExp gdpPercap</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952  8425333    28.8      779.</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957  9240934    30.3      821.</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962 10267083    32.0      853.</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967 11537966    34.0      836.</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972 13079460    36.1      740.</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977 14880372    38.4      786.</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982 12881816    39.9      978.</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987 13867957    40.8      852.</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992 16317921    41.7      649.</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997 22227415    41.8      635.</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Помістимо всі факторні змінні після числових</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.numeric), <span class="at">.before =</span> <span class="fu">where</span>(is.factor))</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     year lifeExp      pop gdpPercap country     continent</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;    </span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1952    28.8  8425333      779. Afghanistan Asia     </span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1957    30.3  9240934      821. Afghanistan Asia     </span></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1962    32.0 10267083      853. Afghanistan Asia     </span></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1967    34.0 11537966      836. Afghanistan Asia     </span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1972    36.1 13079460      740. Afghanistan Asia     </span></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1977    38.4 14880372      786. Afghanistan Asia     </span></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1982    39.9 12881816      978. Afghanistan Asia     </span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1987    40.8 13867957      852. Afghanistan Asia     </span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1992    41.7 16317921      649. Afghanistan Asia     </span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  1997    41.8 22227415      635. Afghanistan Asia     </span></span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
</div>
<div id="rename" class="section level3" number="2.3.7">
<h3 number="2.3.7"><span class="header-section-number">2.3.7</span> dplyr::rename()</h3>
<p>Настав час ознайомитися, як змінювати назви стовпчиків. І в цьому нам допоможе функція <code>rename()</code>.
Змінємо назву стовпчика <code>pop</code> на <code>population</code>:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Спочатку вказуємо нову назву, а після стару</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> pop)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp population gdpPercap</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8    8425333      779.</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3    9240934      821.</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0   10267083      853.</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0   11537966      836.</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1   13079460      740.</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4   14880372      786.</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9   12881816      978.</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8   13867957      852.</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7   16317921      649.</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8   22227415      635.</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Можна змінювати регістр назв за допомогою функцій <code>rename_with()</code> та <code>toupper()</code> для запису великими літерами або <code>tolower()</code> для запису маленькими.</p>
<p>Запишемо всі назви великими:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(toupper)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    COUNTRY     CONTINENT  YEAR LIFEEXP      POP GDPPERCAP</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Згадуючи попередні розділи, можемо враховувати специфічні патерни:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(toupper, <span class="fu">ends_with</span>(<span class="st">&quot;p&quot;</span>))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year LIFEEXP      POP GDPPERCAP</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>В роботі досить часто постає питання заміни певної частини назви. Наприклад, прибрати пробіли або замінити їх певний символ. Оскільки в нашому прикладі з назвами все більш-менш нормально, я спеціально вставлю пробіли перед великими літерами в назвах стовпчиків. В цьому випадку нам знову приходять на допомогу регулярні вирази. Результат я збережу у змінній <code>gapminder_rename</code>:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>gapminder_rename <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">1 </span><span class="sc">\\</span><span class="st">2&quot;</span>, .x))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>gapminder_rename</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year `life Exp`      pop `gdp Percap`</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;      &lt;dbl&gt;    &lt;int&gt;        &lt;dbl&gt;</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952       28.8  8425333         779.</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957       30.3  9240934         821.</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962       32.0 10267083         853.</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967       34.0 11537966         836.</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972       36.1 13079460         740.</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977       38.4 14880372         786.</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982       39.9 12881816         978.</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987       40.8 13867957         852.</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992       41.7 16317921         649.</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997       41.8 22227415         635.</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Використання стовпчиків в назвах яких зустрічаються пробіли незручно. Тому давайте виправимо цю ситуацію. Покажу декілька варіантів. Перший варіант з використанням базової функції <code>gsub()</code>, де першим аргументом ми вказуємо спочатку що змінюємо, а другим - на що змінюємо.
Замінимо пробіли в назвах стовпчиків на знак підкреслення ("_"):</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Знак &quot;тільда&quot; (~) в R використовуються в якості формули,</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ми познайомимось з її використанням в наступних темах</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>gapminder_rename <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, .x))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year life_Exp      pop gdp_Percap</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952     28.8  8425333       779.</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957     30.3  9240934       821.</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962     32.0 10267083       853.</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967     34.0 11537966       836.</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972     36.1 13079460       740.</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977     38.4 14880372       786.</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982     39.9 12881816       978.</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987     40.8 13867957       852.</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992     41.7 16317921       649.</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997     41.8 22227415       635.</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Другий варіант варіант ближчий до синтаксису tidyverse і використовує функції з пакету <code>stringr</code>, який створений для роботи з текстом:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>gapminder_rename <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_to_title</span>())</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Country     Continent  Year Life_exp      Pop Gdp_percap</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952     28.8  8425333       779.</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957     30.3  9240934       821.</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962     32.0 10267083       853.</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967     34.0 11537966       836.</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972     36.1 13079460       740.</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977     38.4 14880372       786.</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982     39.9 12881816       978.</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987     40.8 13867957       852.</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992     41.7 16317921       649.</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997     41.8 22227415       635.</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
</div>
<div id="mutate" class="section level3" number="2.3.8">
<h3 number="2.3.8"><span class="header-section-number">2.3.8</span> dplyr::mutate()</h3>
<p>Майже жодна маніпуляція з даними не обходиться без створення нових стовпчиків. Для цього використовується функція <code>mutate()</code>. За замовчуванням нова змінна записується в кінці набору даних.
Давайте розрахуємо загальний ВВП кожної країни в певний момент часу. Для цього створимо нову змінну <code>gdp_billion</code> в якій перемножимо змінні “кількість населення” на “ВВП на душу населення” та поділимо на один мільярд:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> pop <span class="sc">*</span> gdpPercap <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 7</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap gdp_billion</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.        6.57</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.        7.59</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.        8.76</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.        9.65</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.        9.68</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.       11.7 </span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.       12.6 </span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.       11.8 </span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.       10.6 </span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.       14.1 </span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>За допомогою аргументів <code>.before</code> та <code>.after</code> можна змінювати й позицію запису нової змінної:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> pop <span class="sc">*</span> gdpPercap <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> year)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 7</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year gdp_billion lifeExp      pop gdpPercap</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952        6.57    28.8  8425333      779.</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957        7.59    30.3  9240934      821.</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962        8.76    32.0 10267083      853.</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967        9.65    34.0 11537966      836.</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972        9.68    36.1 13079460      740.</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977       11.7     38.4 14880372      786.</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982       12.6     39.9 12881816      978.</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987       11.8     40.8 13867957      852.</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992       10.6     41.7 16317921      649.</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997       14.1     41.8 22227415      635.</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Інколи необхідно свторити стовпчик індексів: порядковий номер спостереження. Для цього можна використати функцію <code>row_number()</code>:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">record =</span> <span class="fu">row_number</span>(),</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> country)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 7</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    record country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1      1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2      2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3      3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4      4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5      5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6      6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7      7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8      8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9      9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10     10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Або використати базовий синтаксис R:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">record =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> country)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 7</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    record country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1      1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2      2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3      3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4      4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5      5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6      6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7      7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8      8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9      9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10     10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Якщо ж хочется залишити лише розрахунковий стовпчик — використовується функція <code>transmute()</code>. При цьому вона дає можливість залишити й певні стовпчики з оригінального набору даних.</p>
<p>Залишимо змінну <code>country</code> та розрахуємо загальний ВВП:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(country,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">gdp_billion =</span> pop <span class="sc">*</span> gdpPercap <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 2</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     gdp_billion</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;             &lt;dbl&gt;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan        6.57</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan        7.59</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan        8.76</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan        9.65</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan        9.68</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan       11.7 </span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan       12.6 </span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan       11.8 </span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan       10.6 </span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan       14.1 </span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
</div>
<div id="group_by" class="section level3" number="2.3.9">
<h3 number="2.3.9"><span class="header-section-number">2.3.9</span> dplyr::group_by() та summarise()</h3>
<p>Ще однією популярною задачею є групування та агрегація даних: розрахунок певних статистик чи значень для окремих груп.
Для цього використовується функції <code>group_by()</code> та <code>summarise()</code>, які, як правило, використовуються разом.</p>
<p>Для прикладу, розрахуємо середню (<code>mean()</code>) очікувану тривалість життя для кожного континенту. Для цього спочатку групуємо дані, а потім розраховуємо статистичний показник, який назвемо <code>mean_life_exp</code>:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_life_exp =</span> <span class="fu">mean</span>(lifeExp))</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 2</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent mean_life_exp</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;             &lt;dbl&gt;</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa             48.9</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas           64.7</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia               60.1</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe             71.9</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania            74.3</span></span></code></pre></div>
<p>Аналогічно, ми можемо розраховувати одночасно декілька статистик. Додамо до розрахунку медіану (<code>median()</code>) та стандартне відхилення (<code>sd()</code>) очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_life_exp =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">md_life_exp =</span> <span class="fu">median</span>(lifeExp),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_life_exp =</span> <span class="fu">sd</span>(lifeExp))</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 4</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent mean_life_exp md_life_exp sd_life_exp</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa             48.9        47.8        9.15</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas           64.7        67.0        9.35</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia               60.1        61.8       11.9 </span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe             71.9        72.2        5.43</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania            74.3        73.7        3.80</span></span></code></pre></div>
<p>Слід звернути увагу, що всі зазначені вище статистики в R чутливі до пропущених значень: у разі їх наявності, функції будуть повертати <code>NA</code> (not available). Для того, щоб при розрахунку статистик не враховувались пропущені значення необхідно додати аргумент <code>na.rm = TRUE</code>.</p>
</div>
<div id="across" class="section level3" number="2.3.10">
<h3 number="2.3.10"><span class="header-section-number">2.3.10</span> dplyr::across()</h3>
<p>Але що, якщо нам необхідно розрахувати, наприклад, середні значення для всіх числових стовпчиків? Звичайно можна перерахувати їх всіх вручну:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_life_exp =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 4</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent mean_life_exp  mean_pop mean_gdpPercap</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;             &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa             48.9  9916003.          2194.</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas           64.7 24504795.          7136.</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia               60.1 77038722.          7902.</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe             71.9 17169765.         14469.</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania            74.3  8874672.         18622.</span></span></code></pre></div>
<p>Але якщо числових змінних багато — такий підхід буде неоптимальним.
В таких випадках краще скористатися функцією <code>across()</code>. Продемонструю декілька варіантів.</p>
<p>Для початку розрахуємо, як в попередньому прикладі, середні значення для числових змінних:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span> <span class="co"># прибираємо змінну року</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean))</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 4</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent lifeExp       pop gdpPercap</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa       48.9  9916003.     2194.</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas     64.7 24504795.     7136.</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia         60.1 77038722.     7902.</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe       71.9 17169765.    14469.</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania      74.3  8874672.    18622.</span></span></code></pre></div>
<p>Або можна перелічити потрібні змінні у векторі:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(lifeExp<span class="sc">:</span>gdpPercap, mean))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 4</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent lifeExp       pop gdpPercap</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa       48.9  9916003.     2194.</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas     64.7 24504795.     7136.</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia         60.1 77038722.     7902.</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe       71.9 17169765.    14469.</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania      74.3  8874672.    18622.</span></span></code></pre></div>
<p>Якщо уважно придивитися до результатів, то видно, що результати розрахунку повертаються з тими ж названими, як в оригінальному наборі даних. Якщо показати такий розрахунок третій стороні - можуть виникнути проблеми сприйняття. Як бути? Насправді функція <code>across()</code> досить гнучка і розробники передбачили такий варіант. Для цього нам знадобиться аргумент <code>.names</code>, де ми вкажемо правило запису назв результуючих змінних:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(lifeExp<span class="sc">:</span>gdpPercap,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>                   mean,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">&quot;mean_{.col}&quot;</span>))</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 4</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent mean_lifeExp  mean_pop mean_gdpPercap</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;            &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa            48.9  9916003.          2194.</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas          64.7 24504795.          7136.</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia              60.1 77038722.          7902.</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe            71.9 17169765.         14469.</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania           74.3  8874672.         18622.</span></span></code></pre></div>
<p>І навіть розрахунки декількох різних статистик теж можливий. Для цього їх перелік необхідно записати списоком в аргументів функції <code>across()</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(lifeExp<span class="sc">:</span>gdpPercap,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="at">avg =</span> mean, <span class="at">stdev =</span> sd, <span class="at">md =</span> median),</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">&quot;{.fn}_{.col}&quot;</span>))</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 10</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent avg_lifeExp stdev_lifeExp md_lifeExp   avg_pop  stdev_pop    md_pop</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa           48.9          9.15       47.8  9916003.  15490923.  4579311 </span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas         64.7          9.35       67.0 24504795.  50979430.  6227510 </span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia             60.1         11.9        61.8 77038722. 206885205. 14530830.</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe           71.9          5.43       72.2 17169765.  20519438.  8551125 </span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania          74.3          3.80       73.7  8874672.   6506342.  6403492.</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 3 more variables: avg_gdpPercap &lt;dbl&gt;, stdev_gdpPercap &lt;dbl&gt;,</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="do">## #   md_gdpPercap &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div id="count" class="section level3" number="2.3.11">
<h3 number="2.3.11"><span class="header-section-number">2.3.11</span> dplyr::count()</h3>
<p>Якщо нам необхідно порахувати кількість значень в групі, то це можна зробити за допомогою <code>group_by()</code> та <code>summarise()</code>. Підрахуємо кількість країн на кожному континенті у наборі даних. Оскільки для кожної країни є 12 спостережень (з 1952 по 2007 рік кожні 5 років), необхідно враховувати тільки унікальні значення - для таких випадків є функція <code>distinct()</code>:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(country) <span class="sc">%&gt;%</span> <span class="co"># унікальні значення</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 2</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent     n</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;     &lt;int&gt;</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa       52</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas     25</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia         33</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe       30</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania       2</span></span></code></pre></div>
<p>Але є простіший варіант - через функцію <code>count()</code>:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> n <span class="sc">/</span> <span class="dv">12</span>) <span class="co"># поправка на к-ть років</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 2</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   continent     n</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;     &lt;dbl&gt;</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Africa       52</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Americas     25</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Asia         33</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Europe       30</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Oceania       2</span></span></code></pre></div>
</div>
<div id="case" class="section level3" number="2.3.12">
<h3 number="2.3.12"><span class="header-section-number">2.3.12</span> dplyr::case_when()</h3>
<p>Яка маніпуляція з даними обходиться без конструкції “if - else?” В базовому синтаксисі R є функція <code>ifelse()</code> але я пропоную користуватися векторизованим варіантом з dplyr <code>case_when()</code>.
Для прикладу давайте створимо нову номінативну змінну, яка буде оцінювати середню очікувану тривалість життя в форматі “низька-середня-висока”:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_life_exp =</span> <span class="fu">mean</span>(lifeExp)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bin_life =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>      mean_life_exp <span class="sc">&gt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">&quot;hight&quot;</span>, <span class="co"># умова 1</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>      mean_life_exp <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> mean_life_exp <span class="sc">&lt;=</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">&quot;medium&quot;</span>, <span class="co"># умова 2</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;low&quot;</span> <span class="co"># для всіх інших випадків</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 142 x 3</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     mean_life_exp bin_life</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;               &lt;dbl&gt; &lt;chr&gt;   </span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan          37.5 low     </span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Albania              68.4 medium  </span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Algeria              59.0 medium  </span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Angola               37.9 low     </span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Argentina            69.1 medium  </span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Australia            74.7 hight   </span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Austria              73.1 hight   </span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bahrain              65.6 medium  </span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bangladesh           49.8 low     </span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Belgium              73.6 hight   </span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 132 more rows</span></span></code></pre></div>
</div>
<div id="pivot" class="section level3" number="2.3.13">
<h3 number="2.3.13"><span class="header-section-number">2.3.13</span> Обертання даних: pivot()</h3>
<p>Бувають випадки, коли дані приходять в “неохайному,” незручному форматі:</p>
<ul>
<li><p>одна змінна розташована у декількох стовпчиках.</p></li>
<li><p>одне спостереження може бути розкидане по кільком рядкам.</p></li>
</ul>
<p>Типовим прикладом таких даних можуть бути дані Всесвітнього банку. Давайте завантажимо їх і подивимось, як привести їх до “охайних.” В таких випадках нам допоможуть функції <code>pivot_longer()</code> та <code>pivot_wider()</code> з пакету <code>tidyr</code> (частина tidyverse).</p>
<p>В якості прикладу завантажимо інформацію по показнику Прямі іноземні інвестиції (Foreign direct investment, net (BoP, current US$)).</p>
Дані можна завантажити з мого репозитарію GitHub: <a href="https://raw.githubusercontent.com/Aranaur/datasets/main/datasets/world_bank/Foreign_direct_investment/FDI.csv">прямі іноземні інвестиції, дані Всісвітного банку</a>. Давайте переглянемо їх @ref(fig:wbimage).
<div class="figure" style="text-align: center">
<img src="docs/images/wb_01.png" alt="Перегляд перших значень набору даних Всесвытнього банку" width="100%" />
<p class="caption">
(#fig:wbimage)Перегляд перших значень набору даних Всесвытнього банку
</p>
</div>
<p>На що звертаємо увагу:</p>
<ul>
<li><p>Перші 4 рядочки неінформативні.</p></li>
<li><p>Дані зберігаються у “широкому форматі”: змінна року розташована горизонтально, що може ускладнити аналіз.</p></li>
</ul>
<p>Завантажимо дані і одразу пропустимо перші 4 рядки за допомогою аргументу <code>skip = 4</code>:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>fdi <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/Aranaur/datasets/main/datasets/world_bank/Foreign_direct_investment/FDI.csv&quot;</span>,</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>fdi</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 266 x 66</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    `Country Name` `Country Code` `Indicator Name` `Indicator Code` `1960` `1961`</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Aruba          ABW            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Africa Easter~ AFE            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan    AFG            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Africa Wester~ AFW            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Angola         AGO            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Albania        ALB            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Andorra        AND            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Arab World     ARB            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 United Arab E~ ARE            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Argentina      ARG            Foreign direct ~ BN.KLT.DINV.CD       NA     NA</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 256 more rows, and 60 more variables: `1962` &lt;dbl&gt;, `1963` &lt;dbl&gt;,</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1964` &lt;dbl&gt;, `1965` &lt;dbl&gt;, `1966` &lt;dbl&gt;, `1967` &lt;dbl&gt;, `1968` &lt;dbl&gt;,</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1969` &lt;dbl&gt;, `1970` &lt;dbl&gt;, `1971` &lt;dbl&gt;, `1972` &lt;dbl&gt;, `1973` &lt;dbl&gt;,</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1974` &lt;dbl&gt;, `1975` &lt;dbl&gt;, `1976` &lt;dbl&gt;, `1977` &lt;dbl&gt;, `1978` &lt;dbl&gt;,</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1979` &lt;dbl&gt;, `1980` &lt;dbl&gt;, `1981` &lt;dbl&gt;, `1982` &lt;dbl&gt;, `1983` &lt;dbl&gt;,</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1984` &lt;dbl&gt;, `1985` &lt;dbl&gt;, `1986` &lt;dbl&gt;, `1987` &lt;dbl&gt;, `1988` &lt;dbl&gt;,</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `1989` &lt;dbl&gt;, `1990` &lt;dbl&gt;, `1991` &lt;dbl&gt;, `1992` &lt;dbl&gt;, `1993` &lt;dbl&gt;, ...</span></span></code></pre></div>
<p>Використаємо функцію <code>pivot_longer()</code> для того щоб змінна року була окремим стовпчиком:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>fdi_longer <span class="ot">&lt;-</span> fdi <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># змінимо формат назв стовпчиків</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_to_lower</span>() <span class="sc">%&gt;%</span>  <span class="fu">str_replace</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># приберемо зайві</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(indicator_name, indicator_code)) <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># обертаємо дані</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(country_name, country_code), <span class="co"># використовуємо всі </span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>                                                        <span class="co"># крім country_name, country_code</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="co"># назва нового стовпчика </span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># (роки з початкового набору даних)</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fdi&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># назва нового стовпчика </span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="co"># (значення ПІІ до кожного року)</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="co"># приберемо пропущені значення</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>fdi_longer</span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6,473 x 4</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="do">##    country_name country_code year          fdi</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Aruba        ABW          1990  -130502793.</span></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Aruba        ABW          1991  -184748603.</span></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Aruba        ABW          1992    36983240.</span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Aruba        ABW          1993    17932961.</span></span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Aruba        ABW          1994    73184358.</span></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Aruba        ABW          1995     5530726.</span></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Aruba        ABW          1996   -84134078.</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Aruba        ABW          1997  -197597765.</span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Aruba        ABW          1998   -82178771.</span></span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Aruba        ABW          1999  -469329609.</span></span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 6,463 more rows</span></span></code></pre></div>
<p>З таким набором даних буде працювати значно зручніше.</p>
<p>Для прикладу роботи функції <code>pivot_wider()</code> повернемося до датасету <code>gapminder</code>:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Перевернемо його у широкий формат:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>gapminder_wide <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(lifeExp<span class="sc">:</span>gdpPercap))</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>gapminder_wide</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 142 x 38</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent lifeExp_1952 lifeExp_1957 lifeExp_1962 lifeExp_1967</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;            &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia              28.8         30.3         32.0         34.0</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Albania     Europe            55.2         59.3         64.8         66.2</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Algeria     Africa            43.1         45.7         48.3         51.4</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Angola      Africa            30.0         32.0         34           36.0</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Argentina   Americas          62.5         64.4         65.1         65.6</span></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Australia   Oceania           69.1         70.3         70.9         71.1</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Austria     Europe            66.8         67.5         69.5         70.1</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bahrain     Asia              50.9         53.8         56.9         59.9</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bangladesh  Asia              37.5         39.3         41.2         43.5</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Belgium     Europe            68           69.2         70.2         70.9</span></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 132 more rows, and 32 more variables: lifeExp_1972 &lt;dbl&gt;,</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a><span class="do">## #   lifeExp_1977 &lt;dbl&gt;, lifeExp_1982 &lt;dbl&gt;, lifeExp_1987 &lt;dbl&gt;,</span></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a><span class="do">## #   lifeExp_1992 &lt;dbl&gt;, lifeExp_1997 &lt;dbl&gt;, lifeExp_2002 &lt;dbl&gt;,</span></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a><span class="do">## #   lifeExp_2007 &lt;dbl&gt;, pop_1952 &lt;int&gt;, pop_1957 &lt;int&gt;, pop_1962 &lt;int&gt;,</span></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="do">## #   pop_1967 &lt;int&gt;, pop_1972 &lt;int&gt;, pop_1977 &lt;int&gt;, pop_1982 &lt;int&gt;,</span></span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a><span class="do">## #   pop_1987 &lt;int&gt;, pop_1992 &lt;int&gt;, pop_1997 &lt;int&gt;, pop_2002 &lt;int&gt;,</span></span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a><span class="do">## #   pop_2007 &lt;int&gt;, gdpPercap_1952 &lt;dbl&gt;, gdpPercap_1957 &lt;dbl&gt;, ...</span></span></code></pre></div>
<p>В переважній більшості випадків вам знадобиться довгий формат даних. Але при потребі зберігання великих файлів - краще зберігати у широкому форматі, оскільки це збереже місце на диску.</p>
<p>Збережемо результати широкого і довго формату набору даних <code>gapminder</code> та перевіремо їх розмір:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(gapminder, <span class="st">&quot;docs/data/gapminder.csv&quot;</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(gapminder_wide, <span class="st">&quot;docs/data/gapminder_wide.csv&quot;</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">file_size</span>(<span class="st">&quot;docs/data/gapminder.csv&quot;</span>)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 80.2K</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">file_size</span>(<span class="st">&quot;docs/data/gapminder_wide.csv&quot;</span>)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 47.3K</span></span></code></pre></div>
<p>Широкий формат в 1.7 рази менший.</p>
<!--chapter:end:02-dplyr.Rmd-->
</div>
</div>
</div>
<div id="simple_regression" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Проста лінійна регресія</h1>
<p><strong>Економетрика</strong> - це дисципліна, яка займається дослідженням взаємозв’язків між даними. Для цього нам знадобиться знання статистики, математики, економіки. Це може допомогти вирішити дві головні задачі дослідження:</p>
<ul>
<li><p>пояснити зв’язки: визначити які показники впливають сильніше на певні процеси, а які менше.</p></li>
<li><p>будувати прогнози: як буде розвиватися процес в подальшому або при інших умовах.</p></li>
</ul>
<p>Уявіть, що вам необхідно оцінити ефективність витрат рекламної компанії, тенденцію розвитку витрат виробництва, прогноз валового внутрішнього продукту тощо. На кожне з цих завдань може допомогти знайти відповідь економетрика, хоча з точки зору прогнозної сили, напевно, слід піти далі і звернутися до алгоритмів машинного навчання або нейронних мереж, хоча й там є свої особливості. На мою думку, економетрика на рівні зі статистикою - це чудовий фундамент для подальшого вивчення машинного навчання.</p>
<p>Для економетричного дослідження необхідно будувати математичні моделі - спрощений варіант реальних об’єктів дослідження. Виглядають вони частіше за все, як певні рівняння, наприклад опишемо залежність заробітної плати робітника від його освіти, досвіду роботи та навичок. Таку залежність можна описати наступним чином:</p>
<p><span class="math display">\[
y = f(x_1, x_2, x_3, \dots, x_n),
(\#eq:reg)
\]</span>
де
<span class="math inline">\(y\)</span> — заробітна плата,
<span class="math inline">\(x_1\)</span> — рівень освіти,
<span class="math inline">\(x_2\)</span> — досвід роботи,
<span class="math inline">\(x_3\)</span> — навички (знання мов програмування, статистики тощо),
<span class="math inline">\(x_n\)</span> — інші показники,
<span class="math inline">\(f\)</span> — функція залежності: описує яким саме чином <span class="math inline">\(x_i\)</span> впливають на <span class="math inline">\(y\)</span>.</p>
<p>Змінна <span class="math inline">\(y\)</span>, яку ми намагаємось пояснити, називається <strong>залежною</strong>, а змінні <span class="math inline">\(x_i\)</span>, за допомогою яких ми намагаємось пояснити або спрогнозувати залежну змінну, називають <strong>незалежними</strong>. Хоча можуть зустрічатися і альтернативні визначення:</p>
<table>
<thead>
<tr class="header">
<th align="center"><strong>Y</strong></th>
<th align="center"><strong>X</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Залежна змінна</td>
<td align="center">Незалежна змінна</td>
</tr>
<tr class="even">
<td align="center">Пояснювана змінна</td>
<td align="center">Пояснювальна змінна</td>
</tr>
<tr class="odd">
<td align="center">Відгук</td>
<td align="center">Контрольна змінна</td>
</tr>
<tr class="even">
<td align="center">Прогнозована змінна</td>
<td align="center">Предиктор</td>
</tr>
<tr class="odd">
<td align="center">Регресант</td>
<td align="center">Регресор</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center">Коваріат</td>
</tr>
</tbody>
</table>
<p>Зверніть увагу, що ми суб’єктивно оголосили, що на заробітну плату впливають зазначені показники. При альтернативних дослідженні і форма залежності, і перелік змінних може бути іншим. Та й взагалі, можливо ми захочемо пояснити вже рівень освіти за допомогою заробітної плати, досвіду роботи і навичок. Все це ми визначаємо на основі своїх знань, досвіду та доступної інформації.</p>
<p>В якості джерел даних можуть виступати:</p>
<ul>
<li><em>Перехресні дані</em>: дані зібрані по різним об’єктам дослідження (персонал, компанії, держави, сфери тощо). Часто такі дані були зібрані за допомогою простої випадкової вибірки.</li>
</ul>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>starwars</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 87 x 14</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    name     height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Luke Sk~    172    77 blond      fair       blue            19   male  mascu~</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu~</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 R2-D2        96    32 &lt;NA&gt;       white, bl~ red             33   none  mascu~</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Darth V~    202   136 none       white      yellow          41.9 male  mascu~</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Leia Or~    150    49 brown      light      brown           19   fema~ femin~</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Owen La~    178   120 brown, gr~ light      blue            52   male  mascu~</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Beru Wh~    165    75 brown      light      blue            47   fema~ femin~</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu~</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Biggs D~    183    84 black      light      brown           24   male  mascu~</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Obi-Wan~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="do">## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></span></code></pre></div>
<ul>
<li><em>Часові ряди</em>: дані по одному чи декількох об’єктах дослідження впродовж певного періоду часу (курси валют, ВВП, пасажиропотік тощо). Головною особливістю таких даних виступає часова впорядкованість (від минулого до сучасного) та частота даних (однаковий інтервал запису даних).</li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>economics</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 574 x 6</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    date         pce    pop psavert uempmed unemploy</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 1967-07-01  507. 198712    12.6     4.5     2944</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 1967-08-01  510. 198911    12.6     4.7     2945</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 1967-09-01  516. 199113    11.9     4.6     2958</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 1967-10-01  512. 199311    12.9     4.9     3143</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 1967-11-01  517. 199498    12.8     4.7     3066</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 1967-12-01  525. 199657    11.8     4.8     3018</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 1968-01-01  531. 199808    11.7     5.1     2878</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 1968-02-01  534. 199920    12.3     4.5     3001</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 1968-03-01  544. 200056    11.7     4.1     2877</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 1968-04-01  544  200208    12.3     4.6     2709</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 564 more rows</span></span></code></pre></div>
<ul>
<li><em>Панельні дані</em>: поєднуть в собі перехресні дані та часові ряди, вони показують, як об’єкти дослідження змінювались з часом.</li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1,704 x 6</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 1,694 more rows</span></span></code></pre></div>
<p>Функція залежності (<span class="math inline">\(f\)</span>) може мати різну форму та характер. Ми не знаємо її заздалегідь і намагаємось підібрати найкращий варіант з декількох альтернатив.</p>
<div id="проста-лінійна-регресія" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Проста лінійна регресія</h2>
<p><strong>Проста лінійна регресія</strong> — це модель, яка пояснює залежність між <em>двома змінними</em> за допомогою <em>лінійного взаємозв’язку</em>.</p>
<p>Роботу такої регресії краще пояснити на прикладі. В нашому розпорядженні є набір даних про вагу та зріст вибірки чоловіків та жінок:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>weight_height <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/Aranaur/datasets/main/datasets/weight-height.csv&quot;</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>weight_height</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 10,000 x 3</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    Gender Height Weight</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Male     73.8   242.</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Male     68.8   162.</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Male     74.1   213.</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Male     71.7   220.</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Male     69.9   206.</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Male     67.3   152.</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Male     68.8   184.</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Male     68.3   168.</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Male     67.0   176.</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Male     63.5   156.</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 9,990 more rows</span></span></code></pre></div>
<p>Конвертуємо значення в кілограми і сантиметри та візуалізуємо підвибірку по чоловікам:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># фіксуємо генератор випадкових величин</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>male <span class="ot">&lt;-</span> weight_height <span class="sc">%&gt;%</span> </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># беремо тільки чоловіків</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Gender <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># формуємо випадкову підвибірку</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># конвертуємо значення</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Height_kg =</span> Height <span class="sc">*</span> <span class="fl">2.54</span>,</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Weight_cm =</span> Weight <span class="sc">*</span> <span class="fl">0.45</span>)</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="co"># візуалізуємо</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<p>Припустимо, що взаємозв’язок між вагою і зростом - лінійний. Такі випадки на практиці досить рідко зустрічаються і пізніше ми познайомимось з іншими варіантами.</p>
<p>Рівняння прямої виглядає наступним чином:
<span class="math display">\[
y_i = \beta_0 + \beta_1x_i + u_i
(\#eq:lmreg)
\]</span>
Підставимо конкретні змінні у рівняння, отримаємо:
<span class="math display">\[
Weight_i = \beta_0 + \beta_1Height_i + u_i
(\#eq:malereg)
\]</span>
Рівняння @ref(eq:lmreg) та @ref(eq:malereg) називаються простою лінійною регресією або парною лінійною регресією.</p>
<p>Розглянемо складові рівняння @ref(eq:lmreg):</p>
<ul>
<li><p><span class="math inline">\(y\)</span>: залежна змінна.</p></li>
<li><p><span class="math inline">\(\beta_0\)</span>: вільний параметр моделі, який відповідає за точку перетину прямої з вістю ординат.</p></li>
<li><p><span class="math inline">\(\beta_1\)</span>: залежний параметр моделі, який відповідає за кут нахилу прямої.</p></li>
<li><p><span class="math inline">\(x\)</span>: незалежна змінна.</p></li>
<li><p><span class="math inline">\(u\)</span>: залишки моделі.</p></li>
</ul>
<p>Для того щоб тримати рівняння прямої, нам необхідно підібрати значення параметрів моделі: <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span>. Що значать “кришки” <span class="math inline">\(^\)</span> над коєфіціентами? Справа в тому, що в нашому розпорядженні є тільки певна вибірка даних і провести ідеальну пряму через всі точки неможливо. Тому нам необхідно розрахувати оцінки параметрів моделі, які будуть задовільняти нас.</p>
<p>Отже рівняння моделі набуває вигляду:
<span class="math display">\[
\hat{y_i} = \hat{\beta_0} + \hat{\beta_1}x_i
(\#eq:lmreg1)
\]</span>
або для нашого прикладу
<span class="math display">\[
\hat{Weight_i} = \hat{\beta_0} + \hat{\beta_1}Height_i
(\#eq:malereg1)
\]</span>
Давайте для початку проведемо пряму, яка відповідає середньому значенню ваги чоловіків по вибірці:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(Weight_cm)), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/midline-1.png" width="100%" /></p>
<p>Очевидно, що така “модель” є неоптимальною і вона має значні залишки: відхилення модельних значень від фактичних</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit1 =</span> <span class="fu">mean</span>(Weight_cm),</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">resid1 =</span> Weight_cm <span class="sc">-</span> fit1) <span class="sc">%&gt;%</span> </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(Weight_cm)), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> Height_kg, <span class="at">yend =</span> fit1), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/resid-1.png" width="100%" /></p>
<p>Позитивні відхилення розташовані вище модельних значень, а від’ємні - нижче.</p>
<p>Давайте побудуємо декілька альтернативних прямих
<img src="r_econometrics_files/figure-html/fit2-1.png" width="100%" /></p>
<p>Такі моделі вже мають значно менші відхилення. Але вони були побудовані “на око” без точних математичних розрахунків. Як провести оптимізацію процесу підбору моделі? Для цього ми вводимо функцію втрат (<em>loss function</em>), мінімізуючи котру ми будемо підбирати оптимальні значення <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span>. На перший погляд здається, що непоганою ідеєю було б розрахувати суму похибок <span class="math inline">\(\sum\limits^{n}_{i=1}{u_i}\)</span> для всіх альтернатив та обрати модель з найменшим значенням. Але такий підхід має значний недолік: представимо, що ми побудували дві моделі і отримали залишки <span class="math inline">\(u_{m1} = (-10, -5, 5, 10)\)</span> для першої та <span class="math inline">\(u_{m2} = (-100, -50, 50, 100)\)</span> для другої моделі. Сума залишків для обох моделей дорівнює нулю, але це не значит, що моделі не помиляються. Позитивні та негативні похибки компенсують один одного, при цьому коливання похибок другої моделі значно більші. Тож такий підхід нам не підходить.</p>
<p>Тому для оцінювання параметрів моделі в лінійній регресії пропонується використовувати <strong>метод найменших квадратів</strong> (МНК, <em>ordinary least squares, OLS</em>): серед альтернатив обbраємо ту, для котрої сума квадратів відхилення буде мінімальною.
<span class="math display">\[
\sum\limits^{n}_{i=1}{u_i^2} = u_1^2 + u_2^2 + \dots + u_n^2 \rightarrow min
(\#eq:ols)
\]</span>
Чому слід брати квадрат відхилення, а не абсолютні значення <span class="math inline">\(\left |{u_1}\right | + \left |{u_2}\right | + \dots + \left |{u_n}\right |\)</span>? Такий підхід має значний недолік: абсолютні значення не мають неперервної похідної, що робить таку функцію негладкою. До того ж квадрат похибок “штрафують” модель сильніше з більших відхилень. Як альтернативу можна обрати інші парні степені похибок, такі як 4 або 6, але і там є певні складнощі. Тому на практиці частіше за всі інші альтернативи обирають МНК.</p>
<p>Подивимось, як працює мінімізація суми квадратів залишків.
<span class="math display">\[
\sum\limits^{n}_{i=1}{u_i^2} = \sum\limits^{n}_{i=1}(y_i - \hat{\beta_0} - \hat{\beta_1}x_i)^2 \rightarrow min
(\#eq:sumerror)
\]</span>
Візьмемо похідні по <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span>:
<span class="math display">\[
\left\{\begin{matrix}
 -2\sum\limits^{n}_{i=1}(y_i - \hat{\beta_0} - \hat{\beta_1}x_i) = 0 &amp; \\ 
-2\sum\limits^{n}_{i=1}x_i(y_i - \hat{\beta_0} - \hat{\beta_1}x_i) = 0 &amp; 
\end{matrix}\right.
(\#eq:pohid)
\]</span></p>
<p>Розкриємо дужки першого рівняння:
<span class="math display">\[
\left\{\begin{matrix}
\sum\limits^{n}_{i=1}y_i - n\hat{\beta_0} - \hat{\beta_1}x_i = 0 &amp; \\ 
\sum\limits^{n}_{i=1}x_i(y_i - \hat{\beta_0} - \hat{\beta_1}x_i) = 0 &amp; 
\end{matrix}\right.
(\#eq:pohid2)
\]</span></p>
<p>Поділимо перше рівняння на <span class="math inline">\(n\)</span>:
<span class="math display">\[
\left\{\begin{matrix}
\overline{y} - \hat{\beta_0} - \hat{\beta_1}\overline{x} = 0 &amp; \\ 
\sum\limits^{n}_{i=1}x_i(y_i - \hat{\beta_0} - \hat{\beta_1}x_i) = 0 &amp; 
\end{matrix}\right.
(\#eq:pohid3)
\]</span>
З першого рівняння виразимо <span class="math inline">\(\hat{\beta_0}\)</span> і підставимо у друге:
<span class="math display">\[
\left\{\begin{matrix}
\hat{\beta_0} = \overline{y} - \hat{\beta_1}\overline{x} &amp; \\ 
\sum\limits^{n}_{i=1}x_i(y_i - (\overline{y} - \hat{\beta_1}\overline{x}) - \hat{\beta_1}x_i) = 0 &amp; 
\end{matrix}\right.
(\#eq:pohid4)
\]</span>
Розкриємо дужки у другому рівнянні:
<span class="math display">\[
\left\{\begin{matrix}
\hat{\beta_0} = \overline{y} - \hat{\beta_1}\overline{x} &amp; \\ 
\sum\limits^{n}_{i=1}x_i(y_i - \overline{y}) =  \hat{\beta_1}\sum\limits^{n}_{i=1}x_i(x_i - \overline{x}) 
\end{matrix}\right.
(\#eq:pohid5)
\]</span>
Оскільки
<span class="math display">\[\sum\limits^{n}_{i=1}x_i(y_i - \overline{y}) = \sum\limits^{n}_{i=1}(x_i - \overline{x})^2\]</span>
та
<span class="math display">\[\sum\limits^{n}_{i=1}x_i(y_i - \overline{y}) = \sum\limits^{n}_{i=1}(x_i - \overline{x})(y_i - \overline{y}),\]</span>
тоді за умови
<span class="math display">\[
\sum\limits^{n}_{i=1}(x_i - \overline{x})^2 &gt; 0
(\#eq:pohid6)
\]</span>
оцінки параметрів моделі <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span> будуть дорівнювати:
<span class="math display">\[
\left\{\begin{matrix}
\hat{\beta_0} = \overline{y} - \hat{\beta_1}\overline{x} &amp; \\ 
\hat{\beta_1} = \frac{\sum\limits^{n}_{i=1}(x_i - \overline{x})(y_i - \overline{y})}{\sum\limits^{n}_{i=1}(x_i - \overline{x})^2} = \frac{\overline{xy} - \overline{x}\overline{y}}{\overline{x^2} - \overline{x}^2}
\end{matrix}\right.
(\#eq:pohid7)
\]</span>
Давайте поетапно розрахуємо значення <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span> для нашого прикладу з вагою і зростом:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Height_kg, Weight_cm)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 100 x 2</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Height_kg Weight_cm</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="do">##        &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1      182.      89.4</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2      174.      80.9</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3      175.      83.9</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4      182.      86.6</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5      177.      82.9</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6      184.     101. </span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7      185.      84.8</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8      169.      79.2</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9      170.      74.0</span></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10      187.      94.5</span></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 90 more rows</span></span></code></pre></div>
<p>Додамо розрахункові значення <span class="math inline">\(Height_{kg}^2\)</span> та <span class="math inline">\(Height_{kg}*Weight_{cm}\)</span>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Height_kg, Weight_cm) <span class="sc">%&gt;%</span> </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Height_kg_sq =</span> Height_kg <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Height_Weight =</span> Height_kg <span class="sc">*</span> Weight_cm)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 100 x 4</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    Height_kg Weight_cm Height_kg_sq Height_Weight</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="do">##        &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1      182.      89.4       33197.        16286.</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2      174.      80.9       30197.        14062.</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3      175.      83.9       30469.        14644.</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4      182.      86.6       33302.        15799.</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5      177.      82.9       31233.        14651.</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6      184.     101.        33907.        18675.</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7      185.      84.8       34065.        15647.</span></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8      169.      79.2       28566.        13385.</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9      170.      74.0       28917.        12583.</span></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10      187.      94.5       34841.        17637.</span></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 90 more rows</span></span></code></pre></div>
<p>Знайдемо середнє значення для кожного стовпчика:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Height_kg, Weight_cm) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Height_kg_sq =</span> Height_kg <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Height_Weight =</span> Height_kg <span class="sc">*</span> Weight_cm) <span class="sc">%&gt;%</span> </span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Height_kg<span class="sc">:</span>Height_Weight,</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>            mean,</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.names =</span> <span class="st">&quot;mean_{.col}&quot;</span>))</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 4</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   mean_Height_kg mean_Weight_cm mean_Height_kg_sq mean_Height_Weight</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="do">##            &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1           176.           83.8            30892.             14780.</span></span></code></pre></div>
<p>Тепер можемо розрахувати оцінки параметрів моделі:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Height_kg, Weight_cm) <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Height_kg_sq =</span> Height_kg <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Height_Weight =</span> Height_kg <span class="sc">*</span> Weight_cm) <span class="sc">%&gt;%</span> </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Height_kg<span class="sc">:</span>Height_Weight,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>            mean,</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.names =</span> <span class="st">&quot;mean_{.col}&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">beta_1 =</span> (mean_Height_Weight <span class="sc">-</span> mean_Height_kg <span class="sc">*</span> mean_Weight_cm)<span class="sc">/</span>(mean_Height_kg_sq <span class="sc">-</span> mean_Height_kg<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">beta_0 =</span> mean_Weight_cm <span class="sc">-</span> beta_1 <span class="sc">*</span> mean_Height_kg)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 2</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   beta_1 beta_0</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   1.02  -96.0</span></span></code></pre></div>
<p>Отже рівняння простої лінійної регресії для нашого прикладу буде виглядати:
<span class="math display">\[\hat{y_i} = -96 + 1.02 * \hat{x}\]</span>
Звичайно, на практиці оцінки параметрів моделі за МНК розраховуються за допомогою комп’ютера. Для цього, в R є функція <code>lm()</code>, де першим аргументом вказується формула залежності, а другим набір даних:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у формулі ліворуч від ~ знаходиться залежна змінна</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co"># праворуч від ~ незалежні змінні</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>male_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(Weight_cm <span class="sc">~</span> Height_kg, <span class="at">data =</span> male)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>male_ols</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = Weight_cm ~ Height_kg, data = male)</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)    Height_kg  </span></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     -95.999        1.024</span></span></code></pre></div>
<p>Результат моделі <code>male_ols</code> зберігається у вигляді списку, з якого ми можемо отримати залишки, параметри моделі, модельні значення тощо:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Оцінки параметрів моделі</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>male_ols<span class="sc">$</span>coefficients</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)   Height_kg </span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  -95.998717    1.024054</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Модельні значення в тібблі</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(male_ols<span class="sc">$</span>fitted.values)</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 100 x 1</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    value</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt;</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  90.6</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  82.0</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  82.8</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  90.9</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  85.0</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  92.6</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  93.0</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  77.1</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  78.1</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  95.1</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 90 more rows</span></span></code></pre></div>
<p>Побудуємо візуалізацію отриманих результатів за допомогою <code>ggplot2</code></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/olsplot1-1.png" width="100%" /></p>
<p>або</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit_ols =</span> male_ols<span class="sc">$</span>fitted.values) <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(Height_kg, fit_ols), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/olsplot2-1.png" width="100%" /></p>
</div>
<div id="властивості-модельних-значень-та-залишків" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Властивості модельних значень та залишків</h2>
<p>Залишки регресії, які отримані за допомогою МНК мають декілька властивостей:</p>
<ol style="list-style-type: decimal">
<li><p>Сума залишків моделі дорівнює нулю:
<span class="math display">\[
\sum\limits^{n}_{i=1}u_i = 0
(\#eq:resid1)
\]</span></p></li>
<li><p>Вибіркова коваріація між регресорами та залишками МНК дорівнює нулю:
<span class="math display">\[
\sum\limits^{n}_{i=1}x_iu_i = 0
(\#eq:resid2)
\]</span></p></li>
<li><p>Лінія регресії завжди проходить через точку <span class="math inline">\((\overline{x},\overline{y})\)</span></p></li>
<li><p>Сума значень залежної змінної дорівнює сумі модельних значень, а отже і їх середні однакові.
<span class="math display">\[
\sum\limits^{n}_{i=1}y_i = \sum\limits^{n}_{i=1}\hat{y_i}
(\#eq:resid3)
\]</span>
Ці властивості притаманні кожній моделі, яка побудована з використанням МНК.</p></li>
</ol>
<p>Важливо вивести наступні поняття:</p>
<ul>
<li><p><strong>загальна сума квадратів</strong> (TSS, <em>total sum of squares</em>): оцінює дисперсію серед <span class="math inline">\(y_i\)</span>, тобто на скільки дані розсіяні у вибірці. Якщо поділити SST на <span class="math inline">\(n-1\)</span>, ми отримаємо вибіркову дисперсію значень <span class="math inline">\(y_i\)</span>.
<span class="math display">\[
TSS = \sum\limits^{n}_{i=1}(y_i - \overline{y})^2,
(\#eq:SST)
\]</span></p></li>
<li><p><strong>пояснювальна сума квадратів</strong> (ESS, <em>explained/estimated sum of squares</em>): оцінює міру розсіювання <span class="math inline">\(\hat{y_i}\)</span> @ref(eq:resid3).
<span class="math display">\[
ESS = \sum\limits^{n}_{i=1}(\hat{y_i} - \overline{y})^2,
(\#eq:SSE)
\]</span></p></li>
<li><p><strong>сума квадратів залишків</strong> (RSS, <em>residual sum of squares</em>): оцінює розсіювання серед <span class="math inline">\(\hat{u_i}\)</span>.
<span class="math display">\[
RSS = \sum\limits^{n}_{i=1}{u_i^2}
(\#eq:SSR)
\]</span>
TSS може визначена через суму SSE та SSR:
<span class="math display">\[
TSS = ESS + RSS
(\#eq:SST1)
\]</span>
<em>Окремо зверну увагу на абрівіатури цих показників в різних джерелах:</em></p></li>
<li><p><em>TSS іноді записують, як SST.</em></p></li>
<li><p><em>ESS іноді записують, як RSS (regression sum of squares).</em></p></li>
<li><p><em>RSS іноді вживають, як SSR (sum of squared residuals) або ESS (error sum of squares).</em></p></li>
</ul>
<p><em>Будьте уважні!</em></p>
</div>
<div id="коефіцієнт-детермінації" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Коефіцієнт детермінації</h2>
<p>Тепер слід визначити, наскільки пояснювальна змінна <span class="math inline">\(x_i\)</span> пояснює пояснювальну змінну <span class="math inline">\(y_i\)</span>.</p>
<p>Якщо припустити, що TSS не дорівнює нулю (це можливо тільки в тому випадку коли всі <span class="math inline">\(y_i\)</span> однакові), ми можемо поділити @ref(eq:SST1) на TSS. В результаті, ми отримаємо <strong>коефіцієнт детермінації</strong> або <span class="math inline">\(R^2\)</span> (R-квадрат):
<span class="math display">\[
R^2 = \frac{ESS}{TSS} = 1 - \frac{RSS}{TSS} = 1 - \frac{\sum\limits^{n}_{i=1}{u_i^2}}{\sum\limits^{n}_{i=1}(y_i - \overline{y})^2}
(\#eq:rsquar)
\]</span>
<span class="math inline">\(R^2\)</span> показує, яка частина варіації (розсіювання) <span class="math inline">\(y_i\)</span> пояснюється <span class="math inline">\(x_i\)</span>. Цей показник знаходиться завжди в межах від нуля до одиниці <span class="math inline">\([0,1]\)</span>. Для інтерпретації у відсотках, <span class="math inline">\(R^2\)</span> домножують на 100: <em>який відсоток варіації <span class="math inline">\(y_i\)</span> пояснюється <span class="math inline">\(x_i\)</span></em>. Чим ближчий <span class="math inline">\(R^2\)</span> до 1 - тим краще <span class="math inline">\(x_i\)</span> пояснює <span class="math inline">\(y_i\)</span> і навпаки, чим ближчий <span class="math inline">\(R^2\)</span> до 0 - тим гіршу модель ми отримали.</p>
<p>Також <span class="math inline">\(R^2\)</span> можна пояснити, як квадрат коефіцієнта кореляції між <span class="math inline">\(y_i\)</span> та <span class="math inline">\(\hat{y_i}\)</span>.</p>
<p><strong>Коефіцієнта кореляції</strong> (r, <em>correlation coefficien</em>) — показник, який показує силу лінійного взаємозв’язку між двома змінними:
<span class="math display">\[
r = \frac{n\sum\limits^{n}_{i=1}(xy) - \sum\limits^{n}_{i=1}x_i\sum\limits^{n}_{i=1}y_i}{\sqrt{[n\sum\limits^{n}_{i=1}x^2 - (\sum\limits^{n}_{i=1}x_i)^2][n\sum\limits^{n}_{i=1}y_i^2-(\sum\limits^{n}_{i=1}y_i)^2]}}
(\#eq:corr)
\]</span>
<span class="math inline">\(r\)</span> змінюється від мінус одиниці до одиниці <span class="math inline">\([-1,1]\)</span>:</p>
<ul>
<li><p>при наближенні до -1 присутній обернений взаємозв’язок між змінними (одна зростає, інша спадає і навпаки)</p></li>
<li><p>при наближенні до +1 присутній прямий лінійний взаємозв’язок між змінними (одна зростає й інша зростає і навпаки)</p></li>
<li><p>при наближенні до 0 лінійного взаємозв’язку між змінними не існує.</p></li>
</ul>
<p>Для розрахунку коефіцієнта кореляції в R використовується функція <code>cor()</code>:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(male<span class="sc">$</span>Weight_cm, male<span class="sc">$</span>Height_kg)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8862974</span></span></code></pre></div>
<p>Тоді коефіцієнт детермінації має дорівнювати:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(male<span class="sc">$</span>Weight_cm, male<span class="sc">$</span>Height_kg)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.7855231</span></span></code></pre></div>
<p>Давайте розрахуємо <span class="math inline">\(R^2\)</span> вручну @ref(eq:rsquar):</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(male_ols<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>((male<span class="sc">$</span>Weight_cm <span class="sc">-</span> <span class="fu">mean</span>(male<span class="sc">$</span>Weight_cm))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.7855231</span></span></code></pre></div>
<p>Але все теж саме можна отримати застосувавши функцію <code>summary()</code> до МНК моделі:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>male_ols <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = Weight_cm ~ Height_kg, data = male)</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -8.2309 -3.3608  0.0104  3.1405 11.6086 </span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a><span class="do">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) -95.99872    9.50045  -10.11   &lt;2e-16 ***</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Height_kg     1.02405    0.05405   18.95   &lt;2e-16 ***</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  </span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 4.314 on 98 degrees of freedom</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.7855, Adjusted R-squared:  0.7833 </span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 358.9 on 1 and 98 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Функція <code>summary()</code> виводить багато різноманітної інформації щодо побудованої моделі, з кожним елементом якої ми познайомимось вже згодом.</p>
<p>З точки зору інтерпретації результатів по <span class="math inline">\(R^2\)</span> слід сказати, що 78.5% варіації ваги чоловіків пояснюється їх зростом, а 21.5% пояснюються іншими показниками, які не входять у дослідження.</p>
<p>На практиці можна досить часто зустріти маленькі значення <span class="math inline">\(R^2\)</span>, але це ще не означає, що побудована модель є неефективною. Критеріїв ефективності моделей, як і задач які вони мають вирішувати досить багато, тому не слід концентруватися виключно на коефіцієнті детермінації.</p>
</div>
<div id="передумови-використання-мнк" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Передумови використання МНК</h2>
<p>Нагадаю, що є принципова відмінність між параметрами моделі <span class="math inline">\(\beta_j\)</span> та <span class="math inline">\(\hat{\beta_j}\)</span>:</p>
<ul>
<li><p><span class="math inline">\(\beta_j\)</span> (без “кришки”) — це істинні параметри моделі, котрі на практиці ніколи не відомі, тому що ми не маємо у розпорядженні генеральну сукупність даних щодо об’єкту дослідження. Якщо повернутися до прикладу зі зростом та вагою серед чоловіків, тоді нам потрібно було б зібрати цю інформацію для всієї чоловічої половини населення планети, але це неможливо.</p></li>
<li><p><span class="math inline">\(\hat{\beta_j}\)</span> (з “кришкою”) — це наближені оцінки параметрів моделі, які були отримані за допомогою вибірки даних. Як правило, така вибірка є випадковою, а отже і оцінки параметрів моделі є випадковими величинами.</p></li>
</ul>
<p>І тут постає питання: за яких умов ми можемо довіряти оцінкам параметрів моделі? Ці умови називають <strong>передумовами МНК</strong>:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Модель лінійна за параметрами і має коректну специфікацію.</strong> Якщо дані мають нелінійну природу та/або формула задана некоректно (про це трошки пізніше), очікувати на коректні результати від такої моделі не має сенсу.</p></li>
<li><p><strong>Випадковість вибірки даних.</strong> Якщо б в нашому прикладі з вагою і зростом були зібрана інформація тільки по високим чоловікам, то й узагальнення на основі моделі стосувалися б тільки високих чоловіків, а не всіх чоловіків планети.</p></li>
<li><p><strong>Неоднаковість та незалежність змінних <span class="math inline">\(x_i\)</span>.</strong> Явище кореляції між пояснювальними змінними називається мультиколінеарністю і вона призводить до неефективності параметрів моделі з точки зору їх інтерпретації.</p></li>
<li><p><strong>Математичне сподівання залишків моделі дорівнює нулю <span class="math inline">\(E(u_i) = 0\)</span>.</strong> Це припущення говорить по те, що серед залишків моделі будуть як позитивні, так і негативні значення, але вони компенсують один одного.</p></li>
<li><p><strong>Гомоскедастичність (постійність) залишків моделі <span class="math inline">\(Var(u_i) = \sigma^2\)</span>.</strong> Непостійність залишків призводить до значних проблем в моделі, явище гетероскедастичності (протилежність до гомоскедастичності) ми розглянемо в окремій темі.</p></li>
<li><p><strong>Незалежність залишків моделі.</strong> Якщо залишки корелюють між собою, це означає, що в них залишилась “корисна” інформація, яку наша модель не змогла визначити.</p></li>
<li><p><strong>Залишки моделі мають нормальний розподіл <span class="math inline">\(N(0, \sigma^2)\)</span>.</strong> Ця властивість буде корисною при тестуванні різноманітних гіпотез та побудові довірчих інтервалів.</p></li>
</ol>
<p>На практиці, ви досить часто будете зустрічати ситуації коли одна або одразу декілька (якщо не всі) передумов МНК не будуть виконуватись. Звичайно є альтернативні методи та моделі для побудови регресійних задач, але саме проста лінійна регресія є фундаментом, від котрого всі відштовхуються. Це як таблиця множення, розуміння і вміння нею користуватися значно полегшує подальшу роботу.</p>
</div>
<div id="значущість-оцінок-параметрів-моделі" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> Значущість оцінок параметрів моделі</h2>
<p>Я вже говорив, що оцінки параметрів моделі <span class="math inline">\(\hat{\beta_0}\)</span> та <span class="math inline">\(\hat{\beta_1}\)</span> є випадковими величинами, які “приблизно” оцінюють істині параметри моделі <span class="math inline">\({\beta_0}\)</span> та <span class="math inline">\({\beta_1}\)</span>. Якщо істинні параметри моделі дорівнюють нулю, скоріш за все їх оцінки будуть дещо відхилятися від нуля і навпаки. Тож нам слід вміти визначати <strong>статистичну значущість оцінок параметрів моделі</strong> — впевненість в тому, що <strong>параметри моделі не дорівнюють нулю</strong>.</p>
<p>В якості статистичного критерію використовуються <strong>t-критерій Стьюдента</strong>:
<span class="math display">\[
t_{\beta_j} = \frac{\hat{\beta_j}}{se(\hat\beta_j)},
(\#eq:student)
\]</span>
де <span class="math inline">\(se(\hat\beta_j)\)</span> — стандартна похибка <span class="math inline">\(\hat\beta_j)\)</span>, для розрахунку котрої необхідно визначити дисперсію <span class="math inline">\(\hat\beta_j)\)</span>.</p>
<p>Я залишу поза межами цього підручника доведення відповідних теорем, але якщо комусь буде цікаво ознайомитись, пропоную почитати роботи <span class="citation">(<a href="#ref-wooldridge2019" role="doc-biblioref">Wooldridge 2019</a>; <a href="#ref-zeileis2008" role="doc-biblioref">Kleiber 2006</a>)</span>.</p>
<p><strong>Дисперсія оцінки параметру моделі</strong> <span class="math inline">\(\hat{\beta_1}\)</span> дорівнює:
<span class="math display">\[
\hat{var}(\hat{\beta_1}) = \frac{S^2}{\sum\limits^{n}_{i=1}(x_i - x)^2},
(\#eq:beta1var)
\]</span>
де
<span class="math display">\[
S^2 = \frac{1}{n-2}\sum\limits^{n}_{i=1}u_i^2
(\#eq:sbeta1)
\]</span>
Корінь квадратний з @ref(eq:sbeta1) називається <strong>стандартною помилкою оцінки параметру <span class="math inline">\(\hat{\beta_1}\)</span></strong>:
<span class="math display">\[
se(\hat{\beta_1}) = \sqrt{\hat{var}(\hat{\beta_1})} = \sqrt{\frac{S^2}{\sum\limits^{n}_{i=1}(x_i - x)^2}}
(\#eq:sebeta1)
\]</span></p>
<p>Аналогічним чином розраховується <strong>стандартна помилка оцінки параметру <span class="math inline">\(\hat{\beta_0}\)</span></strong>:
<span class="math display">\[
se(\hat{\beta_0}) = \sqrt{\hat{var}(\hat{\beta_0})} = \sqrt{\frac{\frac{S^2}{n}\sum\limits^{n}_{i=1}x_i^2}{\sum\limits^{n}_{i=1}(x_i - x)^2}}
(\#eq:sebeta0)
\]</span>
Тепер ми знаємо, як розрахувати критерій Стьюдента @ref(eq:student), який перевіряє значущість <span class="math inline">\(\hat{\beta_j}\)</span> за наступною процедурою:</p>
<ol style="list-style-type: decimal">
<li>Формуємо дві гіпотези:</li>
</ol>
<ul>
<li><span class="math inline">\(H_0:{\beta_j}=0\)</span>: параметр незначущій.</li>
<li><span class="math inline">\(H_1:{\beta_j}\neq 0\)</span>: параметр значущій.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>Розраховуємо критерій Стьюдента @ref(eq:student).</p></li>
<li><p>Обираємо рівень значущості <span class="math inline">\(\alpha\)</span> — це ймовірність помилки першого роду, тобто ймовірність відхилити гіпотезу за умови, що вона правильна. На практиці <span class="math inline">\(\alpha\)</span> беруть 5% (0.05), хоча все залежить від сфери дослідження.</p></li>
<li><p>Знаходимо <em>критичне значення критерія Стьюдента</em> <span class="math inline">\(t_{df}^{\alpha/2}\)</span> для заданого рівня значущості <span class="math inline">\(\alpha\)</span> та <em>ступеня свободи</em> <span class="math inline">\(df\)</span>. Для цього використовується <a href="https://www.sjsu.edu/faculty/gerstman/StatPrimer/t-table.pdf">таблиця розподілу Стьюдента</a> або функція в R <code>qt()</code>.</p></li>
<li><p>Порівнюємо абсолютне значення <span class="math inline">\(t_{\beta_j}\)</span> з <span class="math inline">\(t_{df}^{\alpha/2}\)</span>:</p></li>
</ol>
<ul>
<li>якщо <span class="math inline">\(|t_{\beta_j}| &gt; t_{df}^{\alpha/2}\)</span> — відхиляємо нульову гіпотезу. Це означає, що <span class="math inline">\(\beta_j\)</span> є статистично значущою і не дорівнює нулю.</li>
<li>якщо <span class="math inline">\(|t_{\beta_j}| &lt; t_{df}^{\alpha/2}\)</span> — нульова гіпотеза не може бути відхилена. Тобто <span class="math inline">\(\beta_j\)</span> є статистично незначущою.</li>
</ul>
<p>Альтернативна процедура до оцінювання статистичної значущості параметрів моделі є <strong>p-значення</strong> (читається пі-значення, <em>p-value</em>) — такий рівень значущості, за котрого гіпотеза знаходиться на межі між відхиленням і прийняттям.</p>
<p>Використовувати його дуже легко:</p>
<ul>
<li><p>якщо p-значення менше обраного рівня значущості <span class="math inline">\(\alpha\)</span> — відхиляємо нульову гіпотезу.</p></li>
<li><p>якщо p-значення більше обраного рівня значущості <span class="math inline">\(\alpha\)</span> — нульова гіпотеза не може бути відхилена.</p></li>
</ul>
</div>
<div id="довірчі-інтервали-оцінок-параметрів-моделі" class="section level2" number="3.6">
<h2 number="3.6"><span class="header-section-number">3.6</span> Довірчі інтервали оцінок параметрів моделі</h2>
<p><strong>Довірчий інтервал</strong> (ДІ, <em>confidence interval, CI</em>) — діапазон значень в який потрапляє випадкова величина з певною ймовірністю.</p>
<p>Довірчий інтервал для оцінок параметрів моделі розраховується за формулою:
<span class="math display">\[
\hat{\beta_j} - se(\hat{\beta_j})*t_{df}^{\alpha/2} &lt; \beta_j &lt; \hat{\beta_j} - se(\hat{\beta_j})*t_{df}^{\alpha/2}
(\#eq:confint)
\]</span></p>
<p>Тобто з йомовірністю <span class="math inline">\(1 - \alpha\)</span> інтервал <span class="math inline">\((\hat{\beta_j} - se(\hat{\beta_j})*t_{df}^{\alpha/2}, \hat{\beta_j} - se(\hat{\beta_j})*t_{df}^{\alpha/2})\)</span> буде містити істинні значення параметру моделі.</p>
<p>Розрахуємо довірчі інтервали до оцінок параметрів моделі з нашого прикладу. В R для цього використовується функція <code>confint()</code>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(male_ols)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                    2.5 %     97.5 %</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) -114.8520605 -77.145374</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Height_kg      0.9167876   1.131321</span></span></code></pre></div>
<p>Довірчі інтервали більш інформативні ніж просто точкові оцінки. Погодьтесь, що твердження “параметр <span class="math inline">\(\hat\beta_1\)</span> дорівнює 1.02405 менш інформативно, ніж”з ймовірністю 95% істинне значення параметру моделі <span class="math inline">\(\hat\beta_1\)</span> знаходиться в межах від 0.9167896 до 1.13131. Крім того, якщо довірчий інтервал перетинає нуль - це вказує на його статистичну незначущість.</p>
</div>
<div id="розрахунок-статистик-в-r" class="section level2" number="3.7">
<h2 number="3.7"><span class="header-section-number">3.7</span> Розрахунок статистик в R</h2>
<p>Повернемось до нашого прикладу з вагою і зростом.</p>
<p>Всі зазначені показники (крім довірчих інтервалів) розраховуються за допомогою функції <code>summary()</code> застосованої до побудованої моделі:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>male_ols <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>У розділі <code>Residuals</code> наведено розподіл залишків моделі:</li>
</ol>
<pre><code>Residuals:
    Min      1Q  Median      3Q     Max 
-8.2309 -3.3608  0.0104  3.1405 11.6086 </code></pre>
<ul>
<li><p>мінімальне значення (Min): -8.2309</p></li>
<li><p>перший квартиль (1Q): -3.3608</p></li>
<li><p>медіана (Median): 0.0104</p></li>
<li><p>третій квартиль (3Q): 3.1405</p></li>
<li><p>максимальне значення (Max): 11.6086</p></li>
</ul>
<p>За бажання можна візуалізувати розподіл залишків моделі:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>male_ols<span class="sc">$</span>residuals <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;male&quot;</span>, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label=</span><span class="fu">sprintf</span>(<span class="st">&quot;%1.1f&quot;</span>, ..y..)),</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> <span class="cf">function</span>(y) <span class="fu">boxplot.stats</span>(y)<span class="sc">$</span>stats,</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.33</span>))</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/residplot-1.png" width="100%" /></p>
<ol start="2" style="list-style-type: decimal">
<li>У розділі <code>Coefficients</code> відображається таблиця про оцінки параметрів моделі:</li>
</ol>
<pre><code>Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -95.99872    9.50045  -10.11   &lt;2e-16 ***
Height_kg     1.02405    0.05405   18.95   &lt;2e-16 ***</code></pre>
<ul>
<li><p><code>Estimate</code>: значення оцінок параметрів</p></li>
<li><p><code>Std. Error</code>: стандартні похибки оцінок параметрів</p></li>
<li><p><code>t value</code>: значення критерію Стюдента</p></li>
<li><p><code>Pr(&gt;|t|)</code>: p-значення. Зірочки вказують на значущість параметрів моделі, що спрощує візуальне сприйняття результатів.</p></li>
</ul>
<p>Розшифровку зірочок ви можете бачити у розділі <code>Signif. codes</code>:</p>
<pre><code>Signif. codes:  
0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
<ul>
<li><p><code>‘***‘</code> - p-значення наближається до нуля.</p></li>
<li><p><code>‘**‘</code> - p-значення близько 0.001</p></li>
<li><p><code>‘*‘</code> - p-значення близько 0.05</p></li>
<li><p><code>‘.‘</code> - p-значення близько 0.1</p></li>
<li><p><code>‘ ‘</code> - p-значення більше 0.1</p></li>
</ul>
<p>Останні три рядка ми розберемо згодом.</p>
</div>
<div id="точковий-та-інтервальний-прогноз" class="section level2" number="3.8">
<h2 number="3.8"><span class="header-section-number">3.8</span> Точковий та інтервальний прогноз</h2>
<p>Крім пояснення сили впливу незалежної змінної на залежну, лінійна регресія дає можливість будувати прогнози. У випадку перехресних даних ми відповідаємо на питання “що-якщо?” тобто визначаємо значення <span class="math inline">\(y_{n+1}\)</span> за заданого значення <span class="math inline">\(x_{n+1}\)</span>. У випадку часових рядів - визначаємо, чому буде дорівнювати залежна змінна в наступні періоди часу.</p>
<p>Формула для розрахунку <strong>точкового прогнозу</strong>:
<span class="math display">\[
\hat{y}_{n+1} = \hat{\beta_0} + \hat{\beta_1}x_{n+1}
(\#eq:predict)
\]</span>
Але й тут необхідно розраховувати довірчі інтервали до прогнозних значень. Для цього нам необхідно знати <strong>стандартну похибку пронозу</strong>:
<span class="math display">\[
\delta = \sqrt{S^2 (1 + \frac{1}{n} + \frac{(x_{n+1} - \overline{x})^2}{\sum\limits^{n}_{i=1}(x_i - \overline{x})^2})}
(\#eq:predictCI)
\]</span>
Тоді <strong>прогнозний інтервал</strong>:
<span class="math display">\[
\hat{y}_{n+1} - \delta*t_{df}^{\alpha/2} &lt; {y}_{n+1} &lt; \hat{y}_{n+1} + \delta*t_{df}^{\alpha/2}
(\#eq:predictCI2)
\]</span></p>
<p>Для побудови прогнозу в R використовується функція <code>predict()</code>, де необхідно вказати модель та нові значення для прогнозу.</p>
<p>В якості прикладу створимо новий датасет з тьома новими значеннями зросту для чоловіків: 186 см, 192 см та 200 см. І передамо ці значення у функцію <code>predict()</code>. В результаті для кожного нового значення отримуємо точкові прогнози:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>new_height <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Height_kg =</span> <span class="fu">c</span>(<span class="dv">186</span>, <span class="dv">192</span>, <span class="dv">200</span>))</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(male_ols, <span class="at">newdata =</span> new_height)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="do">##         1         2         3 </span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  94.47537 100.61970 108.81213</span></span></code></pre></div>
<p>Для отримання прогнозів з довірчими інтервалами, необіхдно додатки аргумент <code>interval = "prediction"</code> до функції <code>predict()</code>. З замовчуванням будується 95% довірчий інтервал, де <code>lwr</code> та <code>upr</code> — верхня та нижня межа довірчих інтервалів.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(male_ols, <span class="at">newdata =</span> new_height, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="do">##         fit      lwr      upr</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  94.47537 85.80017 103.1506</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 100.61970 91.83835 109.4010</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 108.81213 99.81929 117.8050</span></span></code></pre></div>
<p>Для інтерпретації результатів можна сказати, що згідно нашої моделі, 95% чоловіків зі зростом 200 сантиметрів мають вагу від 99.81929 до 117.8050 кілограмів.</p>
<p>Як альтернативу, можна використати аргумент <code>interval = "confidence"</code> для побудови <strong>довірчого інтервалу до середнього прогнозу</strong>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(male_ols, <span class="at">newdata =</span> new_height, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="do">##         fit       lwr       upr</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  94.47537  93.06753  95.88321</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 100.61970  98.66140 102.57800</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 108.81213 106.05638 111.56789</span></span></code></pre></div>
<p>В такому випадку інтерпретація буде наступна: згідно нашої моделі, чоловічки зі зростом 200 сантиметрів мають в середньому вагу від 106.05638 до 111.56789 кілограмів.</p>
<p>Що обрати, довірчий інтервал до середнього прогнозу чи інтервальний прогноз? Інтервальний прогнозу оцінює невизначеність щодо конкретного значення, а довірчий інтервал щодо середнього значення. Це означає, що інтервальний прогноз буде значно ширший за довірчий інтервал. Тож вибір залежить від цілей та контексту аналізу. Частіше нас цікавлять конкретні індивідуальні значення прогнозів, тож інтервальні прогнози використовуються частіше <span class="citation">(<a href="#ref-bruce2017" role="doc-biblioref">Bruce and Bruce 2017</a>)</span>.</p>
<p>Наступний код демонструє різницю між довірчим інтервалом (сірий) та інтервальним прогнозом (червоний):</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Будуємо прогнозні значення за моделью за реальними даними</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>pred.int <span class="ot">&lt;-</span> <span class="fu">predict</span>(male_ols, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>male <span class="sc">%&gt;%</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Об&#39;єднуємо стовпчики</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(pred.int) <span class="sc">%&gt;%</span> </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Будуємо графік</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height_kg, Weight_cm)) <span class="sc">+</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Додаємо лінію регресії та довірчий інтервал</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5. Додаємо інтервальні прогнози</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> lwr), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> upr), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Зріст (см)&quot;</span>,</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Вага (кг)&quot;</span>)</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/predvsconf-1.png" width="100%" /></p>
</div>
<div id="завдання" class="section level2" number="3.9">
<h2 number="3.9"><span class="header-section-number">3.9</span> Завдання</h2>
<div id="обрати-та-завантажити-дані" class="section level3" number="3.9.1">
<h3 number="3.9.1"><span class="header-section-number">3.9.1</span> Обрати та завантажити дані</h3>
<p>Для практичних та лабораторних робіт необхідно знайти та обрати дані з якими бажаєте працювати. Для цього рекомендую наступні джерела:</p>
<ul>
<li><p>Сервіс з пошуку даних від Google <a href="https://datasetsearch.research.google.com/">Dataset Search</a></p></li>
<li><p>Репозитарій з машинного навчання <a href="https://archive.ics.uci.edu/ml/datasets.php">UCI</a></p></li>
<li><p>Дані <a href="https://data.worldbank.org/">Всісвітнього банку</a></p></li>
<li><p>Набори даних з <a href="https://hbiostat.org/data/#vanderbilt-biostatistics-datasets">біостатистики</a></p></li>
<li><p>Платформа змагать <a href="https://www.kaggle.com/">Kaggle</a></p></li>
<li><p><a href="https://www.fueleconomy.gov/feg/download.shtml">Fuel Economy Data</a></p></li>
</ul>
<p>Вимоги до датасетів прості: мають бути цікавими для Вас та наявність числових змінних (більше двох). Можете пошукати щось додатково в гуглі.</p>
<p>Завантажте дані в R.</p>
</div>
<div id="обробка-даних" class="section level3" number="3.9.2">
<h3 number="3.9.2"><span class="header-section-number">3.9.2</span> Обробка даних</h3>
<p>Після завантаження даних, за потреби приведіть їх до охайного вигляду, створіть нові змінні або перекодуйте вже існуючі.</p>
</div>
<div id="лінійна-регресія" class="section level3" number="3.9.3">
<h3 number="3.9.3"><span class="header-section-number">3.9.3</span> Лінійна регресія</h3>
<p><strong>Всі завдання виконуються у двох напрямках: вручну (всі розрахунки будуєте самостійно) та за допомогою функцій мови програмування R.</strong></p>
<ol style="list-style-type: decimal">
<li><p>Оберіть дві числові змінні з завантаженого набору даних. Визначте, яка змінна буде залежною, а яка незалежною.</p></li>
<li><p>Побудуйте точкову діаграму. Як ви можете описати отриманий результат?</p></li>
<li><p>Розрахуйте коефіцієнт кореляції. Зробіть висновки.</p></li>
<li><p>Побудуйте модель простої лінійної регресії за допомогою формул та за допомогою функції <code>lm()</code>. Порівняйте результати. Запишіть рівняння регресії.</p></li>
<li><p>Відобразіть на графіку точкової діаграми лінію регресії.</p></li>
<li><p>Розрахуйте стандартні похибки оцінок параметрів моделі.</p></li>
<li><p>Розрахуйте t-критерій Стьюдента до оцінок параметрів моделі. Порівняйте з табличним значенням або розрахуйте p-значення. Зробіть висновки щодо гіпотез.</p></li>
<li><p>Побудуйте довірчі інтервали до оцінок параметрів моделі.</p></li>
<li><p>Розрахуйте коефіцієнт детермінації. Зробіть висновок щодо його значення.</p></li>
<li><p>Побудуйте точковий та інтервальний прогноз за побудованою моделью за довільними значеннями незалежної змінної.</p></li>
</ol>
<!--chapter:end:03-Simple_regression.Rmd-->
</div>
</div>
</div>
<div id="multiple_regression" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Множинна лінійна регресія</h1>
<div id="загальні-відомості" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Загальні відомості</h2>
<p><strong>Множинна лінійна регресія</strong> — варіант регресійної моделі, де в якості предикторів використовується більше однієї змінної. В більшості випадків це підвищує ефективність моделі в порівнянні з парною регресією.</p>
<p>Крім того, проста лінійна регресія може бути обтяжена так званим зміщенням через <strong>пропуск впливової змінної</strong> (<em>omitted variable bias</em>), що призводить до неправильних воводів у простій моделі <span class="citation">(<a href="#ref-wooldridge2019" role="doc-biblioref">Wooldridge 2019</a>)</span>.</p>
<p>Загальне рівняння множинної лінійної регресії:
<span class="math display">\[
y_i = \beta_0 + \beta_0x_{i,1} + \beta_0x_{i,2} + \dots + \beta_kx_{i,k} + u_i, i = 1,\dots,n
(\#eq:multreg)
\]</span>
де</p>
<ul>
<li><p><span class="math inline">\(y_i\)</span> — залежна змінна,</p></li>
<li><p><span class="math inline">\(x_{i,m}\)</span> — незалежні змінні, <span class="math inline">\(m = 1,\dots,k\)</span>,</p></li>
<li><p><span class="math inline">\(u_i\)</span> — випадкові помилки,</p></li>
<li><p><span class="math inline">\(k\)</span> — кількість незалежних змінних,</p></li>
<li><p><span class="math inline">\(n\)</span> — кількість спостережень.</p></li>
</ul>
<p>Всі передумови використання МНК залишаються тими самими, що і раніше, збільшується тільки кількість предикторів.</p>
</div>
<div id="мнк-для-множинної-регресії" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> МНК для множинної регресії</h2>
<p>Для розрахунку оцінок параметрів моделі множинної регресії за МНК зручніше використовувати векторно-матричну форму запису.</p>
<p>Вектор значень залежної змінної:
<span class="math display">\[
Y = \begin{pmatrix}
y_1 \\
y_2 \\
\dots \\
y_{n-1} \\
y_n
\end{pmatrix}
(\#eq:y)
\]</span></p>
<p>Матриця незалежних змінних:
<span class="math display">\[
X = \begin{pmatrix}
1 &amp; x_{1,1} &amp; x_{1,2} &amp; \dots &amp; x_{1,k} \\
1 &amp; x_{2,1} &amp; x_{2,2} &amp; \dots &amp; x_{2,k} \\
\dots &amp; \dots &amp; \dots &amp; \dots &amp; \dots \\
1 &amp; x_{n,1} &amp; x_{n,2} &amp; \dots &amp; x_{n,k} \\
\end{pmatrix}
(\#eq:x)
\]</span>
Звертаю увагу, що в першому стовпчику матриці незалежних змінних записані тільки одиниці. Я дещо спрощу пояснення природи цього запису: це потрібно для розрахунку вільного параметру моделі <span class="math inline">\(\beta_0\)</span>.</p>
<p>Вектор випадкових помилок:
<span class="math display">\[
u = \begin{pmatrix}
u_1 \\
u_2 \\
\dots \\
u_{n-1} \\
u_n
\end{pmatrix}
(\#eq:u)
\]</span>
Вектор коефіцієнтів моделі:
<span class="math display">\[
\beta = \begin{pmatrix}
\beta_1 \\
\beta_1 \\
\dots \\
\beta_k
\end{pmatrix}
(\#eq:betavec)
\]</span>
Вектор оцінок коефіцієнтів моделі:
<span class="math display">\[
\hat\beta = \begin{pmatrix}
\hat\beta_1 \\
\hat\beta_1 \\
\dots \\
\hat\beta_k
\end{pmatrix}
(\#eq:betahatvec)
\]</span>
Для розрахунку МНК-оцінок параметрів моделі використовується формула:
<span class="math display">\[
\hat\beta = (X&#39;X)^{-1}X&#39;Y
(\#eq:matrixmnk)
\]</span></p>
</div>
<div id="стандартні-помилки-оцінок-параметрів-множинної-моделі" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Стандартні помилки оцінок параметрів множинної моделі</h2>
<p>Для розрахунку стандартних помилок оцінок параметрів множинної моделі необхідно розглянути <strong>коваріаціну матрицю коефіцієнтів моделі</strong>:
<span class="math display">\[
\hat{V}(\hat\beta) = (X&#39;X)^{-1}*S^2
(\#eq:matrixmnk)
\]</span>
де
<span class="math display">\[
S^2 = \frac{1}{n-k-1}\sum\limits^{n}_{i=1}u_i^2
(\#eq:smult)
\]</span>
Матриця <span class="math inline">\(\hat{V}(\hat\beta)\)</span> має розмір <span class="math inline">\(k+1\)</span> на <span class="math inline">\(k+1\)</span>, де на перетині <span class="math inline">\(i\)</span>-го рядку та <span class="math inline">\(j\)</span>-го стовпчика знаходиться незміщенна оцінка коефіцієнта коваріації між <span class="math inline">\(\hat\beta_i\)</span> та <span class="math inline">\(\hat\beta_j\)</span>.</p>
<p>З матриці <span class="math inline">\(\hat{V}(\hat\beta)\)</span> нас цікваить головна діагональ, оскільки на ній міститься незміщенна дисперсія оцінок параметрів моделі. <em>Корінь квадратний з елементів головної діагоналі</em> — це <strong>стандартні похибки оцінок параметрів моделі</strong>:
<span class="math display">\[
se(\hat\beta_j) = \sqrt{\hat{V_{jj}}} = \sqrt{\hat{var}(\hat\beta_j)}
(\#eq:sebetamult)
\]</span></p>
</div>
<div id="значущість-оцінок-параметрів-моделі-1" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> Значущість оцінок параметрів моделі</h2>
<p>Даний етап виконується аналогічно до парної регресії.</p>
</div>
<div id="скорегований-коефіцієнт-детермінації" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> Скорегований коефіцієнт детермінації</h2>
<p>Розрахунок та інтерпретація коефіцієнту детермінації залишається аналогічним до простої лінійної регресії @ref(eq:rsquar).</p>
<p>Проте <span class="math inline">\(R^2\)</span> має суттєву особливість в множинній регресії: він характеризує наявність кореляції між незалежними і залежною змінною, але <strong>нічного не говорить про причинно-наслідкові зв’язки</strong>. Тому <span class="math inline">\(R^2\)</span> <strong>не може бути використаний для порівняння простих і більш складних (з більшою кількістю незалежних змінних) моделей</strong>.</p>
<p>Але є значна <strong>проблема</strong>: додавання нових змінних до спеицифікації моделі призводить до збільшення <span class="math inline">\(R^2\)</span>. В деяких випадках він може залишитися незмінним, але точно не зменшитися. Це означає, що якщо бездумно додавати будь-які змінні в модель, вона може ставати кращою, але це оманливе відчуття.</p>
<p>Щоб продемонструвати цю проблему:
- згенеруємо 10000 значень <span class="math inline">\(y\)</span>
- згенеруємо 10000 значень для кожної змінної від <span class="math inline">\(x_1\)</span> до <span class="math inline">\(x_{1000}\)</span>
- побудуємо моделі регресії:
- <span class="math inline">\(LM_1\)</span>: Регресія <span class="math inline">\(y\)</span> на даних <span class="math inline">\(x_1\)</span>
- <span class="math inline">\(LM_2\)</span>: Регресія <span class="math inline">\(y\)</span> на даних <span class="math inline">\(x_2\)</span>
- <span class="math inline">\(\dots\)</span>
- <span class="math inline">\(LM_{1000}\)</span>: Регресія <span class="math inline">\(y\)</span> на даних <span class="math inline">\(x_{1000}\)</span>
- до кожної моделі розрахуємо <span class="math inline">\(R^2\)</span> і подивимось на динаміку його зміни.</p>
<p>Зауважу, що жодного зв’язку між <span class="math inline">\(y\)</span> та <span class="math inline">\(x_k\)</span> не має.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">rnorm</span>(<span class="fl">1e7</span>), <span class="at">nrow =</span> <span class="fl">1e4</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&lt;&gt;%</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="fl">1e4</span>, <span class="at">ncol =</span> <span class="dv">1</span>), x)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>r_df <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fl">1e3</span><span class="dv">-1</span>), <span class="at">FUN =</span> <span class="cf">function</span>(i) {</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>  tmp_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x[,<span class="dv">1</span><span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>)]) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> i <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">r2 =</span> tmp_reg <span class="sc">%$%</span> r.squared,</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">r2_adj =</span> tmp_reg <span class="sc">%$%</span> adj.r.squared</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span></code></pre></div>
<p><img src="r_econometrics_files/figure-html/r2%20plot-1.svg" width="100%" /></p>
<p>В таких випадках пропонують використовувати вдосконалену версію <span class="math inline">\(R^2\)</span> — <strong>скорегований коефіцієнт детермінації</strong> (<em>adjusted <span class="math inline">\(R^2\)</span></em>):
<span class="math display">\[
R_{adj}^2 = 1 - (1 - R^2)\left [  \frac{(n-1)}{(n-k-1)} \right ]
(\#eq:adjrsquer)
\]</span>
В порівнянні з класичним <span class="math inline">\(R^2\)</span>, його модифікація <span class="math inline">\(R_{adj}^2\)</span> штрафується на кількість змінних. Якщо додавати в модель предиктори, які не приносять суттєвого вкладу в пояснення залежної змінної, <span class="math inline">\(R_{adj}^2\)</span> буде зменшуватися.</p>
<p><img src="r_econometrics_files/figure-html/adjusted%20r2%20plot-1.svg" width="100%" /></p>
<!-- Давайте до нашого прикладу з вагою і зростом чоловіків додамо три випадкові змінні: -->
<!-- ```{r adj} -->
<!-- set.seed(2022) -->
<!-- male %>%  -->
<!--   mutate(Random1 = runif(100, 0, 100), -->
<!--          Random2 = runif(100, 0, 100), -->
<!--          Random3 = runif(100, 0, 100)) %>% -->
<!--   lm(Weight_cm ~ Height_kg + Random1 + Random2 + Random3, data = .) %>%  -->
<!--   summary() -->
<!-- ``` -->
<!-- Тоді, якщо порівняти коефіцієнти детермінації простої лінійної моделі та множинної моделі з декількома випадковими змінними, можна побачити, що $R^2$ збільшився, проте $R_{adj}^2$ дещо зменшився. В даному випадку доцільніше використовувати саме просту модель. -->
<!-- ``` -->
<!-- 1. Weight_cm ~ Height_kg -->
<!-- Multiple R-squared:  0.7855,   Adjusted R-squared:  0.7833 -->
<!-- 2. Weight_cm ~ Height_kg + Random1 + Random2 + Random3 -->
<!-- Multiple R-squared:  0.7914,   Adjusted R-squared:  0.7826  -->
<p>```</p>
<p>bookdown::render_book(“index.Rmd,” output_dir = “docs”)</p>
<!--chapter:end:04-Multiple_regression.Rmd-->
</div>
</div>
<div id="multicollinearity" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Мультиколінеарність</h1>
<p>text</p>
<!--chapter:end:05-Multicollinearity.Rmd-->
</div>
<div id="heteroskedasticity" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Гетероскедастичність</h1>
<p>text</p>
<!--chapter:end:06-Heteroskedasticity.Rmd-->
</div>
<div id="regularization" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Регуляризація</h1>
<p>text</p>
<!--chapter:end:07-Regularization.Rmd-->
</div>
<div id="time_series" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Регресійний аналіз часових рядів</h1>
<p>text</p>
<!--chapter:end:08-Time_series.Rmd-->
</div>
<div id="glm" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> GLM</h1>
<p>text</p>
<!--chapter:end:09-GLM.Rmd-->
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">Література</h1>
<!--chapter:end:10-References.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bruce2017" class="csl-entry">
Bruce, Peter, and Andrew Bruce. 2017. <em>Practical Statistics for Data Scientists</em>. O’Reilly Media.
</div>
<div id="ref-h2obench" class="csl-entry">
<span>“Database-Like Ops Benchmark.”</span> 2022. <a href="https://h2oai.github.io/db-benchmark/">https://h2oai.github.io/db-benchmark/</a>.
</div>
<div id="ref-friedl2006" class="csl-entry">
Friedl, Jeffrey. 2006. <em>Mastering Regular Expressions</em>. 3nd ed. O’Reilly Media, Inc. <a href="https://www.oreilly.com/library/view/mastering-regular-expressions/0596528124/">https://www.oreilly.com/library/view/mastering-regular-expressions/0596528124/</a>.
</div>
<div id="ref-zeileis2008" class="csl-entry">
Kleiber, Zeileis. 2006. <em>Applied Econometrics with r</em>. Springer.
</div>
<div id="ref-wooldridge2019" class="csl-entry">
Wooldridge, Jeffrey M. 2019. <em>Introductory Econometrics: A Modern Approach</em>. 7nd ed. Cengage.
</div>
</div>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><span style='font-size: 14px'>ОСНОВИ ЕКОНОМЕТРИКИ В R
</style></strong>" was written by Ігор Мірошниченко. It was last built on 2022-04-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
