<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 2 Маніпуляції з даними за допомогою dplyr і не тільки | r_econometrics.knit</title>
<meta name="author" content="Ігор Мірошниченко">
<meta name="description" content="В минулій главі ми розібрали основні принципи мови програмування R. І тут слід зазначити, що окрім базового синтаксису існують й інші. Загалом, можна виділити три основні діалекти в мові...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content=" 2 Маніпуляції з даними за допомогою dplyr і не тільки | r_econometrics.knit">
<meta property="og:type" content="book">
<meta property="og:description" content="В минулій главі ми розібрали основні принципи мови програмування R. І тут слід зазначити, що окрім базового синтаксису існують й інші. Загалом, можна виділити три основні діалекти в мові...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 2 Маніпуляції з даними за допомогою dplyr і не тільки | r_econometrics.knit">
<meta name="twitter:description" content="В минулій главі ми розібрали основні принципи мови програмування R. І тут слід зазначити, що окрім базового синтаксису існують й інші. Загалом, можна виділити три основні діалекти в мові...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><span style="font-size: 14px">ОСНОВИ ЕКОНОМЕТРИКИ В R
</span></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Зміст</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Основи економетрики в R</a></li>
<li><a class="" href="introR.html"><span class="header-section-number">1</span> Вступ до R</a></li>
<li><a class="active" href="dplyr.html"><span class="header-section-number">2</span> Маніпуляції з даними за допомогою dplyr і не тільки</a></li>
<li><a class="" href="simple_regression.html"><span class="header-section-number">3</span> Проста лінійна регресія</a></li>
<li><a class="" href="multiple_regression.html"><span class="header-section-number">4</span> Множинна лінійна регресія</a></li>
<li><a class="" href="multicollinearity.html"><span class="header-section-number">5</span> Мультиколінеарність</a></li>
<li><a class="" href="heteroskedasticity.html"><span class="header-section-number">6</span> Гетероскедастичність</a></li>
<li><a class="" href="regularization.html"><span class="header-section-number">7</span> Регуляризація</a></li>
<li><a class="" href="time_series.html"><span class="header-section-number">8</span> Регресійний аналіз часових рядів</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">9</span> GLM</a></li>
<li><a class="" href="references.html">Література</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/aranaur/r_econometrics">Переглянути код <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="dplyr" class="section level1" number="2">
<h1>
<span class="header-section-number"> 2</span> Маніпуляції з даними за допомогою dplyr і не тільки<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h1>
<hr>
<p>В минулій главі ми розібрали основні принципи мови програмування R. І тут слід зазначити, що окрім базового синтаксису існують й інші. Загалом, можна виділити три основні діалекти в мові програмування R:</p>
<ul>
<li><p>base: основний фундамент мови, який ми розібрали (але не повністю) раніше.</p></li>
<li><p>Tidyverse: окремий напрямок розвитку мови програмування R, що сконцентрований у напрямку науки про дані (data science).</p></li>
<li><p>data.table: альтернативний напрямок, який дозволяє оброблювати об’ємні масиви даних за рекордний час <span class="citation"><a href="references.html#ref-h2obench" role="doc-biblioref"><span>“Database-Like Ops Benchmark”</span></a> (<a href="references.html#ref-h2obench" role="doc-biblioref">2022</a>)</span>.</p></li>
</ul>
<p>Їх можна сміло поєднувати в своїх проектах, що значним чином підвищує ефективність та швидкість роботи.</p>
<div id="tidy" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Tidy-всесвіт<a class="anchor" aria-label="anchor" href="#tidy"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><a href="https://www.tidyverse.org/"><strong>Tidyverse</strong></a> — це екосистема, набір пакетів, які спеціально створені для науки про дані (data science). В ньому є ключові пакети (ядро tidyverse) та побічні — які додатково розширюють можливості мови програмування R.</p>
<p><strong>Концепція охайних даних (tidy-data)</strong> передбачає приведення даних до формату, в якому:</p>
<ul>
<li><p>Кожна змінна міститься в окремому стовпчику</p></li>
<li><p>Кожне спостереження міститься в окремому рядку</p></li>
<li><p>Кожне значення міститься в окремій комірці</p></li>
</ul>
<p><strong>Ядро tidyverse:</strong></p>
<ul>
<li><p><em>ggplot2</em>, для візуалізації</p></li>
<li><p><em>dplyr</em>, для маніпуляції з даними</p></li>
<li><p><em>tidyr</em>, для отримання охайних даних (tidy data)</p></li>
<li><p><em>readr</em>, для зчитування та записування файлів в R</p></li>
<li><p><em>purrr</em>, для функціонального програмування</p></li>
<li><p><em>tibble</em>, для роботи з тібблами (tibble), просунутий варіант дата фреймів</p></li>
<li><p><em>stringr</em>, для роботи з текстовими даними</p></li>
<li><p><em>forcats</em>, для роботи з факторами (factors)</p></li>
</ul>
<p>Крім того є ще низка допоміжних пакетів, які не входять до ядра tidyverse але вважаються його частиною:</p>
<ul>
<li><p><em>vroom</em>, для швидкого завантаження даних</p></li>
<li><p><em>DBI</em>, для роботи з базами даних</p></li>
<li><p><em>haven</em>, для даних SPSS, Stata та SAS</p></li>
<li><p><em>httr</em>, для роботи з API</p></li>
<li><p><em>readxl</em> для завантаження .xls та .xlsx файлів</p></li>
<li><p><em>googlesheets4</em>, для роботи з Google Sheet</p></li>
<li><p><em>googledrive</em>, для роботи з Google Drive</p></li>
<li><p><em>rvest</em>, для скрапінгу веб-сторінок</p></li>
<li><p><em>jsonlite</em>, для роботи з JSON-файлами</p></li>
<li><p><em>xml2</em>, для роботи з XML</p></li>
<li><p><em>lubridate</em>, для роботи з датами</p></li>
<li><p><em>dbplyr</em>, для перетворення коду <code>dplyr</code> в SQL</p></li>
<li><p><em>dtplyr</em>, для перетворення коду на <code>data.table</code></p></li>
<li><p><em>magrittr</em>, для використання конвеєрів <code>%&gt;%</code> (pipe)</p></li>
<li><p><em>glue</em>, для поєднання даних та тексту</p></li>
<li><p><em>tidymodels</em>, для роботи з моделями машнинного навчання.</p></li>
</ul>
<p>І це ще не повний список. Крім офіційних пакетів tidyverse є ще низка пакетів, які намагаються відповідати принципам tidyverse і доповнюють його.</p>
<p>Головним чином, для роботи з даними, я зосереджу свою увагу на роботі з пакетом <code>dplyr</code>.</p>
<p>Для завантаження tidyverse необхідно виконати наступний код:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></code></pre></div>
<p>Для підключення:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></code></pre></div>
<p>Концепція “охайних” даних передбачає альтернативу класичним <code>data.frame</code> у вигляді тібблів (<code>tibble</code>). Давайте розеберемо основі відмінності.
В мові програмування R є вбудований популярний датасет <code>iris</code>. Він зберігається в форматі дата фрейму.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Переглянемо перші декілька значень</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="co">##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">## 1          5.1         3.5          1.4         0.2  setosa</span>
<span class="co">## 2          4.9         3.0          1.4         0.2  setosa</span>
<span class="co">## 3          4.7         3.2          1.3         0.2  setosa</span>
<span class="co">## 4          4.6         3.1          1.5         0.2  setosa</span>
<span class="co">## 5          5.0         3.6          1.4         0.2  setosa</span>
<span class="co">## 6          5.4         3.9          1.7         0.4  setosa</span></code></pre></div>
<p>Давайте створемо його альтернативу у вигляді тібблу:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="va">iris_tbl</span>
<span class="co">## # A tibble: 150 x 5</span>
<span class="co">##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">##  1          5.1         3.5          1.4         0.2 setosa </span>
<span class="co">##  2          4.9         3            1.4         0.2 setosa </span>
<span class="co">##  3          4.7         3.2          1.3         0.2 setosa </span>
<span class="co">##  4          4.6         3.1          1.5         0.2 setosa </span>
<span class="co">##  5          5           3.6          1.4         0.2 setosa </span>
<span class="co">##  6          5.4         3.9          1.7         0.4 setosa </span>
<span class="co">##  7          4.6         3.4          1.4         0.3 setosa </span>
<span class="co">##  8          5           3.4          1.5         0.2 setosa </span>
<span class="co">##  9          4.4         2.9          1.4         0.2 setosa </span>
<span class="co">## 10          4.9         3.1          1.5         0.1 setosa </span>
<span class="co">## # ... with 140 more rows</span></code></pre></div>
<p>Вже на цьому етапі видні основні відмінності: тіббл відображає одразу перші 10 спостережень і всі ствопчики, які поміщаються на екрані. Крім того до кожного стовпчика вказується його тип. Це дуже зручно, особливо коли працюєте з великим об’ємом даних.</p>
</div>
<div id="tidy_read" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Завантаження даних<a class="anchor" aria-label="anchor" href="#tidy_read"><i class="fas fa-link"></i></a>
</h2>
<hr>
<div id="tidy_csv" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Завантаження .csv, .tsv файлів<a class="anchor" aria-label="anchor" href="#tidy_csv"><i class="fas fa-link"></i></a>
</h3>
<p>Стандартною функцією завантаження даних типу <code>.csv</code> є функція <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code>, але на досить великих масивах даних краще використовувати <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> з пакету <code>readr</code>. Синтаксис цих функцій схожий, але <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> одразу приведе дані до формату <code>tibble</code>.
Першим аргументом функції є шлях до файлу (із оберненим слешем <code>/</code>). Також можна використовувати прямі URL-посилання на файл:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">read_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"docs/data/file.csv"</span><span class="op">)</span>
<span class="va">read_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://git.io/JztOr"</span><span class="op">)</span></code></pre></div>
<p>Аналогічно до <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> можна використовувати функцію <code>vroom</code> з однойменного пакету. Головною особливістю цього пакету є <a href="https://cran.r-project.org/web/packages/vroom/vignettes/benchmarks.html">швидкість завантаження даних</a>.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vroom_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"docs/data/file.csv"</span><span class="op">)</span>
<span class="va">vroom_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"https://git.io/JztOr"</span><span class="op">)</span></code></pre></div>
<p>Для <strong>завантаження</strong> одночасно <strong>декількох файлів однакової структури</strong> корисно використовувати наступну конструкцію</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\.csv$"</span><span class="op">)</span>
<span class="va">vroom_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="va">filse</span><span class="op">)</span></code></pre></div>
</div>
<div id="tidy_xls" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Завантаження .xls, .xlsx файлів<a class="anchor" aria-label="anchor" href="#tidy_xls"><i class="fas fa-link"></i></a>
</h3>
<p>Для завантаження файлів <strong>Excel</strong> використовується пакет <code>readxl</code> та функція <code>read_excel()</code>.
На початку можна отримати перелік листів файлу Excel за допомогою функції <code>excel_sheets()</code></p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="st">"docs/data/tourism.xlsx"</span><span class="op">)</span>
<span class="co">## [1] "Sheet1" "Sheet2" "Sheet3"</span></code></pre></div>
<p>Після чого зчитати данні з потрібного листа</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">excel_file</span> <span class="op">&lt;-</span> <span class="fu">read_excel</span><span class="op">(</span><span class="st">"docs/data/tourism.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"Sheet1"</span><span class="op">)</span></code></pre></div>
<p>В більшості випадків цього інструментарію має бути достатньо, але для завантаження специфічних файлів завжди можна знайти потрібний пакет. Не соромтеся використовувати google.</p>
</div>
</div>
<div id="dplyr" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Маніпуляції з даними за допомогою пакету dplyr<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p>dplyr - це граматика маніпуляції з даними, яка має низку функцій, які допоможуть легко та зручно маніпулювати даними, наприклад:</p>
<ul>
<li><p>створювати нові змінні</p></li>
<li><p>сортувати дані</p></li>
<li><p>проводити фільтрацію даних</p></li>
<li><p>агрегування даних і багато іншого.</p></li>
</ul>
<p>В якості прикладу роботи з пакетом dplyr пропоную використати датасет <code>gapminder</code> з однойменного пакету. В ньому збережена інформація про ВВП, очікувану тривалість життя при народженні та населення для 142 країн світу з 1952 по 2007 роки.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Підключаємо пакет (не забудьте його встановити) та подивимось на датасет</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>
<span class="va">gapminder</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Видно, що змінні <code>country</code> та <code>continent</code> — це фактори, а всі інші — числові.</p>
<div id="glimpse" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> dplyr::glimpse()<a class="anchor" aria-label="anchor" href="#glimpse"><i class="fas fa-link"></i></a>
</h3>
<p>Для перегляду структури тібблу використовується функція <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span>
<span class="co">## Rows: 1,704</span>
<span class="co">## Columns: 6</span>
<span class="co">## $ country   &lt;fct&gt; "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "Afghan~</span>
<span class="co">## $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, A~</span>
<span class="co">## $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2~</span>
<span class="co">## $ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.822, 41.~</span>
<span class="co">## $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12881816,~</span>
<span class="co">## $ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, 978.011~</span></code></pre></div>
<p>Це альтернатива базовій функції <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> для дата фреймів.</p>
</div>
<div id="filter" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> dplyr::filter()<a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p>Для фільтрації спостережень за певною умовою використовується функція <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. Для прикладу відфільтруємо дані для Ірландії:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"Ireland"</span><span class="op">)</span>
<span class="co">## # A tibble: 12 x 6</span>
<span class="co">##    country continent  year lifeExp     pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Ireland Europe     1952    66.9 2952156     5210.</span>
<span class="co">##  2 Ireland Europe     1957    68.9 2878220     5599.</span>
<span class="co">##  3 Ireland Europe     1962    70.3 2830000     6632.</span>
<span class="co">##  4 Ireland Europe     1967    71.1 2900100     7656.</span>
<span class="co">##  5 Ireland Europe     1972    71.3 3024400     9531.</span>
<span class="co">##  6 Ireland Europe     1977    72.0 3271900    11151.</span>
<span class="co">##  7 Ireland Europe     1982    73.1 3480000    12618.</span>
<span class="co">##  8 Ireland Europe     1987    74.4 3539900    13873.</span>
<span class="co">##  9 Ireland Europe     1992    75.5 3557761    17559.</span>
<span class="co">## 10 Ireland Europe     1997    76.1 3667233    24522.</span>
<span class="co">## 11 Ireland Europe     2002    77.8 3879155    34077.</span>
<span class="co">## 12 Ireland Europe     2007    78.9 4109086    40676.</span></code></pre></div>
<p>І тут я одразу хочу познайомити вас з альтернативним варіантом запису коду в синтаксисі tidyverse. Справа в тому, що якщо послідовно використовувати низку різноманітних функцій, то читаймість такого коду стає дуже низькою. Покажу на прикладі:</p>
<ol style="list-style-type: decimal">
<li><p>До кожного значення вектора від 1 до 10 з кроком 1 розрахуємо сінус.</p></li>
<li><p>З отриманого на першому кроці візьмемо абсолютні значення.</p></li>
<li><p>З отриманого результату на 2 кроці візьмемо корінь квадратний</p></li>
<li><p>Відсортуємо результат.</p></li>
</ol>
<p>В класичному вигляді все виглядає наступним чином:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">##  [1] 0.3756594 0.5285977 0.6419646 0.7375779 0.8105471 0.8699440 0.9173173 0.9535709</span>
<span class="co">##  [9] 0.9792468 0.9946649</span></code></pre></div>
<p>Погодьтесь, що розібрати такий код досить складно. Тому в діалекті tidyverse використовуються пайпи, <code>%&gt;%</code>, (pipe) — вони передають результат попереднього розрахунку першим аргументов наступної функції. Таким чином попередній код можна переписати наступним чином:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">##  [1] 0.3756594 0.5285977 0.6419646 0.7375779 0.8105471 0.8699440 0.9173173 0.9535709</span>
<span class="co">##  [9] 0.9792468 0.9946649</span></code></pre></div>
<p>Погодьтесь, що такий код читається значно легше. Для виклику оператора <code>%&gt;%</code> в RStudio використовується комбінація клавіш CTRL + SHIFT + M для Windows і CMD + SHIFT + M для Mac.</p>
<p>Тож, якщо повернутися до фільтрації <a href="dplyr.html#filter">2.3.2</a>, код можна переписати:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Попередній варіант</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"Ireland"</span><span class="op">)</span>
<span class="co">## # A tibble: 12 x 6</span>
<span class="co">##    country continent  year lifeExp     pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Ireland Europe     1952    66.9 2952156     5210.</span>
<span class="co">##  2 Ireland Europe     1957    68.9 2878220     5599.</span>
<span class="co">##  3 Ireland Europe     1962    70.3 2830000     6632.</span>
<span class="co">##  4 Ireland Europe     1967    71.1 2900100     7656.</span>
<span class="co">##  5 Ireland Europe     1972    71.3 3024400     9531.</span>
<span class="co">##  6 Ireland Europe     1977    72.0 3271900    11151.</span>
<span class="co">##  7 Ireland Europe     1982    73.1 3480000    12618.</span>
<span class="co">##  8 Ireland Europe     1987    74.4 3539900    13873.</span>
<span class="co">##  9 Ireland Europe     1992    75.5 3557761    17559.</span>
<span class="co">## 10 Ireland Europe     1997    76.1 3667233    24522.</span>
<span class="co">## 11 Ireland Europe     2002    77.8 3879155    34077.</span>
<span class="co">## 12 Ireland Europe     2007    78.9 4109086    40676.</span>

<span class="co"># З використанням %&gt;%</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Ireland"</span><span class="op">)</span>
<span class="co">## # A tibble: 12 x 6</span>
<span class="co">##    country continent  year lifeExp     pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Ireland Europe     1952    66.9 2952156     5210.</span>
<span class="co">##  2 Ireland Europe     1957    68.9 2878220     5599.</span>
<span class="co">##  3 Ireland Europe     1962    70.3 2830000     6632.</span>
<span class="co">##  4 Ireland Europe     1967    71.1 2900100     7656.</span>
<span class="co">##  5 Ireland Europe     1972    71.3 3024400     9531.</span>
<span class="co">##  6 Ireland Europe     1977    72.0 3271900    11151.</span>
<span class="co">##  7 Ireland Europe     1982    73.1 3480000    12618.</span>
<span class="co">##  8 Ireland Europe     1987    74.4 3539900    13873.</span>
<span class="co">##  9 Ireland Europe     1992    75.5 3557761    17559.</span>
<span class="co">## 10 Ireland Europe     1997    76.1 3667233    24522.</span>
<span class="co">## 11 Ireland Europe     2002    77.8 3879155    34077.</span>
<span class="co">## 12 Ireland Europe     2007    78.9 4109086    40676.</span></code></pre></div>
<p>Тут і далі я буду часто використовувати пайпи.</p>
<p>Розберемо ще приклади фільтрації даних. Відберемо дані Ірландії та Іспанії за 2007 рік:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Ireland"</span> <span class="op">|</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Spain"</span>,
         <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span>
<span class="co">## # A tibble: 2 x 6</span>
<span class="co">##   country continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Ireland Europe     2007    78.9  4109086    40676.</span>
<span class="co">## 2 Spain   Europe     2007    80.9 40448191    28821.</span></code></pre></div>
<p>А тепер припустимо, що нам потрібно відібрати інформацію не по двом, а по низці країн. Переліковувати їх всіх через <code>country == "Назва_країни"</code> буде дуже довго і не зручно. В таких випадках зручно використовувати оператор <code>%in%</code>. Давайте відберемо інформацію по Ірландії, Іспанії, Норвегії та Польщі за 2007 рік:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ireland"</span>, <span class="st">"Spain"</span>, <span class="st">"Norway"</span>, <span class="st">"Poland"</span><span class="op">)</span>,
         <span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span>
<span class="co">## # A tibble: 4 x 6</span>
<span class="co">##   country continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Ireland Europe     2007    78.9  4109086    40676.</span>
<span class="co">## 2 Norway  Europe     2007    80.2  4627926    49357.</span>
<span class="co">## 3 Poland  Europe     2007    75.6 38518241    15390.</span>
<span class="co">## 4 Spain   Europe     2007    80.9 40448191    28821.</span></code></pre></div>
<p>Всі потрібні умови фільтрації можна переліковувати всередині функції <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> через кому.</p>
</div>
<div id="slice" class="section level3" number="2.3.3">
<h3>
<span class="header-section-number">2.3.3</span> dplyr::slice()<a class="anchor" aria-label="anchor" href="#slice"><i class="fas fa-link"></i></a>
</h3>
<p>Для отримання зрізу даних, тобто тільки певних спостережень (перші, останні тощо) використовуються варіації функції <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>.</p>
<p>Перші п’ять спостережень:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 6</span>
<span class="co">##   country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">## 2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">## 3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">## 4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">## 5 Afghanistan Asia       1972    36.1 13079460      740.</span></code></pre></div>
<p>Перші п’ять та десяте спостереження:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">## # A tibble: 6 x 6</span>
<span class="co">##   country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">## 2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">## 3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">## 4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">## 5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">## 6 Afghanistan Asia       1997    41.8 22227415      635.</span></code></pre></div>
<p>Всі крім перших трьох:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,701 x 6</span>
<span class="co">##    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  2 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  3 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  4 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  5 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  6 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">##  7 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">##  8 Afghanistan Asia       2002    42.1 25268405      727.</span>
<span class="co">##  9 Afghanistan Asia       2007    43.8 31889923      975.</span>
<span class="co">## 10 Albania     Europe     1952    55.2  1282697     1601.</span>
<span class="co">## # ... with 1,691 more rows</span></code></pre></div>
<p>Перші 15 спостережень:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>
<span class="co">## # A tibble: 15 x 6</span>
<span class="co">##    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## 11 Afghanistan Asia       2002    42.1 25268405      727.</span>
<span class="co">## 12 Afghanistan Asia       2007    43.8 31889923      975.</span>
<span class="co">## 13 Albania     Europe     1952    55.2  1282697     1601.</span>
<span class="co">## 14 Albania     Europe     1957    59.3  1476505     1942.</span>
<span class="co">## 15 Albania     Europe     1962    64.8  1728137     2313.</span></code></pre></div>
<p>Останні 15 спостережень:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>
<span class="co">## # A tibble: 15 x 6</span>
<span class="co">##    country  continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Zambia   Africa     1997    40.2  9417789     1071.</span>
<span class="co">##  2 Zambia   Africa     2002    39.2 10595811     1072.</span>
<span class="co">##  3 Zambia   Africa     2007    42.4 11746035     1271.</span>
<span class="co">##  4 Zimbabwe Africa     1952    48.5  3080907      407.</span>
<span class="co">##  5 Zimbabwe Africa     1957    50.5  3646340      519.</span>
<span class="co">##  6 Zimbabwe Africa     1962    52.4  4277736      527.</span>
<span class="co">##  7 Zimbabwe Africa     1967    54.0  4995432      570.</span>
<span class="co">##  8 Zimbabwe Africa     1972    55.6  5861135      799.</span>
<span class="co">##  9 Zimbabwe Africa     1977    57.7  6642107      686.</span>
<span class="co">## 10 Zimbabwe Africa     1982    60.4  7636524      789.</span>
<span class="co">## 11 Zimbabwe Africa     1987    62.4  9216418      706.</span>
<span class="co">## 12 Zimbabwe Africa     1992    60.4 10704340      693.</span>
<span class="co">## 13 Zimbabwe Africa     1997    46.8 11404948      792.</span>
<span class="co">## 14 Zimbabwe Africa     2002    40.0 11926563      672.</span>
<span class="co">## 15 Zimbabwe Africa     2007    43.5 12311143      470.</span></code></pre></div>
<p>Топ-3 з найбільшим значенням очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">lifeExp</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">## # A tibble: 3 x 6</span>
<span class="co">##   country          continent  year lifeExp       pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Japan            Asia       2007    82.6 127467972    31656.</span>
<span class="co">## 2 Hong Kong, China Asia       2007    82.2   6980412    39725.</span>
<span class="co">## 3 Japan            Asia       2002    82   127065841    28605.</span></code></pre></div>
<p>Топ-3 з найменшим значенням очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min</a></span><span class="op">(</span><span class="va">lifeExp</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">## # A tibble: 3 x 6</span>
<span class="co">##   country     continent  year lifeExp     pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Rwanda      Africa     1992    23.6 7290203      737.</span>
<span class="co">## 2 Afghanistan Asia       1952    28.8 8425333      779.</span>
<span class="co">## 3 Gambia      Africa     1952    30    284320      485.</span></code></pre></div>
<p>Проста випадкова вибірка без повернення з трьох країн:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">## # A tibble: 3 x 6</span>
<span class="co">##   country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Canada      Americas   1972    72.9 22284500    18971.</span>
<span class="co">## 2 El Salvador Americas   1957    48.6  2355805     3422.</span>
<span class="co">## 3 Chad        Africa     1987    51.1  5498955      952.</span></code></pre></div>
<p>Зверніть увагу, що при повторному виконанні попереднього коду ви будете отримувати кожного разу різні підвибірки. Для того щоб отримати відтворюваний результат, необхідно вказати початкове значення генератора випадкових чисел за допомогою функції <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>. Аргументом цієї функції може бути будь-яке ціле число.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">## # A tibble: 3 x 6</span>
<span class="co">##   country   continent  year lifeExp      pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Cambodia  Asia       2007    59.7 14131858     1714.</span>
<span class="co">## 2 Swaziland Africa     1982    55.6   649901     3895.</span>
<span class="co">## 3 Kenya     Africa     1982    58.8 17661452     1348.</span></code></pre></div>
<p>Для формування простої випадкової вибірки з поверненням з трьох країн, необхідно додати аргумент <code>replace = TRUE</code>:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">## # A tibble: 3 x 6</span>
<span class="co">##   country continent  year lifeExp        pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 India   Asia       2007    64.7 1110396331     2452.</span>
<span class="co">## 2 Italy   Europe     1977    73.5   56059245    14256.</span>
<span class="co">## 3 India   Asia       1982    56.6  708000000      856.</span></code></pre></div>
</div>
<div id="arrange" class="section level3" number="2.3.4">
<h3>
<span class="header-section-number">2.3.4</span> dplyr::arrange()<a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<p>Для впорядкування даних використовується функція <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>. За замовчуванням сортування даних відбувається за зростанням.
Сортування по змінній ВВП на душу населення:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country          continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Congo, Dem. Rep. Africa     2002    45.0 55379852      241.</span>
<span class="co">##  2 Congo, Dem. Rep. Africa     2007    46.5 64606759      278.</span>
<span class="co">##  3 Lesotho          Africa     1952    42.1   748747      299.</span>
<span class="co">##  4 Guinea-Bissau    Africa     1952    32.5   580653      300.</span>
<span class="co">##  5 Congo, Dem. Rep. Africa     1997    42.6 47798986      312.</span>
<span class="co">##  6 Eritrea          Africa     1952    35.9  1438760      329.</span>
<span class="co">##  7 Myanmar          Asia       1952    36.3 20092996      331 </span>
<span class="co">##  8 Lesotho          Africa     1957    45.0   813338      336.</span>
<span class="co">##  9 Burundi          Africa     1952    39.0  2445618      339.</span>
<span class="co">## 10 Eritrea          Africa     1957    38.0  1542611      344.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Для того щоб сотувати дані за спаданням, використовується додаткова функція <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> в середині <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country   continent  year lifeExp     pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Kuwait    Asia       1957    58.0  212846   113523.</span>
<span class="co">##  2 Kuwait    Asia       1972    67.7  841934   109348.</span>
<span class="co">##  3 Kuwait    Asia       1952    55.6  160000   108382.</span>
<span class="co">##  4 Kuwait    Asia       1962    60.5  358266    95458.</span>
<span class="co">##  5 Kuwait    Asia       1967    64.6  575003    80895.</span>
<span class="co">##  6 Kuwait    Asia       1977    69.3 1140357    59265.</span>
<span class="co">##  7 Norway    Europe     2007    80.2 4627926    49357.</span>
<span class="co">##  8 Kuwait    Asia       2007    77.6 2505559    47307.</span>
<span class="co">##  9 Singapore Asia       2007    80.0 4553009    47143.</span>
<span class="co">## 10 Norway    Europe     2002    79.0 4535591    44684.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Якщо сортування за спаданням виконується по одній змінній, замість <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> можна використати знак <code>-</code>:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Але працює це тільки у випадку використання однієї змінної!</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">gdpPercap</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country   continent  year lifeExp     pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Kuwait    Asia       1957    58.0  212846   113523.</span>
<span class="co">##  2 Kuwait    Asia       1972    67.7  841934   109348.</span>
<span class="co">##  3 Kuwait    Asia       1952    55.6  160000   108382.</span>
<span class="co">##  4 Kuwait    Asia       1962    60.5  358266    95458.</span>
<span class="co">##  5 Kuwait    Asia       1967    64.6  575003    80895.</span>
<span class="co">##  6 Kuwait    Asia       1977    69.3 1140357    59265.</span>
<span class="co">##  7 Norway    Europe     2007    80.2 4627926    49357.</span>
<span class="co">##  8 Kuwait    Asia       2007    77.6 2505559    47307.</span>
<span class="co">##  9 Singapore Asia       2007    80.0 4553009    47143.</span>
<span class="co">## 10 Norway    Europe     2002    79.0 4535591    44684.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
</div>
<div id="select" class="section level3" number="2.3.5">
<h3>
<span class="header-section-number">2.3.5</span> dplyr::select()<a class="anchor" aria-label="anchor" href="#select"><i class="fas fa-link"></i></a>
</h3>
<p>У випадках, коли змінних у данних дуже багато, є сенс відібрати тільки ті, з якими ви будете працювати. В таких випадках нам допоможе функція <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, хоча тільки такими задачами вона не обмежується.
У нашому випадку в наборі даних лише шість змінних, що в принципі небагато, але суть функції буде зрозуміла.
Відберемо, наприклад змінні по країнам та населенню:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">pop</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 2</span>
<span class="co">##    country          pop</span>
<span class="co">##    &lt;fct&gt;          &lt;int&gt;</span>
<span class="co">##  1 Afghanistan  8425333</span>
<span class="co">##  2 Afghanistan  9240934</span>
<span class="co">##  3 Afghanistan 10267083</span>
<span class="co">##  4 Afghanistan 11537966</span>
<span class="co">##  5 Afghanistan 13079460</span>
<span class="co">##  6 Afghanistan 14880372</span>
<span class="co">##  7 Afghanistan 12881816</span>
<span class="co">##  8 Afghanistan 13867957</span>
<span class="co">##  9 Afghanistan 16317921</span>
<span class="co">## 10 Afghanistan 22227415</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Через двокрапку можна вказати послідовність з декількох стовпчиків для відбору:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">lifeExp</span><span class="op">:</span><span class="va">gdpPercap</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 4</span>
<span class="co">##    country     lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;         &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Замість назв можна використовувати порядковий номер стовпчика (нагадую, що індексація в R починається з 1):</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 4</span>
<span class="co">##    country     lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;         &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Коли змінних дійсно багато, простіше вказати змінні, які хочеться викинути. Для цього використовується знак <code>-</code> (для відкидання однієї змінної) і <code>!</code> (для декількох, які необхідно помістити у вектор). Відкинемо змінну континенту:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Відкидаємо одну змінну за допомогою `-`</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">continent</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 5</span>
<span class="co">##    country      year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan  1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan  1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan  1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan  1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan  1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan  1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan  1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan  1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan  1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan  1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Відкинемо змінну континенту та населення:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Відкидаємо декілька змінних за допомогою `!`</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">continent</span>, <span class="va">pop</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 4</span>
<span class="co">##    country      year lifeExp gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan  1952    28.8      779.</span>
<span class="co">##  2 Afghanistan  1957    30.3      821.</span>
<span class="co">##  3 Afghanistan  1962    32.0      853.</span>
<span class="co">##  4 Afghanistan  1967    34.0      836.</span>
<span class="co">##  5 Afghanistan  1972    36.1      740.</span>
<span class="co">##  6 Afghanistan  1977    38.4      786.</span>
<span class="co">##  7 Afghanistan  1982    39.9      978.</span>
<span class="co">##  8 Afghanistan  1987    40.8      852.</span>
<span class="co">##  9 Afghanistan  1992    41.7      649.</span>
<span class="co">## 10 Afghanistan  1997    41.8      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Крім того, за допомогою функцій <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> та <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> ми можемо задавати специфічні умови відбору змінних.
Для відбору стовпчиків, які починаються на певний вираз використовується <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>. Відберемо змінні, які починаються на <strong><em>co</em></strong>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 2</span>
<span class="co">##    country     continent</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;    </span>
<span class="co">##  1 Afghanistan Asia     </span>
<span class="co">##  2 Afghanistan Asia     </span>
<span class="co">##  3 Afghanistan Asia     </span>
<span class="co">##  4 Afghanistan Asia     </span>
<span class="co">##  5 Afghanistan Asia     </span>
<span class="co">##  6 Afghanistan Asia     </span>
<span class="co">##  7 Afghanistan Asia     </span>
<span class="co">##  8 Afghanistan Asia     </span>
<span class="co">##  9 Afghanistan Asia     </span>
<span class="co">## 10 Afghanistan Asia     </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Змінні, які закінчуються на англійську літеру <strong><em>p</em></strong>:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"p"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 3</span>
<span class="co">##    lifeExp      pop gdpPercap</span>
<span class="co">##      &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1    28.8  8425333      779.</span>
<span class="co">##  2    30.3  9240934      821.</span>
<span class="co">##  3    32.0 10267083      853.</span>
<span class="co">##  4    34.0 11537966      836.</span>
<span class="co">##  5    36.1 13079460      740.</span>
<span class="co">##  6    38.4 14880372      786.</span>
<span class="co">##  7    39.9 12881816      978.</span>
<span class="co">##  8    40.8 13867957      852.</span>
<span class="co">##  9    41.7 16317921      649.</span>
<span class="co">## 10    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Змінні, які містять англійську літеру <strong><em>x</em></strong>:</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 1</span>
<span class="co">##    lifeExp</span>
<span class="co">##      &lt;dbl&gt;</span>
<span class="co">##  1    28.8</span>
<span class="co">##  2    30.3</span>
<span class="co">##  3    32.0</span>
<span class="co">##  4    34.0</span>
<span class="co">##  5    36.1</span>
<span class="co">##  6    38.4</span>
<span class="co">##  7    39.9</span>
<span class="co">##  8    40.8</span>
<span class="co">##  9    41.7</span>
<span class="co">## 10    41.8</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>При роботі з даними часто використовуються <a href="https://en.wikipedia.org/wiki/Regular_expression">регулярні вирази</a> (<em>regular expression</em>). Це певні патерни тексту, які відповідають певній умові. Ми можемо використовувати їх при відборі змінних за допомогою функції <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code>.
Наприклад відберемо стовпчики, які в назві містять літери <strong><em>op</em></strong> або <strong><em>ap</em></strong>:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"[oa]p"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 2</span>
<span class="co">##         pop gdpPercap</span>
<span class="co">##       &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1  8425333      779.</span>
<span class="co">##  2  9240934      821.</span>
<span class="co">##  3 10267083      853.</span>
<span class="co">##  4 11537966      836.</span>
<span class="co">##  5 13079460      740.</span>
<span class="co">##  6 14880372      786.</span>
<span class="co">##  7 12881816      978.</span>
<span class="co">##  8 13867957      852.</span>
<span class="co">##  9 16317921      649.</span>
<span class="co">## 10 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Для більш детального ознайомлення з цією темою рекомендую роботу <span class="citation"><a href="references.html#ref-friedl2006" role="doc-biblioref">Friedl</a> (<a href="references.html#ref-friedl2006" role="doc-biblioref">2006</a>)</span>.</p>
<p>За допомогою функції <code>where()</code> можна обирати змінні за їх типом. Наприклад відберемо факторні змінні:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Зверніть увагу, що умова "is.factor" </span>
<span class="co"># вживається без дужок в середині where()</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 2</span>
<span class="co">##    country     continent</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;    </span>
<span class="co">##  1 Afghanistan Asia     </span>
<span class="co">##  2 Afghanistan Asia     </span>
<span class="co">##  3 Afghanistan Asia     </span>
<span class="co">##  4 Afghanistan Asia     </span>
<span class="co">##  5 Afghanistan Asia     </span>
<span class="co">##  6 Afghanistan Asia     </span>
<span class="co">##  7 Afghanistan Asia     </span>
<span class="co">##  8 Afghanistan Asia     </span>
<span class="co">##  9 Afghanistan Asia     </span>
<span class="co">## 10 Afghanistan Asia     </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Або залишимо тільки числові змінні:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 4</span>
<span class="co">##     year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1  1952    28.8  8425333      779.</span>
<span class="co">##  2  1957    30.3  9240934      821.</span>
<span class="co">##  3  1962    32.0 10267083      853.</span>
<span class="co">##  4  1967    34.0 11537966      836.</span>
<span class="co">##  5  1972    36.1 13079460      740.</span>
<span class="co">##  6  1977    38.4 14880372      786.</span>
<span class="co">##  7  1982    39.9 12881816      978.</span>
<span class="co">##  8  1987    40.8 13867957      852.</span>
<span class="co">##  9  1992    41.7 16317921      649.</span>
<span class="co">## 10  1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Але і це ще не все: за допомогою функції <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> та <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> можна змінювати позиції змінних у наборі даних. Спочатку ми вказуємо змінні, які хочемо помістити першими, після чого пишемо <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code>. Наприклад, помістимо всі числові змінні на початку:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##     year lifeExp      pop gdpPercap country     continent</span>
<span class="co">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;    </span>
<span class="co">##  1  1952    28.8  8425333      779. Afghanistan Asia     </span>
<span class="co">##  2  1957    30.3  9240934      821. Afghanistan Asia     </span>
<span class="co">##  3  1962    32.0 10267083      853. Afghanistan Asia     </span>
<span class="co">##  4  1967    34.0 11537966      836. Afghanistan Asia     </span>
<span class="co">##  5  1972    36.1 13079460      740. Afghanistan Asia     </span>
<span class="co">##  6  1977    38.4 14880372      786. Afghanistan Asia     </span>
<span class="co">##  7  1982    39.9 12881816      978. Afghanistan Asia     </span>
<span class="co">##  8  1987    40.8 13867957      852. Afghanistan Asia     </span>
<span class="co">##  9  1992    41.7 16317921      649. Afghanistan Asia     </span>
<span class="co">## 10  1997    41.8 22227415      635. Afghanistan Asia     </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
</div>
<div id="relocate" class="section level3" number="2.3.6">
<h3>
<span class="header-section-number">2.3.6</span> dplyr::relocate()<a class="anchor" aria-label="anchor" href="#relocate"><i class="fas fa-link"></i></a>
</h3>
<p>Насправді в dplyr є окрема функція для гнучкої зміни позиції — <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code>. За замовчуванням вона поміщає вказані змінні на перші позиції:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##         pop country     continent  year lifeExp gdpPercap</span>
<span class="co">##       &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">##  1  8425333 Afghanistan Asia       1952    28.8      779.</span>
<span class="co">##  2  9240934 Afghanistan Asia       1957    30.3      821.</span>
<span class="co">##  3 10267083 Afghanistan Asia       1962    32.0      853.</span>
<span class="co">##  4 11537966 Afghanistan Asia       1967    34.0      836.</span>
<span class="co">##  5 13079460 Afghanistan Asia       1972    36.1      740.</span>
<span class="co">##  6 14880372 Afghanistan Asia       1977    38.4      786.</span>
<span class="co">##  7 12881816 Afghanistan Asia       1982    39.9      978.</span>
<span class="co">##  8 13867957 Afghanistan Asia       1987    40.8      852.</span>
<span class="co">##  9 16317921 Afghanistan Asia       1992    41.7      649.</span>
<span class="co">## 10 22227415 Afghanistan Asia       1997    41.8      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>У функції <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> є два додаткових аргументи: <code>.before()</code> та <code>.after()</code>. Вони використовуються для вказування місця зміни позиції стовпчика:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Помістимо стовпчик continent після year</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">continent</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country      year continent lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan  1952 Asia         28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan  1957 Asia         30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan  1962 Asia         32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan  1967 Asia         34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan  1972 Asia         36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan  1977 Asia         38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan  1982 Asia         39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan  1987 Asia         40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan  1992 Asia         41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan  1997 Asia         41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span>

<span class="co"># Помістимо стовпчик continent після year</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">lifeExp</span>, .before <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year      pop lifeExp gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952  8425333    28.8      779.</span>
<span class="co">##  2 Afghanistan Asia       1957  9240934    30.3      821.</span>
<span class="co">##  3 Afghanistan Asia       1962 10267083    32.0      853.</span>
<span class="co">##  4 Afghanistan Asia       1967 11537966    34.0      836.</span>
<span class="co">##  5 Afghanistan Asia       1972 13079460    36.1      740.</span>
<span class="co">##  6 Afghanistan Asia       1977 14880372    38.4      786.</span>
<span class="co">##  7 Afghanistan Asia       1982 12881816    39.9      978.</span>
<span class="co">##  8 Afghanistan Asia       1987 13867957    40.8      852.</span>
<span class="co">##  9 Afghanistan Asia       1992 16317921    41.7      649.</span>
<span class="co">## 10 Afghanistan Asia       1997 22227415    41.8      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Можна переміщати й одразу цілі групи:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Помістимо всі цілочислові змінні після факторних</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.integer</span><span class="op">)</span>, .after <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year      pop lifeExp gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952  8425333    28.8      779.</span>
<span class="co">##  2 Afghanistan Asia       1957  9240934    30.3      821.</span>
<span class="co">##  3 Afghanistan Asia       1962 10267083    32.0      853.</span>
<span class="co">##  4 Afghanistan Asia       1967 11537966    34.0      836.</span>
<span class="co">##  5 Afghanistan Asia       1972 13079460    36.1      740.</span>
<span class="co">##  6 Afghanistan Asia       1977 14880372    38.4      786.</span>
<span class="co">##  7 Afghanistan Asia       1982 12881816    39.9      978.</span>
<span class="co">##  8 Afghanistan Asia       1987 13867957    40.8      852.</span>
<span class="co">##  9 Afghanistan Asia       1992 16317921    41.7      649.</span>
<span class="co">## 10 Afghanistan Asia       1997 22227415    41.8      635.</span>
<span class="co">## # ... with 1,694 more rows</span>

<span class="co"># Помістимо всі факторні змінні після числових</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##     year lifeExp      pop gdpPercap country     continent</span>
<span class="co">##    &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;    </span>
<span class="co">##  1  1952    28.8  8425333      779. Afghanistan Asia     </span>
<span class="co">##  2  1957    30.3  9240934      821. Afghanistan Asia     </span>
<span class="co">##  3  1962    32.0 10267083      853. Afghanistan Asia     </span>
<span class="co">##  4  1967    34.0 11537966      836. Afghanistan Asia     </span>
<span class="co">##  5  1972    36.1 13079460      740. Afghanistan Asia     </span>
<span class="co">##  6  1977    38.4 14880372      786. Afghanistan Asia     </span>
<span class="co">##  7  1982    39.9 12881816      978. Afghanistan Asia     </span>
<span class="co">##  8  1987    40.8 13867957      852. Afghanistan Asia     </span>
<span class="co">##  9  1992    41.7 16317921      649. Afghanistan Asia     </span>
<span class="co">## 10  1997    41.8 22227415      635. Afghanistan Asia     </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
</div>
<div id="rename" class="section level3" number="2.3.7">
<h3>
<span class="header-section-number">2.3.7</span> dplyr::rename()<a class="anchor" aria-label="anchor" href="#rename"><i class="fas fa-link"></i></a>
</h3>
<p>Настав час ознайомитися, як змінювати назви стовпчиків. І в цьому нам допоможе функція <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>.
Змінємо назву стовпчика <code>pop</code> на <code>population</code>:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Спочатку вказуємо нову назву, а після стару</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>population <span class="op">=</span> <span class="va">pop</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year lifeExp population gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8    8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3    9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0   10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0   11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1   13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4   14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9   12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8   13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7   16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8   22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Можна змінювати регістр назв за допомогою функцій <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with()</a></code> та <code><a href="https://rdrr.io/r/base/chartr.html">toupper()</a></code> для запису великими літерами або <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> для запису маленькими.</p>
<p>Запишемо всі назви великими:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">toupper</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    COUNTRY     CONTINENT  YEAR LIFEEXP      POP GDPPERCAP</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Згадуючи попередні розділи, можемо враховувати специфічні патерни:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">toupper</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"p"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year LIFEEXP      POP GDPPERCAP</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>В роботі досить часто постає питання заміни певної частини назви. Наприклад, прибрати пробіли або замінити їх певний символ. Оскільки в нашому прикладі з назвами все більш-менш нормально, я спеціально вставлю пробіли перед великими літерами в назвах стовпчиків. В цьому випадку нам знову приходять на допомогу регулярні вирази. Результат я збережу у змінній <code>gapminder_rename</code>:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_rename</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"([a-z])([A-Z])"</span>,<span class="st">"\\1 \\2"</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span>

<span class="va">gapminder_rename</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year `life Exp`      pop `gdp Percap`</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;      &lt;dbl&gt;    &lt;int&gt;        &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952       28.8  8425333         779.</span>
<span class="co">##  2 Afghanistan Asia       1957       30.3  9240934         821.</span>
<span class="co">##  3 Afghanistan Asia       1962       32.0 10267083         853.</span>
<span class="co">##  4 Afghanistan Asia       1967       34.0 11537966         836.</span>
<span class="co">##  5 Afghanistan Asia       1972       36.1 13079460         740.</span>
<span class="co">##  6 Afghanistan Asia       1977       38.4 14880372         786.</span>
<span class="co">##  7 Afghanistan Asia       1982       39.9 12881816         978.</span>
<span class="co">##  8 Afghanistan Asia       1987       40.8 13867957         852.</span>
<span class="co">##  9 Afghanistan Asia       1992       41.7 16317921         649.</span>
<span class="co">## 10 Afghanistan Asia       1997       41.8 22227415         635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Використання стовпчиків в назвах яких зустрічаються пробіли незручно. Тому давайте виправимо цю ситуацію. Покажу декілька варіантів. Перший варіант з використанням базової функції <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code>, де першим аргументом ми вказуємо спочатку що змінюємо, а другим - на що змінюємо.
Замінимо пробіли в назвах стовпчиків на знак підкреслення ("_"):</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Знак "тільда" (~) в R використовуються в якості формули,</span>
<span class="co"># ми познайомимось з її використанням в наступних темах</span>
<span class="va">gapminder_rename</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year life_Exp      pop gdp_Percap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952     28.8  8425333       779.</span>
<span class="co">##  2 Afghanistan Asia       1957     30.3  9240934       821.</span>
<span class="co">##  3 Afghanistan Asia       1962     32.0 10267083       853.</span>
<span class="co">##  4 Afghanistan Asia       1967     34.0 11537966       836.</span>
<span class="co">##  5 Afghanistan Asia       1972     36.1 13079460       740.</span>
<span class="co">##  6 Afghanistan Asia       1977     38.4 14880372       786.</span>
<span class="co">##  7 Afghanistan Asia       1982     39.9 12881816       978.</span>
<span class="co">##  8 Afghanistan Asia       1987     40.8 13867957       852.</span>
<span class="co">##  9 Afghanistan Asia       1992     41.7 16317921       649.</span>
<span class="co">## 10 Afghanistan Asia       1997     41.8 22227415       635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Другий варіант варіант ближчий до синтаксису tidyverse і використовує функції з пакету <code>stringr</code>, який створений для роботи з текстом:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_rename</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    Country     Continent  Year Life_exp      Pop Gdp_percap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952     28.8  8425333       779.</span>
<span class="co">##  2 Afghanistan Asia       1957     30.3  9240934       821.</span>
<span class="co">##  3 Afghanistan Asia       1962     32.0 10267083       853.</span>
<span class="co">##  4 Afghanistan Asia       1967     34.0 11537966       836.</span>
<span class="co">##  5 Afghanistan Asia       1972     36.1 13079460       740.</span>
<span class="co">##  6 Afghanistan Asia       1977     38.4 14880372       786.</span>
<span class="co">##  7 Afghanistan Asia       1982     39.9 12881816       978.</span>
<span class="co">##  8 Afghanistan Asia       1987     40.8 13867957       852.</span>
<span class="co">##  9 Afghanistan Asia       1992     41.7 16317921       649.</span>
<span class="co">## 10 Afghanistan Asia       1997     41.8 22227415       635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
</div>
<div id="mutate" class="section level3" number="2.3.8">
<h3>
<span class="header-section-number">2.3.8</span> dplyr::mutate()<a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<p>Майже жодна маніпуляція з даними не обходиться без створення нових стовпчиків. Для цього використовується функція <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. За замовчуванням нова змінна записується в кінці набору даних.
Давайте розрахуємо загальний ВВП кожної країни в певний момент часу. Для цього створимо нову змінну <code>gdp_billion</code> в якій перемножимо змінні “кількість населення” на “ВВП на душу населення” та поділимо на один мільярд:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 7</span>
<span class="co">##    country     continent  year lifeExp      pop gdpPercap gdp_billion</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.        6.57</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.        7.59</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.        8.76</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.        9.65</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.        9.68</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.       11.7 </span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.       12.6 </span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.       11.8 </span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.       10.6 </span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.       14.1 </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>За допомогою аргументів <code>.before</code> та <code>.after</code> можна змінювати й позицію запису нової змінної:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span>,
         .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 7</span>
<span class="co">##    country     continent  year gdp_billion lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952        6.57    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957        7.59    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962        8.76    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967        9.65    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972        9.68    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977       11.7     38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982       12.6     39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987       11.8     40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992       10.6     41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997       14.1     41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Інколи необхідно свторити стовпчик індексів: порядковий номер спостереження. Для цього можна використати функцію <code><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number()</a></code>:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>record <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span>,
         .before <span class="op">=</span> <span class="va">country</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 7</span>
<span class="co">##    record country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##     &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1      1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2      2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3      3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4      4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5      5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6      6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7      7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8      8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9      9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10     10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Або використати базовий синтаксис R:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>record <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
         .before <span class="op">=</span> <span class="va">country</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 7</span>
<span class="co">##    record country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##     &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1      1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2      2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3      3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4      4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5      5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6      6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7      7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8      8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9      9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10     10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Якщо ж хочется залишити лише розрахунковий стовпчик — використовується функція <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute()</a></code>. При цьому вона дає можливість залишити й певні стовпчики з оригінального набору даних.</p>
<p>Залишимо змінну <code>country</code> та розрахуємо загальний ВВП:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">country</span>,
            gdp_billion <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span> <span class="op">/</span> <span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span>
<span class="co">## # A tibble: 1,704 x 2</span>
<span class="co">##    country     gdp_billion</span>
<span class="co">##    &lt;fct&gt;             &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan        6.57</span>
<span class="co">##  2 Afghanistan        7.59</span>
<span class="co">##  3 Afghanistan        8.76</span>
<span class="co">##  4 Afghanistan        9.65</span>
<span class="co">##  5 Afghanistan        9.68</span>
<span class="co">##  6 Afghanistan       11.7 </span>
<span class="co">##  7 Afghanistan       12.6 </span>
<span class="co">##  8 Afghanistan       11.8 </span>
<span class="co">##  9 Afghanistan       10.6 </span>
<span class="co">## 10 Afghanistan       14.1 </span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
</div>
<div id="group_by" class="section level3" number="2.3.9">
<h3>
<span class="header-section-number">2.3.9</span> dplyr::group_by() та summarise()<a class="anchor" aria-label="anchor" href="#group_by"><i class="fas fa-link"></i></a>
</h3>
<p>Ще однією популярною задачею є групування та агрегація даних: розрахунок певних статистик чи значень для окремих груп.
Для цього використовується функції <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> та <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, які, як правило, використовуються разом.</p>
<p>Для прикладу, розрахуємо середню (<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>) очікувану тривалість життя для кожного континенту. Для цього спочатку групуємо дані, а потім розраховуємо статистичний показник, який назвемо <code>mean_life_exp</code>:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 2</span>
<span class="co">##   continent mean_life_exp</span>
<span class="co">##   &lt;fct&gt;             &lt;dbl&gt;</span>
<span class="co">## 1 Africa             48.9</span>
<span class="co">## 2 Americas           64.7</span>
<span class="co">## 3 Asia               60.1</span>
<span class="co">## 4 Europe             71.9</span>
<span class="co">## 5 Oceania            74.3</span></code></pre></div>
<p>Аналогічно, ми можемо розраховувати одночасно декілька статистик. Додамо до розрахунку медіану (<code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>) та стандартне відхилення (<code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>) очікуваної тривалості життя:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,
            md_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,
            sd_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 4</span>
<span class="co">##   continent mean_life_exp md_life_exp sd_life_exp</span>
<span class="co">##   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">## 1 Africa             48.9        47.8        9.15</span>
<span class="co">## 2 Americas           64.7        67.0        9.35</span>
<span class="co">## 3 Asia               60.1        61.8       11.9 </span>
<span class="co">## 4 Europe             71.9        72.2        5.43</span>
<span class="co">## 5 Oceania            74.3        73.7        3.80</span></code></pre></div>
<p>Слід звернути увагу, що всі зазначені вище статистики в R чутливі до пропущених значень: у разі їх наявності, функції будуть повертати <code>NA</code> (not available). Для того, щоб при розрахунку статистик не враховувались пропущені значення необхідно додати аргумент <code>na.rm = TRUE</code>.</p>
</div>
<div id="across" class="section level3" number="2.3.10">
<h3>
<span class="header-section-number">2.3.10</span> dplyr::across()<a class="anchor" aria-label="anchor" href="#across"><i class="fas fa-link"></i></a>
</h3>
<p>Але що, якщо нам необхідно розрахувати, наприклад, середні значення для всіх числових стовпчиків? Звичайно можна перерахувати їх всіх вручну:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,
            mean_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,
            mean_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 4</span>
<span class="co">##   continent mean_life_exp  mean_pop mean_gdpPercap</span>
<span class="co">##   &lt;fct&gt;             &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">## 1 Africa             48.9  9916003.          2194.</span>
<span class="co">## 2 Americas           64.7 24504795.          7136.</span>
<span class="co">## 3 Asia               60.1 77038722.          7902.</span>
<span class="co">## 4 Europe             71.9 17169765.         14469.</span>
<span class="co">## 5 Oceania            74.3  8874672.         18622.</span></code></pre></div>
<p>Але якщо числових змінних багато — такий підхід буде неоптимальним.
В таких випадках краще скористатися функцією <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>. Продемонструю декілька варіантів.</p>
<p>Для початку розрахуємо, як в попередньому прикладі, середні значення для числових змінних:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># прибираємо змінну року</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 4</span>
<span class="co">##   continent lifeExp       pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Africa       48.9  9916003.     2194.</span>
<span class="co">## 2 Americas     64.7 24504795.     7136.</span>
<span class="co">## 3 Asia         60.1 77038722.     7902.</span>
<span class="co">## 4 Europe       71.9 17169765.    14469.</span>
<span class="co">## 5 Oceania      74.3  8874672.    18622.</span></code></pre></div>
<p>Або можна перелічити потрібні змінні у векторі:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">:</span><span class="va">gdpPercap</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 4</span>
<span class="co">##   continent lifeExp       pop gdpPercap</span>
<span class="co">##   &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Africa       48.9  9916003.     2194.</span>
<span class="co">## 2 Americas     64.7 24504795.     7136.</span>
<span class="co">## 3 Asia         60.1 77038722.     7902.</span>
<span class="co">## 4 Europe       71.9 17169765.    14469.</span>
<span class="co">## 5 Oceania      74.3  8874672.    18622.</span></code></pre></div>
<p>Якщо уважно придивитися до результатів, то видно, що результати розрахунку повертаються з тими ж названими, як в оригінальному наборі даних. Якщо показати такий розрахунок третій стороні - можуть виникнути проблеми сприйняття. Як бути? Насправді функція <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> досить гнучка і розробники передбачили такий варіант. Для цього нам знадобиться аргумент <code>.names</code>, де ми вкажемо правило запису назв результуючих змінних:</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">:</span><span class="va">gdpPercap</span>,
                   <span class="va">mean</span>,
                   .names <span class="op">=</span> <span class="st">"mean_{.col}"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 4</span>
<span class="co">##   continent mean_lifeExp  mean_pop mean_gdpPercap</span>
<span class="co">##   &lt;fct&gt;            &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">## 1 Africa            48.9  9916003.          2194.</span>
<span class="co">## 2 Americas          64.7 24504795.          7136.</span>
<span class="co">## 3 Asia              60.1 77038722.          7902.</span>
<span class="co">## 4 Europe            71.9 17169765.         14469.</span>
<span class="co">## 5 Oceania           74.3  8874672.         18622.</span></code></pre></div>
<p>І навіть розрахунки декількох різних статистик теж можливий. Для цього їх перелік необхідно записати списоком в аргументів функції <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">:</span><span class="va">gdpPercap</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="va">mean</span>, stdev <span class="op">=</span> <span class="va">sd</span>, md <span class="op">=</span> <span class="va">median</span><span class="op">)</span>,
                   .names <span class="op">=</span> <span class="st">"{.fn}_{.col}"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 10</span>
<span class="co">##   continent avg_lifeExp stdev_lifeExp md_lifeExp avg_pop stdev_pop md_pop avg_gdpPercap</span>
<span class="co">##   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">## 1 Africa           48.9          9.15       47.8  9.92e6    1.55e7 4.58e6         2194.</span>
<span class="co">## 2 Americas         64.7          9.35       67.0  2.45e7    5.10e7 6.23e6         7136.</span>
<span class="co">## 3 Asia             60.1         11.9        61.8  7.70e7    2.07e8 1.45e7         7902.</span>
<span class="co">## 4 Europe           71.9          5.43       72.2  1.72e7    2.05e7 8.55e6        14469.</span>
<span class="co">## 5 Oceania          74.3          3.80       73.7  8.87e6    6.51e6 6.40e6        18622.</span>
<span class="co">## # ... with 2 more variables: stdev_gdpPercap &lt;dbl&gt;, md_gdpPercap &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="count" class="section level3" number="2.3.11">
<h3>
<span class="header-section-number">2.3.11</span> dplyr::count()<a class="anchor" aria-label="anchor" href="#count"><i class="fas fa-link"></i></a>
</h3>
<p>Якщо нам необхідно порахувати кількість значень в групі, то це можна зробити за допомогою <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> та <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. Підрахуємо кількість країн на кожному континенті у наборі даних. Оскільки для кожної країни є 12 спостережень (з 1952 по 2007 рік кожні 5 років), необхідно враховувати тільки унікальні значення - для таких випадків є функція <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>:</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># унікальні значення</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 5 x 2</span>
<span class="co">##   continent     n</span>
<span class="co">##   &lt;fct&gt;     &lt;int&gt;</span>
<span class="co">## 1 Africa       52</span>
<span class="co">## 2 Americas     25</span>
<span class="co">## 3 Asia         33</span>
<span class="co">## 4 Europe       30</span>
<span class="co">## 5 Oceania       2</span></code></pre></div>
<p>Але є простіший варіант - через функцію <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span> <span class="co"># поправка на к-ть років</span>
<span class="co">## # A tibble: 5 x 2</span>
<span class="co">##   continent     n</span>
<span class="co">##   &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">## 1 Africa       52</span>
<span class="co">## 2 Americas     25</span>
<span class="co">## 3 Asia         33</span>
<span class="co">## 4 Europe       30</span>
<span class="co">## 5 Oceania       2</span></code></pre></div>
</div>
<div id="case" class="section level3" number="2.3.12">
<h3>
<span class="header-section-number">2.3.12</span> dplyr::case_when()<a class="anchor" aria-label="anchor" href="#case"><i class="fas fa-link"></i></a>
</h3>
<p>Яка маніпуляція з даними обходиться без конструкції “if - else?” В базовому синтаксисі R є функція <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> але я пропоную користуватися векторизованим варіантом з dplyr <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>.
Для прикладу давайте створимо нову номінативну змінну, яка буде оцінювати середню очікувану тривалість життя в форматі “низька-середня-висока”:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    bin_life <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
      <span class="va">mean_life_exp</span> <span class="op">&gt;</span> <span class="fl">70</span> <span class="op">~</span> <span class="st">"hight"</span>, <span class="co"># умова 1</span>
      <span class="va">mean_life_exp</span> <span class="op">&gt;</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">mean_life_exp</span> <span class="op">&lt;=</span> <span class="fl">70</span> <span class="op">~</span> <span class="st">"medium"</span>, <span class="co"># умова 2</span>
      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"low"</span> <span class="co"># для всіх інших випадків</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="co">## # A tibble: 142 x 3</span>
<span class="co">##    country     mean_life_exp bin_life</span>
<span class="co">##    &lt;fct&gt;               &lt;dbl&gt; &lt;chr&gt;   </span>
<span class="co">##  1 Afghanistan          37.5 low     </span>
<span class="co">##  2 Albania              68.4 medium  </span>
<span class="co">##  3 Algeria              59.0 medium  </span>
<span class="co">##  4 Angola               37.9 low     </span>
<span class="co">##  5 Argentina            69.1 medium  </span>
<span class="co">##  6 Australia            74.7 hight   </span>
<span class="co">##  7 Austria              73.1 hight   </span>
<span class="co">##  8 Bahrain              65.6 medium  </span>
<span class="co">##  9 Bangladesh           49.8 low     </span>
<span class="co">## 10 Belgium              73.6 hight   </span>
<span class="co">## # ... with 132 more rows</span></code></pre></div>
</div>
<div id="pivot" class="section level3" number="2.3.13">
<h3>
<span class="header-section-number">2.3.13</span> Обертання даних: pivot()<a class="anchor" aria-label="anchor" href="#pivot"><i class="fas fa-link"></i></a>
</h3>
<p>Бувають випадки, коли дані приходять в “неохайному,” незручному форматі:</p>
<ul>
<li><p>одна змінна розташована у декількох стовпчиках.</p></li>
<li><p>одне спостереження може бути розкидане по кільком рядкам.</p></li>
</ul>
<p>Типовим прикладом таких даних можуть бути дані Всесвітнього банку. Давайте завантажимо їх і подивимось, як привести їх до “охайних.” В таких випадках нам допоможуть функції <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> та <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> з пакету <code>tidyr</code> (частина tidyverse).</p>
<p>В якості прикладу завантажимо інформацію по показнику Прямі іноземні інвестиції (Foreign direct investment, net (BoP, current US$)).</p>
Дані можна завантажити з мого репозитарію GitHub: <a href="https://raw.githubusercontent.com/Aranaur/datasets/main/datasets/world_bank/Foreign_direct_investment/FDI.csv">прямі іноземні інвестиції, дані Всісвітного банку</a>. Давайте переглянемо їх <a href="dplyr.html#fig:wbimage">2.1</a>.
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:wbimage"></span>
<img src="docs/images/wb_01.png" alt="Перегляд перших значень набору даних Всесвытнього банку" width="100%"><p class="caption">
Рисунок 2.1: Перегляд перших значень набору даних Всесвытнього банку
</p>
</div>
<p>На що звертаємо увагу:</p>
<ul>
<li><p>Перші 4 рядочки неінформативні.</p></li>
<li><p>Дані зберігаються у “широкому форматі”: змінна року розташована горизонтально, що може ускладнити аналіз.</p></li>
</ul>
<p>Завантажимо дані і одразу пропустимо перші 4 рядки за допомогою аргументу <code>skip = 4</code>:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fdi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/Aranaur/datasets/main/datasets/world_bank/Foreign_direct_investment/FDI.csv"</span>,
                skip <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">fdi</span>
<span class="co">## # A tibble: 266 x 66</span>
<span class="co">##    `Country Name` `Country Code` `Indicator Name` `Indicator Code` `1960` `1961` `1962`</span>
<span class="co">##    &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">##  1 Aruba          ABW            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  2 Africa Easter~ AFE            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  3 Afghanistan    AFG            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  4 Africa Wester~ AFW            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  5 Angola         AGO            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  6 Albania        ALB            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  7 Andorra        AND            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  8 Arab World     ARB            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">##  9 United Arab E~ ARE            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">## 10 Argentina      ARG            Foreign direct ~ BN.KLT.DINV.CD       NA     NA     NA</span>
<span class="co">## # ... with 256 more rows, and 59 more variables: `1963` &lt;dbl&gt;, `1964` &lt;dbl&gt;,</span>
<span class="co">## #   `1965` &lt;dbl&gt;, `1966` &lt;dbl&gt;, `1967` &lt;dbl&gt;, `1968` &lt;dbl&gt;, `1969` &lt;dbl&gt;,</span>
<span class="co">## #   `1970` &lt;dbl&gt;, `1971` &lt;dbl&gt;, `1972` &lt;dbl&gt;, `1973` &lt;dbl&gt;, `1974` &lt;dbl&gt;,</span>
<span class="co">## #   `1975` &lt;dbl&gt;, `1976` &lt;dbl&gt;, `1977` &lt;dbl&gt;, `1978` &lt;dbl&gt;, `1979` &lt;dbl&gt;,</span>
<span class="co">## #   `1980` &lt;dbl&gt;, `1981` &lt;dbl&gt;, `1982` &lt;dbl&gt;, `1983` &lt;dbl&gt;, `1984` &lt;dbl&gt;,</span>
<span class="co">## #   `1985` &lt;dbl&gt;, `1986` &lt;dbl&gt;, `1987` &lt;dbl&gt;, `1988` &lt;dbl&gt;, `1989` &lt;dbl&gt;,</span>
<span class="co">## #   `1990` &lt;dbl&gt;, `1991` &lt;dbl&gt;, `1992` &lt;dbl&gt;, `1993` &lt;dbl&gt;, `1994` &lt;dbl&gt;, ...</span></code></pre></div>
<p>Використаємо функцію <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> для того щоб змінна року була окремим стовпчиком:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fdi_longer</span> <span class="op">&lt;-</span> <span class="va">fdi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># змінимо формат назв стовпчиків</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># приберемо зайві</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">indicator_name</span>, <span class="va">indicator_code</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># обертаємо дані</span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">country_name</span>, <span class="va">country_code</span><span class="op">)</span>, <span class="co"># використовуємо всі </span>
                                                        <span class="co"># крім country_name, country_code</span>
               names_to <span class="op">=</span> <span class="st">"year"</span>, <span class="co"># назва нового стовпчика </span>
                                  <span class="co"># (роки з початкового набору даних)</span>
               values_to <span class="op">=</span> <span class="st">"fdi"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># назва нового стовпчика </span>
                                      <span class="co"># (значення ПІІ до кожного року)</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># приберемо пропущені значення</span>

<span class="va">fdi_longer</span>
<span class="co">## # A tibble: 6,473 x 4</span>
<span class="co">##    country_name country_code year          fdi</span>
<span class="co">##    &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">##  1 Aruba        ABW          1990  -130502793.</span>
<span class="co">##  2 Aruba        ABW          1991  -184748603.</span>
<span class="co">##  3 Aruba        ABW          1992    36983240.</span>
<span class="co">##  4 Aruba        ABW          1993    17932961.</span>
<span class="co">##  5 Aruba        ABW          1994    73184358.</span>
<span class="co">##  6 Aruba        ABW          1995     5530726.</span>
<span class="co">##  7 Aruba        ABW          1996   -84134078.</span>
<span class="co">##  8 Aruba        ABW          1997  -197597765.</span>
<span class="co">##  9 Aruba        ABW          1998   -82178771.</span>
<span class="co">## 10 Aruba        ABW          1999  -469329609.</span>
<span class="co">## # ... with 6,463 more rows</span></code></pre></div>
<p>З таким набором даних буде працювати значно зручніше.</p>
<p>Для прикладу роботи функції <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> повернемося до датасету <code>gapminder</code>:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span>
<span class="co">## # A tibble: 1,704 x 6</span>
<span class="co">##    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">## # ... with 1,694 more rows</span></code></pre></div>
<p>Перевернемо його у широкий формат:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder_wide</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>,
              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">:</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span>

<span class="va">gapminder_wide</span>
<span class="co">## # A tibble: 142 x 38</span>
<span class="co">##    country   continent lifeExp_1952 lifeExp_1957 lifeExp_1962 lifeExp_1967 lifeExp_1972</span>
<span class="co">##    &lt;fct&gt;     &lt;fct&gt;            &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">##  1 Afghanis~ Asia              28.8         30.3         32.0         34.0         36.1</span>
<span class="co">##  2 Albania   Europe            55.2         59.3         64.8         66.2         67.7</span>
<span class="co">##  3 Algeria   Africa            43.1         45.7         48.3         51.4         54.5</span>
<span class="co">##  4 Angola    Africa            30.0         32.0         34           36.0         37.9</span>
<span class="co">##  5 Argentina Americas          62.5         64.4         65.1         65.6         67.1</span>
<span class="co">##  6 Australia Oceania           69.1         70.3         70.9         71.1         71.9</span>
<span class="co">##  7 Austria   Europe            66.8         67.5         69.5         70.1         70.6</span>
<span class="co">##  8 Bahrain   Asia              50.9         53.8         56.9         59.9         63.3</span>
<span class="co">##  9 Banglade~ Asia              37.5         39.3         41.2         43.5         45.3</span>
<span class="co">## 10 Belgium   Europe            68           69.2         70.2         70.9         71.4</span>
<span class="co">## # ... with 132 more rows, and 31 more variables: lifeExp_1977 &lt;dbl&gt;,</span>
<span class="co">## #   lifeExp_1982 &lt;dbl&gt;, lifeExp_1987 &lt;dbl&gt;, lifeExp_1992 &lt;dbl&gt;, lifeExp_1997 &lt;dbl&gt;,</span>
<span class="co">## #   lifeExp_2002 &lt;dbl&gt;, lifeExp_2007 &lt;dbl&gt;, pop_1952 &lt;int&gt;, pop_1957 &lt;int&gt;,</span>
<span class="co">## #   pop_1962 &lt;int&gt;, pop_1967 &lt;int&gt;, pop_1972 &lt;int&gt;, pop_1977 &lt;int&gt;, pop_1982 &lt;int&gt;,</span>
<span class="co">## #   pop_1987 &lt;int&gt;, pop_1992 &lt;int&gt;, pop_1997 &lt;int&gt;, pop_2002 &lt;int&gt;, pop_2007 &lt;int&gt;,</span>
<span class="co">## #   gdpPercap_1952 &lt;dbl&gt;, gdpPercap_1957 &lt;dbl&gt;, gdpPercap_1962 &lt;dbl&gt;,</span>
<span class="co">## #   gdpPercap_1967 &lt;dbl&gt;, gdpPercap_1972 &lt;dbl&gt;, gdpPercap_1977 &lt;dbl&gt;, ...</span></code></pre></div>
<p>В переважній більшості випадків вам знадобиться довгий формат даних. Але при потребі зберігання великих файлів - краще зберігати у широкому форматі, оскільки це збереже місце на диску.</p>
<p>Збережемо результати широкого і довго формату набору даних <code>gapminder</code> та перевіремо їх розмір:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="st">"docs/data/gapminder.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">gapminder_wide</span>, <span class="st">"docs/data/gapminder_wide.csv"</span><span class="op">)</span>

<span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html">file_size</a></span><span class="op">(</span><span class="st">"docs/data/gapminder.csv"</span><span class="op">)</span>
<span class="co">## 80.2K</span>
<span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html">file_size</a></span><span class="op">(</span><span class="st">"docs/data/gapminder_wide.csv"</span><span class="op">)</span>
<span class="co">## 47.3K</span></code></pre></div>
<p>Широкий формат в 1.7 рази менший.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introR.html"><span class="header-section-number">1</span> Вступ до R</a></div>
<div class="next"><a href="simple_regression.html"><span class="header-section-number">3</span> Проста лінійна регресія</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>На цій сторінці</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#dplyr"><span class="header-section-number">2</span> Маніпуляції з даними за допомогою dplyr і не тільки</a></li>
<li><a class="nav-link" href="#tidy"><span class="header-section-number">2.1</span> Tidy-всесвіт</a></li>
<li>
<a class="nav-link" href="#tidy_read"><span class="header-section-number">2.2</span> Завантаження даних</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy_csv"><span class="header-section-number">2.2.1</span> Завантаження .csv, .tsv файлів</a></li>
<li><a class="nav-link" href="#tidy_xls"><span class="header-section-number">2.2.2</span> Завантаження .xls, .xlsx файлів</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dplyr"><span class="header-section-number">2.3</span> Маніпуляції з даними за допомогою пакету dplyr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#glimpse"><span class="header-section-number">2.3.1</span> dplyr::glimpse()</a></li>
<li><a class="nav-link" href="#filter"><span class="header-section-number">2.3.2</span> dplyr::filter()</a></li>
<li><a class="nav-link" href="#slice"><span class="header-section-number">2.3.3</span> dplyr::slice()</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">2.3.4</span> dplyr::arrange()</a></li>
<li><a class="nav-link" href="#select"><span class="header-section-number">2.3.5</span> dplyr::select()</a></li>
<li><a class="nav-link" href="#relocate"><span class="header-section-number">2.3.6</span> dplyr::relocate()</a></li>
<li><a class="nav-link" href="#rename"><span class="header-section-number">2.3.7</span> dplyr::rename()</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">2.3.8</span> dplyr::mutate()</a></li>
<li><a class="nav-link" href="#group_by"><span class="header-section-number">2.3.9</span> dplyr::group_by() та summarise()</a></li>
<li><a class="nav-link" href="#across"><span class="header-section-number">2.3.10</span> dplyr::across()</a></li>
<li><a class="nav-link" href="#count"><span class="header-section-number">2.3.11</span> dplyr::count()</a></li>
<li><a class="nav-link" href="#case"><span class="header-section-number">2.3.12</span> dplyr::case_when()</a></li>
<li><a class="nav-link" href="#pivot"><span class="header-section-number">2.3.13</span> Обертання даних: pivot()</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/aranaur/r_econometrics/blob/master/02-dplyr.Rmd">Переглянути код <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/aranaur/r_econometrics/edit/master/02-dplyr.Rmd">Редагувати <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><span style="font-size: 14px">ОСНОВИ ЕКОНОМЕТРИКИ В R
</span></strong>", автор Ігор Мірошниченко. <br>Останні зміни: 2022-05-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Книгу створено за допомогою пакету <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
